generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// STATUS: FUTURE
// AI agent task queue - used by cron jobs for background AI processing
model AIAgentTask {
  id          String    @id
  userId      String
  taskType    String
  payload     Json
  status      String    @default("pending")
  result      Json?
  error       String?
  startedAt   DateTime?
  completedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime

  @@index([status])
  @@index([taskType])
  @@index([userId])
}

model AuditLog {
  id         String   @id @default(cuid())
  userId     String?
  userEmail  String?
  userRole   String?
  action     String
  entityType String?
  entityId   String?
  ipAddress  String?
  userAgent  String?
  metadata   Json?
  createdAt  DateTime @default(now())
  User       User?    @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([action])
  @@index([entityType])
  @@index([createdAt])
  @@index([userRole, action])
}

model AIPromptHistory {
  id        String   @id
  creatorId String
  prompt    String
  response  String
  category  String?
  helpful   Boolean?
  createdAt DateTime @default(now())
  Talent    Talent   @relation(fields: [creatorId], references: [id], onDelete: Cascade)

  @@index([category])
  @@index([creatorId, createdAt])
}

// STATUS: FUTURE
// Agent management system - not yet fully implemented
model AgentProfile {
  id          String   @id
  userId      String   @unique
  agentType   String?
  bio         String?
  languages   String[]
  timezone    String?
  status      String   @default("active")
  maxCapacity Int      @default(10)
  User        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// Agent policy configuration
model AgentPolicy {
  id        String   @id @default(cuid())
  userId    String   @unique
  config    Json? // Agent policy configuration
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Approval {
  id          String   @id @default(cuid())
  type        String
  title       String
  description String?
  status      String   @default("PENDING")
  requestorId String
  approverId  String?
  ownerId     String?
  attachments Json[]   @default([])
  metadata    Json?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  Requestor User  @relation("ApprovalRequestor", fields: [requestorId], references: [id])
  Approver  User? @relation("ApprovalApprover", fields: [approverId], references: [id])

  @@index([status])
  @@index([type])
  @@index([requestorId])
  @@index([approverId])
}

model AiTokenLog {
  id               String   @id
  userId           String?
  action           String
  model            String
  promptTokens     Int
  completionTokens Int
  totalTokens      Int
  estimatedCost    Float
  createdAt        DateTime @default(now())
  User             User?    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// STATUS: FUTURE
// AI-powered asset generation - planned feature
model AssetGeneration {
  id            String   @id
  deliverableId String
  userId        String
  assetType     String
  type          String?
  prompt        String
  generatedUrl  String?
  aiOutput      String?
  status        String   @default("pending")
  metadata      Json?
  createdAt     DateTime @default(now())
  updatedAt     DateTime

  @@index([deliverableId])
  @@index([status])
  @@index([userId])
}

model Brand {
  id                    String   @id @default(cuid())
  name                  String
  domain                String?  @unique
  websiteUrl            String?
  industry              String?
  values                String[]
  restrictedCategories  String[]
  preferredCreatorTypes String[]
  targetAudience        Json?
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  // Relations
  BrandUsers        BrandUser[]
  BrandSavedTalent  BrandSavedTalent[]
  CreatorFitScore   CreatorFitScore[]
  CrmCampaign       CrmCampaign[]
  Deal              Deal[]
  Invoice           Invoice[]
  Outreach          Outreach[]
  Payout            Payout[]
  SuitabilityResult SuitabilityResult[]
  Contract          Contract[]
  AuditSources      AuditSource[]

  @@index([domain])
  @@index([createdAt])
}

model BrandCampaign {
  id                 String               @id
  title              String
  ownerId            String
  stage              String               @default("PLANNING")
  brands             Json?
  creatorTeams       Json?
  metadata           Json?
  createdAt          DateTime             @default(now())
  updatedAt          DateTime
  User               User                 @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  CampaignBrandPivot CampaignBrandPivot[]

  @@index([createdAt])
  @@index([ownerId])
  @@index([stage])
}

model CampaignBrandPivot {
  id            String        @id
  campaignId    String
  brandId       String
  metrics       Json?
  createdAt     DateTime      @default(now())
  BrandCampaign BrandCampaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)

  @@unique([campaignId, brandId])
  @@index([brandId])
  @@index([campaignId])
}

// STATUS: FUTURE
// AI contract analysis feature - partially implemented
model ContractReview {
  id           String   @id
  userId       String
  fileId       String?
  contractText String
  findings     Json?
  riskScore    Float?
  status       String   @default("pending")
  createdAt    DateTime @default(now())
  updatedAt    DateTime

  @@index([fileId])
  @@index([status])
  @@index([userId])
}

model Contract {
  id             String    @id @default(cuid())
  dealId         String
  brandId        String? // Explicit brand linkage for direct queries
  title          String
  fileUrl        String?
  pdfUrl         String?
  signedPdfUrl   String? // Signed PDF from e-signature provider
  envelopeId     String? // DocuSign envelope ID (or other provider ID)
  status         String    @default("draft")
  sentAt         DateTime?
  talentSignedAt DateTime?
  brandSignedAt  DateTime?
  fullySignedAt  DateTime?
  terms          Json?
  templateId     String?
  metadata       Json?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  Deal           Deal      @relation(fields: [dealId], references: [id], onDelete: Cascade)
  Brand          Brand?    @relation(fields: [brandId], references: [id], onDelete: SetNull)

  @@index([dealId])
  @@index([brandId])
  @@index([status])
  @@index([sentAt])
  @@index([envelopeId])
}

// STATUS: FUTURE
// Creator balance tracking - read-only for dashboards
model CreatorBalance {
  id              String   @id
  userId          String   @unique
  available       Float    @default(0)
  availableAmount Float    @default(0)
  pendingAmount   Float    @default(0)
  totalEarned     Float    @default(0)
  currency        String   @default("usd")
  metadata        Json?
  lastUpdated     DateTime @default(now())
  createdAt       DateTime @default(now())
  updatedAt       DateTime

  @@index([userId])
}

model CalendarEvent {
  id          String   @id @default(cuid())
  title       String
  description String?
  startAt     DateTime
  endAt       DateTime
  type        String // "meeting" | "event" | "content"
  source      String   @default("internal") // "internal" | "email" | "google"
  location    String?
  status      String   @default("scheduled") // "scheduled" | "cancelled" | "completed"
  isAllDay    Boolean  @default(false)
  createdBy   String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Metadata for filtering and relations
  metadata Json? // { brand, category, confirmed, etc. }

  // Relations to CRM entities
  relatedBrandIds    String[] @default([])
  relatedCreatorIds  String[] @default([])
  relatedDealIds     String[] @default([])
  relatedCampaignIds String[] @default([])
  relatedTaskIds     String[] @default([])

  // Creator relation
  Creator User @relation("CalendarEventCreator", fields: [createdBy], references: [id])

  @@index([createdBy])
  @@index([startAt])
  @@index([endAt])
  @@index([type])
  @@index([source])
  @@index([status])
}

model InternalQueueTask {
  id               String    @id
  title            String
  description      String?
  status           String    @default("pending") // pending, completed
  priority         String    @default("Medium") // High, Medium, Low
  dueDate          DateTime?
  assignedToUserId String?
  createdByUserId  String
  completedAt      DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime
  metadata         Json?     @default("{}")

  AssignedToUser User? @relation("InternalTaskAssignedTo", fields: [assignedToUserId], references: [id], onDelete: SetNull)
  CreatedByUser  User  @relation("InternalTaskCreatedBy", fields: [createdByUserId], references: [id], onDelete: Cascade)

  @@index([createdByUserId])
  @@index([assignedToUserId])
  @@index([status])
  @@index([dueDate])
  @@index([priority])
}

model CreatorEvent {
  id            String    @id
  creatorId     String
  eventName     String
  eventType     String
  description   String?
  location      String?
  startAt       DateTime
  endAt         DateTime?
  status        String    @default("suggested")
  source        String    @default("agent")
  sourceUserId  String?
  declineReason String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime
  Talent        Talent    @relation(fields: [creatorId], references: [id], onDelete: Cascade)
  User          User?     @relation(fields: [sourceUserId], references: [id])

  @@index([creatorId, status])
  @@index([startAt])
  @@index([status])
}

model CreatorGoal {
  id                 String               @id
  creatorId          String
  goalCategory       String               @default("growth")
  goalType           String
  title              String
  targetValue        Float?
  targetUnit         String?
  timeframe          String?
  progress           Float                @default(0)
  active             Boolean              @default(true)
  createdAt          DateTime             @default(now())
  updatedAt          DateTime
  Talent             Talent               @relation(fields: [creatorId], references: [id], onDelete: Cascade)
  CreatorGoalVersion CreatorGoalVersion[]

  @@index([creatorId, active])
  @@index([goalCategory])
  @@index([goalType])
}

model CreatorGoalVersion {
  id            String      @id
  creatorGoalId String
  snapshot      Json
  changedAt     DateTime    @default(now())
  changedBy     String
  changeType    String
  CreatorGoal   CreatorGoal @relation(fields: [creatorGoalId], references: [id], onDelete: Cascade)

  @@index([changedBy])
  @@index([creatorGoalId, changedAt])
}

model CreatorInsight {
  id          String    @id
  creatorId   String
  insightType String
  title       String
  summary     String
  context     String?
  metadata    Json?
  priority    Int       @default(0)
  isRead      Boolean   @default(false)
  createdAt   DateTime  @default(now())
  expiresAt   DateTime?
  Talent      Talent    @relation(fields: [creatorId], references: [id], onDelete: Cascade)

  @@index([creatorId, createdAt])
  @@index([creatorId, isRead])
  @@index([insightType])
}

model CreatorTask {
  id                  String       @id
  creatorId           String
  title               String
  description         String?
  taskType            String
  dueAt               DateTime?
  completedAt         DateTime?
  priority            String       @default("medium")
  status              String       @default("pending")
  linkedDealId        String?
  linkedDeliverableId String?
  createdBy           String?
  createdAt           DateTime     @default(now())
  updatedAt           DateTime
  User                User?        @relation(fields: [createdBy], references: [id])
  Talent              Talent       @relation(fields: [creatorId], references: [id], onDelete: Cascade)
  Deal                Deal?        @relation(fields: [linkedDealId], references: [id])
  Deliverable         Deliverable? @relation(fields: [linkedDeliverableId], references: [id])

  @@index([creatorId, dueAt])
  @@index([creatorId, status])
  @@index([linkedDealId])
  @@index([priority])
}

model CrmBrand {
  id                   String            @id
  brandName            String
  website              String?
  industry             String            @default("Other")
  status               String            @default("Prospect")
  owner                String?
  internalNotes        String?
  activity             Json[]            @default([])
  lastActivityAt       DateTime?
  lastActivityLabel    String?
  createdAt            DateTime          @default(now())
  updatedAt            DateTime
  lifecycleStage       String?
  logo                 String?
  logoUrl              String? // Auto-imported logo URL
  about                String? // Enriched about text
  socialLinks          Json? // { instagram, linkedin, tiktok, etc. }
  enrichedAt           DateTime? // When enrichment was last run
  enrichmentSource     String? // e.g. "website", "manual"
  primaryContactId     String?
  relationshipStrength String?
  CrmBrandContact      CrmBrandContact[]
  CrmTask              CrmTask[]
  Outreach             Outreach[]

  @@unique([brandName])
  @@index([brandName])
  @@index([status])
}

model CrmBrandContact {
  id             String   @id
  crmBrandId     String
  firstName      String?
  lastName       String?
  email          String?
  phone          String?
  title          String?
  primaryContact Boolean  @default(false)
  notes          String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime
  CrmBrand       CrmBrand @relation(fields: [crmBrandId], references: [id], onDelete: Cascade)

  @@unique([email])
  @@index([crmBrandId])
  @@index([email])
}

model CrmCampaign {
  id                String    @id
  campaignName      String
  brandId           String
  campaignType      String    @default("Other")
  status            String    @default("Draft")
  startDate         DateTime?
  endDate           DateTime?
  internalSummary   String?
  goals             String?
  keyNotes          String?
  owner             String?
  linkedDealIds     String[]  @default([])
  linkedTalentIds   String[]  @default([])
  linkedTaskIds     String[]  @default([])
  linkedOutreachIds String[]  @default([])
  linkedEventIds    String[]  @default([])
  activity          Json[]    @default([])
  lastActivityAt    DateTime?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime
  Brand             Brand     @relation(fields: [brandId], references: [id], onDelete: Cascade)
  CrmTask           CrmTask[]

  @@index([brandId])
  @@index([lastActivityAt])
  @@index([owner])
  @@index([status])
}

model CrmTask {
  id               String       @id
  title            String
  status           String       @default("Pending")
  priority         String       @default("Medium")
  dueDate          DateTime?
  owner            String?
  brandId          String?
  dealId           String?
  campaignId       String?
  eventId          String?
  contractId       String?
  createdBy        String?
  createdAt        DateTime     @default(now())
  updatedAt        DateTime
  assignedUserIds  String[]     @default([])
  description      String?
  mentions         Json[]       @default([])
  ownerId          String?
  relatedBrands    String[]     @default([])
  relatedCampaigns String[]     @default([])
  relatedContracts String[]     @default([])
  relatedCreators  String[]     @default([])
  relatedDeals     String[]     @default([])
  relatedEvents    String[]     @default([])
  relatedUsers     String[]     @default([])
  CrmBrand         CrmBrand?    @relation(fields: [brandId], references: [id])
  CrmCampaign      CrmCampaign? @relation(fields: [campaignId], references: [id])
  CreatedByUser    User?        @relation("TaskCreatedBy", fields: [createdBy], references: [id])
  Owner            User?        @relation("TaskOwner", fields: [ownerId], references: [id])

  @@index([brandId])
  @@index([campaignId])
  @@index([contractId])
  @@index([createdBy])
  @@index([dealId])
  @@index([dueDate])
  @@index([eventId])
  @@index([owner])
  @@index([ownerId])
  @@index([priority])
  @@index([status])
}

model Deal {
  id                      String            @id
  userId                  String
  talentId                String
  brandId                 String
  stage                   DealStage         @default(NEW_LEAD)
  value                   Float?
  currency                String            @default("USD")
  brandName               String?
  campaignName            String? // Campaign or project name
  aiSummary               String?
  notes                   String?
  internalNotes           String? // Internal team notes
  expectedClose           DateTime?
  startDate               DateTime? // Deal/project start date
  endDate                 DateTime? // Deal/project end date
  platforms               String[]          @default([]) // TikTok, Instagram, YouTube, etc
  deliverables            String? // JSON or text description of deliverables
  invoiceStatus           String? // NOT_INVOICED, INVOICED, PAID
  paymentStatus           String? // UNPAID, PAID, PARTIAL
  createdAt               DateTime          @default(now())
  updatedAt               DateTime
  campaignLiveAt          DateTime?
  closedAt                DateTime?
  contractReceivedAt      DateTime?
  contractSignedAt        DateTime?
  deliverablesCompletedAt DateTime?
  negotiationStartedAt    DateTime?
  proposalSentAt          DateTime?
  opportunityId           String?           @unique
  Contract                Contract[]
  CreatorTask             CreatorTask[]
  Brand                   Brand             @relation(fields: [brandId], references: [id], onDelete: Cascade)
  SalesOpportunity        SalesOpportunity? @relation(fields: [opportunityId], references: [id])
  Talent                  Talent            @relation(fields: [talentId], references: [id], onDelete: Cascade)
  User                    User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  DealNegotiation         DealNegotiation?
  DealTimeline            DealTimeline[]
  Deliverable             Deliverable[]
  Invoice                 Invoice[]
  Payment                 Payment[]
  Payout                  Payout[]
  Commission              Commission[]
  InboundEmail            InboundEmail[]

  @@index([opportunityId])
}

model DealNegotiation {
  id           String   @id
  dealId       String   @unique
  status       String   @default("pending")
  offerTerms   Json?
  counterTerms Json?
  history      Json[]
  createdAt    DateTime @default(now())
  updatedAt    DateTime
  Deal         Deal     @relation(fields: [dealId], references: [id], onDelete: Cascade)
}

model DealTimeline {
  id          String   @id
  dealId      String
  type        String
  message     String
  metadata    Json?
  createdById String?
  createdAt   DateTime @default(now())
  User        User?    @relation(fields: [createdById], references: [id])
  Deal        Deal     @relation(fields: [dealId], references: [id], onDelete: Cascade)
}

model Deliverable {
  id              String        @id
  dealId          String
  title           String
  description     String?
  deliverableType String?
  usageRights     String?
  frequency       String?
  dueAt           DateTime?
  approvedAt      DateTime?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime
  CreatorTask     CreatorTask[]
  Deal            Deal          @relation(fields: [dealId], references: [id], onDelete: Cascade)
}

model DeliverableItem {
  id              String    @id
  dealId          String
  userId          String?
  title           String
  description     String?
  deliverableType String?
  platform        String?
  usageRights     String?
  frequency       String?
  dueDate         DateTime?
  dueAt           DateTime?
  approvedAt      DateTime?
  locked          Boolean?  @default(false)
  status          String    @default("pending")
  metadata        Json?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime

  @@index([dealId])
  @@index([status])
  @@index([userId])
}

model EmailFeedback {
  id                 String           @id
  userId             String
  emailOpportunityId String
  isRelevant         Boolean
  category           String
  confidence         Float
  createdAt          DateTime         @default(now())
  EmailOpportunity   EmailOpportunity @relation(fields: [emailOpportunityId], references: [id], onDelete: Cascade)
  User               User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([emailOpportunityId])
  @@index([userId])
}

model EmailOpportunity {
  id               String          @id
  userId           String
  gmailMessageId   String          @unique
  threadId         String
  subject          String
  from             String
  receivedAt       DateTime
  category         String
  confidence       Float
  brandName        String?
  opportunityType  String?
  deliverables     Json?
  dates            String?
  location         String?
  paymentDetails   String?
  contactEmail     String?
  isUrgent         Boolean         @default(false)
  status           String          @default("NEW")
  notes            String?
  isRelevant       Boolean?
  emailBody        String?
  suggestedActions Json?
  lastActionAt     DateTime?
  lastActionType   String?
  responseNotes    String?
  createdAt        DateTime        @default(now())
  updatedAt        DateTime
  EmailFeedback    EmailFeedback[]
  User             User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([isUrgent])
  @@index([receivedAt])
  @@index([userId, category])
  @@index([userId, status])
}

model File {
  id        String   @id
  userId    String?
  key       String
  url       String?
  filename  String
  type      String
  folder    String?
  size      Int?
  createdAt DateTime @default(now())
  updatedAt DateTime
  User      User?    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([folder])
  @@index([userId])
}

model FinanceActivityLog {
  id            String   @id
  actionType    String
  referenceType String
  referenceId   String
  amount        Float?
  currency      String?
  metadata      Json?
  createdBy     String?
  createdAt     DateTime @default(now())
  User          User?    @relation(fields: [createdBy], references: [id])

  @@index([actionType])
  @@index([createdAt])
  @@index([referenceId])
  @@index([referenceType])
}

model FinanceDocument {
  id         String   @id
  fileUrl    String
  fileName   String?
  fileType   String
  linkedType String
  linkedId   String
  uploadedBy String
  uploadedAt DateTime @default(now())
  User       User     @relation(fields: [uploadedBy], references: [id])

  @@index([linkedId])
  @@index([linkedType])
  @@index([uploadedBy])
}

model FinanceReconciliation {
  id          String   @id
  type        String
  referenceId String
  amount      Float
  currency    String   @default("USD")
  method      String?
  notes       String?
  confirmedAt DateTime
  createdBy   String
  createdAt   DateTime @default(now())
  User        User     @relation(fields: [createdBy], references: [id])

  @@index([confirmedAt])
  @@index([referenceId])
  @@index([type])
}

model GmailToken {
  userId            String    @id
  accessToken       String
  refreshToken      String
  expiryDate        DateTime?
  scope             String?
  tokenType         String?
  idToken           String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime
  lastSyncedAt      DateTime?
  lastError         String?
  lastErrorAt       DateTime?
  webhookExpiration DateTime?
  webhookHistoryId  String?
  User              User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model GoogleAccount {
  userId       String    @id
  email        String
  accessToken  String?
  refreshToken String?
  expiresAt    DateTime?
  scope        String?
  tokenType    String?
  idToken      String?
  lastSyncedAt DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  User         User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([email])
}

model InboundEmail {
  id                  String               @id
  userId              String?
  inboxMessageId      String?
  platform            String               @default("gmail") // "gmail", "instagram", "tiktok", "whatsapp"
  fromEmail           String
  toEmail             String
  subject             String?
  body                String?
  gmailId             String?              @unique
  instagramId         String?              @unique
  tiktokId            String?              @unique
  whatsappId          String?              @unique
  threadId            String?
  receivedAt          DateTime             @default(now())
  direction           String               @default("inbound")
  isRead              Boolean              @default(false)
  categories          String[]
  metadata            Json?
  aiSummary           String?
  aiCategory          String?
  aiUrgency           String?
  aiRecommendedAction String?
  aiConfidence        Float?
  aiJson              Json?
  snippet             String?
  dealId              String? // Explicit deal linkage
  talentId            String? // Explicit talent linkage
  brandId             String? // Explicit brand linkage (from metadata.crmBrandId)
  InboxMessage        InboxMessage?        @relation(fields: [inboxMessageId], references: [id], onDelete: Cascade)
  User                User?                @relation(fields: [userId], references: [id])
  Deal                Deal?                @relation(fields: [dealId], references: [id], onDelete: SetNull)
  Talent              Talent?              @relation(fields: [talentId], references: [id], onDelete: SetNull)
  TrackingPixelEvent  TrackingPixelEvent[]
  EmailClickEvent     EmailClickEvent[]

  @@index([receivedAt])
  @@index([threadId])
  @@index([userId])
  @@index([dealId])
  @@index([talentId])
  @@index([brandId])
  @@index([platform])
}

model InboxMessage {
  id              String           @id
  threadId        String           @unique
  userId          String
  platform        String           @default("gmail") // "gmail", "instagram", "tiktok", "whatsapp"
  subject         String?
  snippet         String?
  isRead          Boolean          @default(false)
  lastMessageAt   DateTime
  participants    String[]
  body            String?
  parsed          Json?
  receivedAt      DateTime         @default(now())
  sender          String?
  InboundEmail    InboundEmail[]
  InboxThreadMeta InboxThreadMeta?

  @@index([lastMessageAt])
  @@index([receivedAt])
  @@index([userId])
  @@index([platform])
}

model InboxThreadMeta {
  id              String       @id
  threadId        String       @unique
  userId          String
  aiThreadSummary String?
  unreadCount     Int          @default(0)
  priority        Int          @default(0)
  lastMessageAt   DateTime?
  linkedDealId    String?
  InboxMessage    InboxMessage @relation(fields: [threadId], references: [threadId])
}

model Invoice {
  id            String       @id @default(cuid())
  dealId        String
  amount        Float
  status        String       @default("draft")
  issuedAt      DateTime
  dueAt         DateTime
  paidAt        DateTime?
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  brandId       String?
  currency      String       @default("USD")
  invoiceNumber String       @unique
  externalId    String?      @unique // External invoice ID (Xero, etc.)
  xeroId        String?      @unique // Xero invoice ID (external reference)
  xeroSyncError String? // Last sync error message
  lastSyncedAt  DateTime? // Last successful sync with Xero
  provider      String? // Payment provider (stripe, paypal, etc.)
  userId        String? // User ID for the invoice creator
  brandEmail    String? // Brand email address
  brandName     String? // Brand name
  processedAt   DateTime? // When payment was processed
  metadata      Json? // Additional metadata
  Brand         Brand?       @relation(fields: [brandId], references: [id])
  Deal          Deal         @relation(fields: [dealId], references: [id], onDelete: Cascade)
  Commission    Commission[]

  @@index([brandId])
  @@index([dealId])
  @@index([dueAt])
  @@index([xeroId])
  @@index([externalId])
  @@index([status])
}

// STATUS: UNUSED
// Legacy lead capture - replaced by CrmBrand and Outreach
model Lead {
  id         String   @id
  email      String   @unique
  brandEmail String?
  name       String?
  brandName  String?
  company    String?
  status     String   @default("new")
  metadata   Json?
  createdAt  DateTime @default(now())
  updatedAt  DateTime

  @@index([status])
}

model Notification {
  id        String   @id
  userId    String
  title     String
  body      String?
  type      String
  entityId  String?
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Opportunity {
  id                     String                   @id
  brand                  String
  location               String
  title                  String
  deliverables           String
  payment                String
  deadline               String
  status                 String                   @default("Live brief Â· Login required to apply")
  image                  String
  logo                   String
  type                   String
  isActive               Boolean                  @default(true)
  createdBy              String
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime
  OpportunityApplication OpportunityApplication[]
  Submission             Submission[]

  @@index([createdBy])
  @@index([isActive, createdAt])
}

model OpportunityApplication {
  id            String      @id
  opportunityId String
  creatorId     String
  status        String      @default("pending")
  pitch         String?
  proposedRate  Float?
  appliedAt     DateTime    @default(now())
  reviewedAt    DateTime?
  notes         String?
  User          User        @relation(fields: [creatorId], references: [id], onDelete: Cascade)
  Opportunity   Opportunity @relation(fields: [opportunityId], references: [id], onDelete: Cascade)

  @@unique([opportunityId, creatorId])
  @@index([creatorId, status])
  @@index([opportunityId, status])
}

model Outreach {
  id                                  String                @id
  target                              String
  type                                String                @default("Brand")
  contact                             String?
  contactEmail                        String?
  link                                String?
  owner                               String?
  source                              String?
  stage                               String                @default("not-started")
  status                              String                @default("Not started")
  summary                             String?
  threadUrl                           String?
  gmailThreadId                       String?
  emailsSent                          Int                   @default(0)
  emailsReplies                       Int                   @default(0)
  lastContact                         DateTime?
  nextFollowUp                        DateTime?
  reminder                            String?
  opportunityRef                      String?
  archived                            Boolean               @default(false)
  linkedCreatorId                     String?
  linkedBrandId                       String?
  createdBy                           String
  createdAt                           DateTime              @default(now())
  updatedAt                           DateTime
  linkedCrmBrandId                    String?
  User_Outreach_createdByToUser       User                  @relation("Outreach_createdByToUser", fields: [createdBy], references: [id], onDelete: Cascade)
  Brand                               Brand?                @relation(fields: [linkedBrandId], references: [id])
  User_Outreach_linkedCreatorIdToUser User?                 @relation("Outreach_linkedCreatorIdToUser", fields: [linkedCreatorId], references: [id])
  CrmBrand                            CrmBrand?             @relation(fields: [linkedCrmBrandId], references: [id])
  OutreachEmailThread                 OutreachEmailThread[]
  OutreachNote                        OutreachNote[]
  OutreachTask                        OutreachTask[]
  SalesOpportunity                    SalesOpportunity?

  @@index([archived])
  @@index([createdBy])
  @@index([gmailThreadId])
  @@index([linkedBrandId])
  @@index([linkedCreatorId])
  @@index([linkedCrmBrandId])
  @@index([nextFollowUp])
  @@index([stage])
}

model OutreachAction {
  id           String    @id
  sequenceId   String
  stepId       String?
  leadId       String?
  actionType   String
  status       String    @default("pending")
  errorMessage String?
  scheduledAt  DateTime?
  executedAt   DateTime?
  runAt        DateTime?
  metadata     Json?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime

  @@index([scheduledAt])
  @@index([sequenceId])
  @@index([status])
}

model OutreachEmailThread {
  id            String   @id
  outreachId    String
  gmailThreadId String   @unique
  lastMessageAt DateTime
  status        String   @default("awaiting_reply")
  lastSyncedAt  DateTime @default(now())
  createdAt     DateTime @default(now())
  updatedAt     DateTime
  Outreach      Outreach @relation(fields: [outreachId], references: [id], onDelete: Cascade)

  @@index([gmailThreadId])
  @@index([outreachId])
  @@index([status])
}

model OutreachNote {
  id         String   @id
  outreachId String
  author     String
  body       String
  createdAt  DateTime @default(now())
  Outreach   Outreach @relation(fields: [outreachId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([outreachId])
}

model OutreachSequence {
  id        String   @id
  leadId    String
  name      String
  status    String   @default("active")
  metadata  Json?
  createdAt DateTime @default(now())
  updatedAt DateTime

  @@index([leadId])
  @@index([status])
}

model OutreachStep {
  id         String   @id
  sequenceId String
  stepNumber Int
  actionType String
  delay      Int?
  template   String?
  metadata   Json?
  createdAt  DateTime @default(now())
  updatedAt  DateTime

  @@index([sequenceId])
}

model OutreachTask {
  id         String    @id
  outreachId String
  title      String
  dueDate    DateTime?
  owner      String?
  priority   String    @default("Medium")
  status     String    @default("Open")
  createdAt  DateTime  @default(now())
  updatedAt  DateTime
  Outreach   Outreach  @relation(fields: [outreachId], references: [id], onDelete: Cascade)

  @@index([dueDate])
  @@index([outreachId])
  @@index([status])
}

model Payment {
  id                    String    @id
  dealId                String
  talentId              String?
  amount                Float
  status                String    @default("PENDING")
  expectedPaymentDate   DateTime?
  actualPaymentDate     DateTime?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime
  currency              String?   @default("usd")
  metadata              Json?
  stripePaymentIntentId String?   @unique
  Deal                  Deal      @relation(fields: [dealId], references: [id], onDelete: Cascade)
  Talent                Talent?   @relation(fields: [talentId], references: [id])

  @@index([status])
  @@index([stripePaymentIntentId])
}

model Commission {
  id           String    @id
  dealId       String
  invoiceId    String?
  talentId     String
  agentId      String? // Agent who managed the deal
  amount       Float // Commission amount
  percentage   Float // Commission percentage (e.g., 15.0 for 15%)
  currency     String    @default("USD")
  status       String    @default("pending") // pending, approved, paid
  payoutId     String? // Linked payout when commission is paid
  calculatedAt DateTime  @default(now())
  approvedAt   DateTime?
  paidAt       DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime
  Deal         Deal      @relation(fields: [dealId], references: [id], onDelete: Cascade)
  Invoice      Invoice?  @relation(fields: [invoiceId], references: [id], onDelete: SetNull)
  Talent       Talent    @relation(fields: [talentId], references: [id], onDelete: Cascade)
  Payout       Payout?   @relation(fields: [payoutId], references: [id], onDelete: SetNull)
  User         User?     @relation(fields: [agentId], references: [id], onDelete: SetNull)

  @@index([dealId])
  @@index([invoiceId])
  @@index([talentId])
  @@index([agentId])
  @@index([payoutId])
  @@index([status])
  @@index([calculatedAt])
}

model Payout {
  id               String       @id
  userId           String?
  referenceId      String?      @unique
  creatorId        String
  dealId           String
  brandId          String?
  amount           Float
  currency         String       @default("USD")
  status           String       @default("pending")
  expectedPayoutAt DateTime?
  paidAt           DateTime?
  createdBy        String?
  createdAt        DateTime     @default(now())
  updatedAt        DateTime
  Brand            Brand?       @relation(fields: [brandId], references: [id])
  User             User?        @relation(fields: [createdBy], references: [id])
  Talent           Talent       @relation(fields: [creatorId], references: [id], onDelete: Cascade)
  Deal             Deal         @relation(fields: [dealId], references: [id], onDelete: Cascade)
  Commission       Commission[] // One payout can cover multiple commissions

  @@index([brandId])
  @@index([creatorId])
  @@index([dealId])
  @@index([expectedPayoutAt])
  @@index([referenceId])
  @@index([status])
  @@index([userId])
}

model Resource {
  id               String             @id
  title            String
  shortDescription String
  longDescription  String?
  resourceType     ResourceType
  uploadUrl        String?
  externalUrl      String?
  thumbnailUrl     String?
  status           ResourceStatus     @default(DRAFT)
  visibility       ResourceVisibility @default(PUBLIC)
  allowedAudiences String[]           @default([])
  metadata         Json?
  eventDate        DateTime?
  eventTime        String?
  hasReplay        Boolean?
  rsvpEnabled      Boolean            @default(false)
  rsvpOpen         Boolean            @default(true)
  viewCount        Int                @default(0)
  createdById      String
  createdAt        DateTime           @default(now())
  updatedAt        DateTime
  uploadFilename   String?
  uploadFileType   String?
  uploadFileSize   Int?
  User             User               @relation(fields: [createdById], references: [id], onDelete: Cascade)
  ResourceRsvp     ResourceRsvp[]

  @@index([createdById])
  @@index([resourceType])
  @@index([status])
  @@index([visibility])
}

model ResourceRsvp {
  id         String   @id
  resourceId String
  userId     String
  status     String   @default("confirmed")
  createdAt  DateTime @default(now())
  updatedAt  DateTime
  Resource   Resource @relation(fields: [resourceId], references: [id], onDelete: Cascade)
  User       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([resourceId, userId])
  @@index([resourceId])
  @@index([userId])
}

// STATUS: UNUSED
// Risk scoring system - not currently wired to any workflows
model RiskEvent {
  id         String   @id
  userId     String?
  entityType String
  entityId   String
  riskScore  Int
  riskFlags  String[]
  details    Json?
  createdAt  DateTime @default(now())
  User       User?    @relation(fields: [userId], references: [id])
}

model SalesOpportunity {
  id              String    @id
  outreachId      String    @unique
  name            String
  value           Float
  currency        String    @default("USD")
  expectedCloseAt DateTime?
  status          String    @default("open")
  notes           String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime
  Deal            Deal?
  Outreach        Outreach  @relation(fields: [outreachId], references: [id], onDelete: Cascade)

  @@index([expectedCloseAt])
  @@index([outreachId])
  @@index([status])
}

model SignatureRequest {
  id           String    @id
  userId       String
  contractId   String?
  documentUrl  String
  signerEmail  String
  signedPdfUrl String?
  status       String    @default("pending")
  signedAt     DateTime?
  metadata     Json?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime

  @@index([contractId])
  @@index([signerEmail])
  @@index([status])
  @@index([userId])
}

model SocialAccountConnection {
  id             String          @id
  creatorId      String
  platform       String
  handle         String
  profileUrl     String? // URL or profile link (for validation/display)
  connected      Boolean         @default(false)
  connectionType String          @default("MANUAL") // MANUAL or OAUTH
  syncStatus     String          @default("PENDING") // PENDING, SYNCING, READY, ERROR
  accessToken    String?
  refreshToken   String?
  expiresAt      DateTime?
  lastSyncedAt   DateTime?
  syncError      String? // Error message if sync fails
  metadata       Json?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime
  Talent         Talent          @relation(fields: [creatorId], references: [id], onDelete: Cascade)
  SocialProfile  SocialProfile?
  SocialSyncLog  SocialSyncLog[]

  @@unique([creatorId, platform])
  @@index([creatorId, connected])
  @@index([syncStatus])
  @@index([platform])
}

model SocialProfile {
  id                String                  @id @default(cuid())
  connectionId      String                  @unique
  platform          String
  handle            String
  displayName       String?
  bio               String?
  profileImageUrl   String?
  followerCount     Int                     @default(0)
  followingCount    Int?
  postCount         Int?
  averageViews      Float?
  averageEngagement Float?
  engagementRate    Float?
  isVerified        Boolean                 @default(false)
  externalId        String?
  lastSyncedAt      DateTime?
  createdAt         DateTime                @default(now())
  updatedAt         DateTime
  metrics           SocialMetric[]
  posts             SocialPost[]
  connection        SocialAccountConnection @relation(fields: [connectionId], references: [id], onDelete: Cascade)

  @@index([platform, handle])
  @@index([connectionId])
}

model SocialPost {
  id             String        @id @default(cuid())
  profileId      String
  platform       String
  externalId     String
  caption        String?
  mediaType      String
  mediaUrl       String?
  thumbnailUrl   String?
  permalink      String?
  viewCount      Int?
  likeCount      Int?
  commentCount   Int?
  shareCount     Int?
  saveCount      Int?
  engagementRate Float?
  postedAt       DateTime
  lastSyncedAt   DateTime?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime
  profile        SocialProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@unique([platform, externalId])
  @@index([profileId, postedAt])
  @@index([platform, postedAt])
}

model SocialMetric {
  id           String        @id @default(cuid())
  profileId    String
  platform     String
  metricType   String
  value        Float
  snapshotDate DateTime      @default(now())
  metadata     Json?
  createdAt    DateTime      @default(now())
  profile      SocialProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([profileId, snapshotDate])
  @@index([metricType, snapshotDate])
}

model SocialSyncLog {
  id             String                  @id @default(cuid())
  connectionId   String
  platform       String
  syncType       String
  status         String
  itemsSynced    Int                     @default(0)
  errorMessage   String?
  errorCode      String?
  rateLimitHit   Boolean                 @default(false)
  rateLimitReset DateTime?
  startedAt      DateTime
  completedAt    DateTime?
  duration       Int?
  createdAt      DateTime                @default(now())
  connection     SocialAccountConnection @relation(fields: [connectionId], references: [id], onDelete: Cascade)

  @@index([connectionId, createdAt])
  @@index([platform, status])
  @@index([rateLimitHit])
}

model Submission {
  id            String       @id
  creatorId     String
  opportunityId String?
  title         String
  platform      String
  status        String       @default("draft")
  contentUrl    String?
  files         Json?
  revisions     Json?
  feedback      String?
  submittedAt   DateTime?
  approvedAt    DateTime?
  createdAt     DateTime     @default(now())
  updatedAt     DateTime
  User          User         @relation(fields: [creatorId], references: [id], onDelete: Cascade)
  Opportunity   Opportunity? @relation(fields: [opportunityId], references: [id])

  @@index([createdAt])
  @@index([creatorId, status])
  @@index([opportunityId])
}

model SuitabilityResult {
  id         String   @id
  creatorId  String
  brandId    String
  score      Int      @default(0)
  flags      String[]
  categories String[]
  reasoning  Json?
  aiSummary  String?
  createdAt  DateTime @default(now())
  Brand      Brand    @relation(fields: [brandId], references: [id], onDelete: Cascade)
  Talent     Talent   @relation(fields: [creatorId], references: [id], onDelete: Cascade)
}

model Talent {
  id                      String                    @id
  userId                  String                    @unique
  name                    String
  displayName             String? // Display name for UI
  legalName               String? // Legal name for contracts
  primaryEmail            String? // Primary contact email
  representationType      String? // EXCLUSIVE, NON_EXCLUSIVE, FRIEND_OF_HOUSE, UGC, FOUNDER
  status                  String? // ACTIVE, PAUSED, ARCHIVED
  managerId               String? // Admin manager ID (deprecated - use TalentManagerAssignment instead)
  currency                String                    @default("GBP") // Currency code: GBP, USD, EUR, AED, etc.
  notes                   String? // Internal notes
  categories              String[]
  stage                   String?
  profileImageUrl         String? // Auto-fetched social profile image URL
  profileImageSource      String                    @default("initials") // instagram | tiktok | youtube | manual | initials
  lastProfileImageSyncAt  DateTime? // Timestamp of last profile image sync
  socialIntelligenceNotes String? // Agent strategic notes on social intelligence
  analyticsNotes          String? // Admin notes from analytics dashboard
  comparisonNotes         String? // Comparison notes vs other profiles (stored as JSON)
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime                  @updatedAt
  AIPromptHistory         AIPromptHistory[]
  BrandSavedTalent        BrandSavedTalent[]
  CreatorEvent            CreatorEvent[]
  CreatorFitScore         CreatorFitScore[]
  CreatorGoal             CreatorGoal[]
  CreatorInsight          CreatorInsight[]
  CreatorTask             CreatorTask[]
  Deal                    Deal[]
  Payment                 Payment[]
  Payout                  Payout[]
  Commission              Commission[]
  InboundEmail            InboundEmail[]
  SocialAccountConnection SocialAccountConnection[]
  SuitabilityResult       SuitabilityResult[]
  User                    User                      @relation(fields: [userId], references: [id], onDelete: Cascade)
  TalentAssignment        TalentAssignment[]
  WellnessCheckin         WellnessCheckin[]
  TalentEmail             TalentEmail[]
  TalentTask              TalentTask[]
  TalentSocial            TalentSocial[]
  UserAccess              TalentUserAccess[]        @relation("TalentAccess")
  RevenueSource           RevenueSource[]
  RevenueGoal             RevenueGoal[]
  CommunityConnections    CommunityConnection[]
  ManagerAssignments      TalentManagerAssignment[] @relation("TalentManagers")

  @@index([lastProfileImageSyncAt])
  @@index([profileImageSource])
  @@index([currency])
}

model TalentEmail {
  id        String   @id @default(cuid())
  talentId  String
  email     String
  label     String? // e.g. "Manager", "Assistant", "Personal"
  isPrimary Boolean  @default(false)
  verified  Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  talent Talent @relation(fields: [talentId], references: [id], onDelete: Cascade)

  @@unique([talentId, email])
  @@index([talentId])
  @@index([email])
}

// Manager assignment - allows multiple managers per talent
model TalentManagerAssignment {
  id        String   @id @default(cuid())
  talentId  String
  managerId String
  role      String   @default("SECONDARY") // PRIMARY or SECONDARY manager
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  talent  Talent @relation("TalentManagers", fields: [talentId], references: [id], onDelete: Cascade)
  manager User   @relation("ManagerAssignments", fields: [managerId], references: [id], onDelete: Cascade)

  @@unique([talentId, managerId])
  @@index([talentId])
  @@index([managerId])
  @@index([role])
}

enum TaskStatus {
  PENDING
  COMPLETED
  CANCELLED
}

model TalentTask {
  id          String     @id @default(cuid())
  talentId    String
  title       String
  notes       String?
  dueDate     DateTime?
  status      TaskStatus @default(PENDING)
  createdBy   String
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  completedAt DateTime?

  talent Talent @relation(fields: [talentId], references: [id], onDelete: Cascade)

  @@index([talentId])
  @@index([status])
  @@index([dueDate])
}

model TalentSocial {
  id              String         @id @default(cuid())
  talentId        String
  platform        SocialPlatform
  handle          String
  url             String
  followers       Int?
  following       Int?
  postCount       Int?
  displayName     String?
  profileImageUrl String?
  verified        Boolean        @default(false)
  lastScrapedAt   DateTime?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  talent Talent @relation(fields: [talentId], references: [id], onDelete: Cascade)

  @@unique([talentId, platform, handle])
  @@index([talentId])
  @@index([platform])
}

model TalentAssignment {
  id        String   @id
  agentId   String
  talentId  String
  createdAt DateTime @default(now())
  User      User     @relation(fields: [agentId], references: [id], onDelete: Cascade)
  Talent    Talent   @relation(fields: [talentId], references: [id], onDelete: Cascade)

  @@unique([agentId, talentId])
}

model TalentUserAccess {
  id        String   @id @default(cuid())
  talentId  String
  userId    String
  role      String   @default("VIEW") // VIEW | MANAGE
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  Talent Talent @relation("TalentAccess", fields: [talentId], references: [id], onDelete: Cascade)
  User   User   @relation("TalentAccessGiven", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([talentId, userId])
  @@index([talentId])
  @@index([userId])
}

model TrackingPixelEvent {
  id           String       @id
  emailId      String
  openedAt     DateTime     @default(now())
  ip           String?
  userAgent    String?
  metadata     Json?
  InboundEmail InboundEmail @relation(fields: [emailId], references: [id], onDelete: Cascade)

  @@index([emailId])
  @@index([openedAt])
}

model EmailClickEvent {
  id           String       @id
  emailId      String
  clickedAt    DateTime     @default(now())
  linkUrl      String // The URL that was clicked
  ip           String?
  userAgent    String?
  metadata     Json?
  InboundEmail InboundEmail @relation(fields: [emailId], references: [id], onDelete: Cascade)

  @@index([emailId])
  @@index([clickedAt])
}

model User {
  id                                      String                    @id
  email                                   String                    @unique
  password                                String?
  name                                    String?
  avatarUrl                               String?
  createdAt                               DateTime                  @default(now())
  updatedAt                               DateTime
  accountType                             String?
  admin_notes                             String?
  bio                                     String?
  creator_score                           Int?
  creator_score_reason                    Json?
  friends_of_house_id                     String?
  include_in_roster                       Boolean                   @default(false)
  location                                String?
  managedTalentIds                        String[]                  @default([])
  onboardingComplete                      Boolean?                  @default(false)
  onboardingSkippedAt                     DateTime?
  onboarding_responses                    Json?
  onboarding_status                       String?                   @default("pending_review")
  pronouns                                String?
  role                                    String                    @default("CREATOR")
  role_recommended                        String?
  roster_category                         String?
  socialLinks                             Json?
  status                                  String?
  subscriptionStatus                      String?                   @default("free")
  timezone                                String?
  ugcApproved                             Boolean                   @default(false)
  ugcRates                                Json?
  ugc_categories                          String[]                  @default([])
  ugc_portfolio_url                       String?
  upgrade_suggested                       Boolean?                  @default(false)
  resetToken                              String?
  resetTokenExpiry                        DateTime?
  AgentProfile                            AgentProfile?
  AgentPolicy                             AgentPolicy?
  AiTokenLog                              AiTokenLog[]
  ApprovalsCreated                        Approval[]                @relation("ApprovalRequestor")
  ApprovalsHandled                        Approval[]                @relation("ApprovalApprover")
  AuditLog                                AuditLog[]
  BrandCampaign                           BrandCampaign[]
  CalendarEventsCreated                   CalendarEvent[]           @relation("CalendarEventCreator")
  CreatorEvent                            CreatorEvent[]
  CreatorTask                             CreatorTask[]
  CrmTasksCreated                         CrmTask[]                 @relation("TaskCreatedBy")
  CrmTasksOwned                           CrmTask[]                 @relation("TaskOwner")
  Deal                                    Deal[]
  DealTimeline                            DealTimeline[]
  EmailFeedback                           EmailFeedback[]
  EmailOpportunity                        EmailOpportunity[]
  File                                    File[]
  FinanceActivityLog                      FinanceActivityLog[]
  FinanceDocument                         FinanceDocument[]
  FinanceReconciliation                   FinanceReconciliation[]
  GmailToken                              GmailToken?
  GoogleAccount                           GoogleAccount?
  InboundEmail                            InboundEmail[]
  InternalTasksAssigned                   InternalQueueTask[]       @relation("InternalTaskAssignedTo")
  InternalTasksCreated                    InternalQueueTask[]       @relation("InternalTaskCreatedBy")
  Notification                            Notification[]
  OpportunityApplication                  OpportunityApplication[]
  Outreach_Outreach_createdByToUser       Outreach[]                @relation("Outreach_createdByToUser")
  Outreach_Outreach_linkedCreatorIdToUser Outreach[]                @relation("Outreach_linkedCreatorIdToUser")
  Payout                                  Payout[]
  Commission                              Commission[]
  Resource                                Resource[]
  ResourceRsvp                            ResourceRsvp[]
  RiskEvent                               RiskEvent[]
  Submission                              Submission[]
  Talent                                  Talent?
  TalentAssignment                        TalentAssignment[]
  TalentAccessGiven                       TalentUserAccess[]        @relation("TalentAccessGiven")
  ManagerAssignments                      TalentManagerAssignment[] @relation("ManagerAssignments")
  PageBlockCreatedBy                      PageBlock[]               @relation("PageBlockCreatedBy")
  PageBlockDraftCreatedBy                 PageBlockDraft[]          @relation("PageBlockDraftCreatedBy")
  UGCRequests                             UGCRequest[]              @relation("UGCRequests")
  DealDrafts                              DealDraft[]               @relation("DealDrafts")
  OutreachPlans                           OutreachPlan[]            @relation("OutreachPlans")
  UGCListings                             UGCListing[]              @relation("UGCListings")
  IntegrationConnection                   IntegrationConnection[]
  XeroConnections                         XeroConnection[]
  ExportSchedules                         ExportSchedule[]
  UserDashboardConfigs                    UserDashboardConfig[]
  BrandUsers                              BrandUser[]
}

model WellnessCheckin {
  id          String   @id
  creatorId   String
  energyLevel Int
  workload    String
  notes       String?
  createdAt   DateTime @default(now())
  Talent      Talent   @relation(fields: [creatorId], references: [id], onDelete: Cascade)

  @@index([creatorId, createdAt])
}

model XeroConnection {
  id           String    @id
  userId       String? // Link to user if applicable
  connected    Boolean   @default(false)
  tenantId     String?
  accessToken  String?
  refreshToken String?
  expiresAt    DateTime?
  lastSyncedAt DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime
  User         User?     @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([userId])
}

// V1.1: Integration Connection Model for Slack, Notion, Google Drive
model IntegrationConnection {
  id            String    @id @default(cuid())
  userId        String
  platform      String // "slack", "notion", "google_drive"
  connected     Boolean   @default(false)
  accessToken   String?
  refreshToken  String?
  expiresAt     DateTime?
  webhookUrl    String? // For Slack webhooks
  workspaceId   String? // For Notion workspace
  workspaceName String? // For Notion workspace name
  metadata      Json? // Platform-specific data
  lastSyncedAt  DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  User          User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, platform])
  @@index([userId, connected])
  @@index([platform])
}

model BrandSavedTalent {
  id        String   @id
  brandId   String
  talentId  String
  status    String   @default("saved")
  notes     String?
  addedAt   DateTime @default(now())
  updatedAt DateTime @updatedAt
  Brand     Brand    @relation(fields: [brandId], references: [id], onDelete: Cascade)
  Talent    Talent   @relation(fields: [talentId], references: [id], onDelete: Cascade)

  @@unique([brandId, talentId])
  @@index([brandId, status])
  @@index([talentId])
}

// Phase 5: BrandBrief model for briefs feature
model BrandBrief {
  id             String       @id
  brandId        String
  title          String
  description    String?
  deliverables   String[]
  budget         String?
  deadline       DateTime?
  status         String       @default("draft") // draft, published, closed
  createdBy      String
  versionHistory Json[]       @default([])
  metadata       Json?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  BriefMatch     BriefMatch[]

  @@index([brandId])
  @@index([status])
  @@index([createdBy])
}

// Phase 5: BriefMatch model for matching briefs to creators
model BriefMatch {
  id         String     @id
  briefId    String
  creatorId  String
  matchScore Float
  status     String     @default("pending") // pending, accepted, rejected
  notes      String?
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt
  Brief      BrandBrief @relation(fields: [briefId], references: [id], onDelete: Cascade)

  @@unique([briefId, creatorId])
  @@index([briefId])
  @@index([creatorId])
  @@index([status])
}

// Phase 5: OutreachLead model
model OutreachLead {
  id                    String   @id
  brandName             String
  contactName           String?
  contactEmail          String?
  contactPhone          String?
  website               String?
  industry              String?
  status                String   @default("new") // new, contacted, qualified, converted, lost
  source                String?
  notes                 String?
  convertedToOutreachId String?
  createdBy             String
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  @@index([status])
  @@index([createdBy])
  @@index([convertedToOutreachId])
}

// Phase 5: CreatorWeeklyReport model
model CreatorWeeklyReport {
  id            String   @id
  creatorId     String
  weekStartDate DateTime
  weekEndDate   DateTime
  summary       String?
  metrics       Json?
  highlights    String[]
  challenges    String[]
  nextWeekGoals String[]
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@unique([creatorId, weekStartDate])
  @@index([creatorId])
  @@index([weekStartDate])
}

// Phase 5: DealIntelligence model
model DealIntelligence {
  id               String   @id
  dealId           String   @unique
  summary          String?
  riskFlags        String[]
  performanceNotes String[]
  insights         Json?
  generatedAt      DateTime @default(now())
  updatedAt        DateTime @updatedAt

  @@index([dealId])
}

// Phase 5: Bundle model
model Bundle {
  id           String   @id
  name         String
  description  String?
  priceMin     Float?
  priceMax     Float?
  deliverables Json?
  dealId       String?
  creatorId    String?
  status       String   @default("active") // active, archived
  createdBy    String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([dealId])
  @@index([creatorId])
  @@index([status])
}

model CreatorFitScore {
  id                 String   @id
  brandId            String
  talentId           String
  campaignId         String?
  totalScore         Int      @default(0)
  audienceScore      Int      @default(0)
  engagementScore    Int      @default(0)
  historyScore       Int      @default(0)
  categoryScore      Int      @default(0)
  explanation        String?
  calculationDetails Json?
  createdAt          DateTime @default(now())
  Brand              Brand    @relation(fields: [brandId], references: [id], onDelete: Cascade)
  Talent             Talent   @relation(fields: [talentId], references: [id], onDelete: Cascade)

  @@index([brandId, totalScore])
  @@index([talentId])
  @@index([campaignId])
}

enum DealStage {
  NEW_LEAD
  NEGOTIATION
  CONTRACT_SENT
  CONTRACT_SIGNED
  DELIVERABLES_IN_PROGRESS
  PAYMENT_PENDING
  PAYMENT_RECEIVED
  COMPLETED
  LOST
}

enum ResourceStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum ResourceType {
  TEMPLATE
  GUIDE
  ARTICLE
  WEBINAR
  EVENT
}

enum ResourceVisibility {
  PUBLIC
  PROTECTED
}

enum SocialPlatform {
  TIKTOK
  INSTAGRAM
  YOUTUBE
  X
  LINKEDIN
  FACEBOOK
  GMAIL
}

// ============================================
// CMS: Block-Based Content Management
// ============================================

enum PageRoleScope {
  PUBLIC
  CREATOR
  FOUNDER
  ADMIN
}

enum BlockType {
  HERO
  TEXT
  IMAGE
  SPLIT
  ANNOUNCEMENT
  SPACER
}

model Page {
  id        String           @id @default(cuid())
  slug      String           @unique
  title     String
  roleScope PageRoleScope    @default(PUBLIC)
  isActive  Boolean          @default(true)
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
  blocks    PageBlock[]
  drafts    PageBlockDraft[]

  @@index([slug])
  @@index([roleScope])
  @@index([isActive])
}

model PageBlock {
  id          String    @id @default(cuid())
  pageId      String
  blockType   BlockType
  contentJson Json // Validated per block type
  order       Int       @default(0)
  isVisible   Boolean   @default(true)
  createdBy   String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  Page        Page      @relation(fields: [pageId], references: [id], onDelete: Cascade)
  CreatedBy   User?     @relation("PageBlockCreatedBy", fields: [createdBy], references: [id], onDelete: SetNull)

  @@index([pageId])
  @@index([pageId, order])
  @@index([blockType])
}

// Draft state for preview mode (optional, can use isPublished flag on PageBlock if preferred)
model PageBlockDraft {
  id          String    @id @default(cuid())
  pageId      String
  blockId     String? // null for new blocks
  blockType   BlockType
  contentJson Json
  order       Int
  isVisible   Boolean   @default(true)
  createdBy   String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  Page        Page      @relation(fields: [pageId], references: [id], onDelete: Cascade)
  CreatedBy   User?     @relation("PageBlockDraftCreatedBy", fields: [createdBy], references: [id], onDelete: SetNull)

  @@index([pageId])
  @@index([pageId, order])
}

// Missing models - added for TypeScript compatibility
model UGCRequest {
  id        String    @id @default(cuid())
  userId    String
  status    String    @default("pending")
  brief     String?
  budget    Float?
  deadline  DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  User      User      @relation("UGCRequests", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
}

model DealDraft {
  id        String   @id @default(cuid())
  userId    String
  dealId    String?
  data      Json?
  status    String   @default("draft")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  User      User     @relation("DealDrafts", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([dealId])
  @@index([status])
}

model OutreachPlan {
  id        String   @id @default(cuid())
  userId    String
  name      String
  targets   Json?
  status    String   @default("draft")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  User      User     @relation("OutreachPlans", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
}

model BrandIntelligence {
  id        String   @id @default(cuid())
  brandId   String
  insights  Json?
  category  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([brandId])
  @@index([category])
}

model NegotiationInsight {
  id        String   @id @default(cuid())
  dealId    String
  insight   String?
  metadata  Json?
  createdAt DateTime @default(now())

  @@index([dealId])
}

model UGCListing {
  id          String   @id @default(cuid())
  userId      String
  title       String
  description String?
  rate        Float?
  status      String   @default("active")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  User        User     @relation("UGCListings", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
}

model Reconciliation {
  id          String   @id @default(cuid())
  type        String
  referenceId String
  invoiceId   String?  @unique
  amount      Float
  status      String   @default("pending")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([referenceId])
  @@index([type])
}

model RevenueSource {
  id                String    @id @default(cuid())
  talentId          String
  platform          String // SHOPIFY, TIKTOK_SHOP, LTK, AMAZON, CUSTOM
  displayName       String // e.g. "The Break Store", "Glow Up Shop"
  externalAccountId String? // Platform-specific account ID (encrypted in future)
  status            String    @default("CONNECTED") // CONNECTED, DISCONNECTED, ERROR, PAUSED
  apiKeyHash        String? // Hashed API key for validation (never store plain)
  lastSyncedAt      DateTime? // Last time we pulled revenue data
  syncError         String? // Error message from last sync attempt
  metadata          Json? // Platform-specific config (store ID, API endpoint, etc.)
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  Talent       Talent         @relation(fields: [talentId], references: [id], onDelete: Cascade)
  RevenueEvent RevenueEvent[]

  @@unique([talentId, platform, externalAccountId])
  @@index([talentId])
  @@index([platform])
  @@index([status])
  @@index([talentId, platform]) // For finding all Shopify stores for a talent
}

model RevenueEvent {
  id              String   @id @default(cuid())
  revenueSourceId String
  date            DateTime // Date the revenue occurred
  grossAmount     Float // Gross/total revenue
  netAmount       Float // Net after fees/commissions
  currency        String   @default("GBP") // Always store with currency
  type            String // SALE, COMMISSION, REFUND, PAYOUT, OTHER
  sourceReference String? // Platform transaction ID (for deduplication)
  metadata        Json? // Platform-specific data
  createdAt       DateTime @default(now())

  RevenueSource RevenueSource @relation(fields: [revenueSourceId], references: [id], onDelete: Cascade)

  @@unique([revenueSourceId, sourceReference]) // Prevent duplicate transactions
  @@index([revenueSourceId])
  @@index([date])
  @@index([type])
  @@index([revenueSourceId, date]) // For aggregation queries
}

model RevenueGoal {
  id           String   @id @default(cuid())
  talentId     String
  goalType     String // MONTHLY_TOTAL, QUARTERLY_TOTAL, ANNUAL_TOTAL, PLATFORM_SPECIFIC
  platform     String? // NULL for total, or SHOPIFY, TIKTOK_SHOP, etc. for platform-specific
  targetAmount Float
  currency     String   @default("GBP")
  timeframe    Json // { startDate, endDate } for custom periods
  notes        String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  Talent Talent @relation(fields: [talentId], references: [id], onDelete: Cascade)

  @@unique([talentId, goalType, platform])
  @@index([talentId])
  @@index([goalType])
}

model UserDashboardConfig {
  id             String   @id @default(cuid())
  userId         String
  dashboardType  String // ADMIN_OVERVIEW, TALENT_OVERVIEW, EXCLUSIVE_TALENT_OVERVIEW
  snapshots      Json // Array of { snapshotId, enabled, order }
  customizations Json? // Additional user preferences per snapshot
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, dashboardType])
  @@index([userId])
  @@index([dashboardType])
}

// Brand User Management
model BrandUser {
  id          String    @id @default(cuid())
  brandId     String
  userId      String
  role        String    @default("VIEWER") // ADMIN, EDITOR, VIEWER
  status      String    @default("ACTIVE") // ACTIVE, INVITED, INACTIVE
  invitedAt   DateTime?
  acceptedAt  DateTime?
  permissions Json? // Extensible permissions JSON
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  brand Brand @relation(fields: [brandId], references: [id], onDelete: Cascade)
  user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([brandId, userId])
  @@index([brandId])
  @@index([userId])
  @@index([status])
}

// Audit Source Tracking (Foundation for AI insights)
model AuditSource {
  id            String    @id @default(cuid())
  brandId       String
  type          String // website | social | community | product | campaign
  source        String // Specific source identifier
  status        String    @default("pending") // connected | pending | error
  metadata      Json? // Flexible metadata for different audit types
  lastCheckedAt DateTime?
  error         String? // Error message if status is error
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  brand Brand @relation(fields: [brandId], references: [id], onDelete: Cascade)

  @@unique([brandId, type, source])
  @@index([brandId])
  @@index([type])
  @@index([status])
}

// Community Management Foundation
model CommunityConnection {
  id            String    @id @default(cuid())
  talentId      String
  platform      String // instagram | tiktok | twitter | youtube | linkedin | discord | threads
  status        String    @default("pending") // connected | pending | error | inactive
  accountHandle String? // username, handle, or ID on platform
  followers     Int       @default(0)
  metadata      Json? // platform-specific data (engagement rate, follower growth, etc.)
  lastSyncedAt  DateTime?
  error         String? // error message if status is error
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  talent  Talent            @relation(fields: [talentId], references: [id], onDelete: Cascade)
  metrics CommunityMetric[]

  @@unique([talentId, platform])
  @@index([talentId])
  @@index([platform])
  @@index([status])
}

// Community Metrics (Engagement Quality)
model CommunityMetric {
  id           String   @id @default(cuid())
  connectionId String
  talentId     String
  platform     String
  metricType   String // engagement_rate | comments_vs_likes | saves_shares | repeat_commenters | response_velocity
  value        Float
  data         Json? // Flexible data structure for different metric types
  period       String   @default("week") // day | week | month | lifetime
  calculatedAt DateTime @default(now())
  createdAt    DateTime @default(now())

  connection CommunityConnection @relation(fields: [connectionId], references: [id], onDelete: Cascade)

  @@unique([connectionId, metricType, period])
  @@index([talentId])
  @@index([connectionId])
  @@index([metricType])
}

// Scheduled Export Configuration
model ExportSchedule {
  id            String    @id @default(cuid())
  talentId      String
  userId        String
  email         String    // Email to send exports to
  frequency     String    @default("weekly") // daily | weekly
  dayOfWeek     Int       @default(1) // 0-6 (Sunday=0, Monday=1, etc) for weekly exports
  enabled       Boolean   @default(true)
  lastExportAt  DateTime? // Timestamp of last export sent
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([talentId, userId])
  @@index([userId])
  @@index([enabled])
}
