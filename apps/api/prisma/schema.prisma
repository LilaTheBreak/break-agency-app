generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model AIAgentTask {
  id          String    @id
  userId      String
  taskType    String
  payload     Json
  status      String    @default("pending")
  result      Json?
  error       String?
  startedAt   DateTime?
  completedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime

  @@index([status])
  @@index([taskType])
  @@index([userId])
}

model AuditLog {
  id         String   @id @default(cuid())
  userId     String?
  userEmail  String?
  userRole   String?
  action     String
  entityType String?
  entityId   String?
  ipAddress  String?
  userAgent  String?
  metadata   Json?
  createdAt  DateTime @default(now())
  User       User?    @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([action])
  @@index([entityType])
  @@index([createdAt])
  @@index([userRole, action])
}

model AIPromptHistory {
  id        String   @id
  creatorId String
  prompt    String
  response  String
  category  String?
  helpful   Boolean?
  createdAt DateTime @default(now())
  Talent    Talent   @relation(fields: [creatorId], references: [id], onDelete: Cascade)

  @@index([category])
  @@index([creatorId, createdAt])
}

model AgentProfile {
  id          String   @id
  userId      String   @unique
  agentType   String?
  bio         String?
  languages   String[]
  timezone    String?
  status      String   @default("active")
  maxCapacity Int      @default(10)
  User        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model AiTokenLog {
  id               String   @id
  userId           String?
  action           String
  model            String
  promptTokens     Int
  completionTokens Int
  totalTokens      Int
  estimatedCost    Float
  createdAt        DateTime @default(now())
  User             User?    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model AssetGeneration {
  id            String   @id
  deliverableId String
  userId        String
  assetType     String
  type          String?
  prompt        String
  generatedUrl  String?
  aiOutput      String?
  status        String   @default("pending")
  metadata      Json?
  createdAt     DateTime @default(now())
  updatedAt     DateTime

  @@index([deliverableId])
  @@index([status])
  @@index([userId])
}

model Brand {
  id                    String              @id
  name                  String              @unique
  values                String[]
  restrictedCategories  String[]
  preferredCreatorTypes String[]
  targetAudience        Json?
  BrandSavedTalent      BrandSavedTalent[]
  CreatorFitScore       CreatorFitScore[]
  CrmCampaign           CrmCampaign[]
  Deal                  Deal[]
  Invoice               Invoice[]
  Outreach              Outreach[]
  Payout                Payout[]
  SuitabilityResult     SuitabilityResult[]
}

model BrandCampaign {
  id                 String               @id
  title              String
  ownerId            String
  stage              String               @default("PLANNING")
  brands             Json?
  creatorTeams       Json?
  metadata           Json?
  createdAt          DateTime             @default(now())
  updatedAt          DateTime
  User               User                 @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  CampaignBrandPivot CampaignBrandPivot[]

  @@index([createdAt])
  @@index([ownerId])
  @@index([stage])
}

model CampaignBrandPivot {
  id            String        @id
  campaignId    String
  brandId       String
  metrics       Json?
  createdAt     DateTime      @default(now())
  BrandCampaign BrandCampaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)

  @@unique([campaignId, brandId])
  @@index([brandId])
  @@index([campaignId])
}

model ContractReview {
  id           String   @id
  userId       String
  fileId       String?
  contractText String
  findings     Json?
  riskScore    Float?
  status       String   @default("pending")
  createdAt    DateTime @default(now())
  updatedAt    DateTime

  @@index([fileId])
  @@index([status])
  @@index([userId])
}

model Contract {
  id             String    @id
  dealId         String
  title          String
  fileUrl        String?
  pdfUrl         String?
  status         String    @default("draft")
  sentAt         DateTime?
  talentSignedAt DateTime?
  brandSignedAt  DateTime?
  fullySignedAt  DateTime?
  terms          Json?
  templateId     String?
  metadata       Json?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime
  Deal           Deal      @relation(fields: [dealId], references: [id], onDelete: Cascade)

  @@index([dealId])
  @@index([status])
  @@index([sentAt])
}

model CreatorBalance {
  id              String   @id
  userId          String   @unique
  available       Float    @default(0)
  availableAmount Float    @default(0)
  pendingAmount   Float    @default(0)
  totalEarned     Float    @default(0)
  currency        String   @default("usd")
  metadata        Json?
  lastUpdated     DateTime @default(now())
  createdAt       DateTime @default(now())
  updatedAt       DateTime

  @@index([userId])
}

model CalendarEvent {
  id               String    @id @default(cuid())
  title            String
  description      String?
  startAt          DateTime
  endAt            DateTime
  type             String    // "meeting" | "event" | "content"
  source           String    @default("internal") // "internal" | "email" | "google"
  location         String?
  status           String    @default("scheduled") // "scheduled" | "cancelled" | "completed"
  isAllDay         Boolean   @default(false)
  createdBy        String
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  
  // Metadata for filtering and relations
  metadata         Json?     // { brand, category, confirmed, etc. }
  
  // Relations to CRM entities
  relatedBrandIds     String[] @default([])
  relatedCreatorIds   String[] @default([])
  relatedDealIds      String[] @default([])
  relatedCampaignIds  String[] @default([])
  relatedTaskIds      String[] @default([])
  
  // Creator relation
  Creator          User      @relation("CalendarEventCreator", fields: [createdBy], references: [id])
  
  @@index([createdBy])
  @@index([startAt])
  @@index([endAt])
  @@index([type])
  @@index([source])
  @@index([status])
}

model CreatorEvent {
  id            String    @id
  creatorId     String
  eventName     String
  eventType     String
  description   String?
  location      String?
  startAt       DateTime
  endAt         DateTime?
  status        String    @default("suggested")
  source        String    @default("agent")
  sourceUserId  String?
  declineReason String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime
  Talent        Talent    @relation(fields: [creatorId], references: [id], onDelete: Cascade)
  User          User?     @relation(fields: [sourceUserId], references: [id])

  @@index([creatorId, status])
  @@index([startAt])
  @@index([status])
}

model CreatorGoal {
  id                 String               @id
  creatorId          String
  goalCategory       String               @default("growth")
  goalType           String
  title              String
  targetValue        Float?
  targetUnit         String?
  timeframe          String?
  progress           Float                @default(0)
  active             Boolean              @default(true)
  createdAt          DateTime             @default(now())
  updatedAt          DateTime
  Talent             Talent               @relation(fields: [creatorId], references: [id], onDelete: Cascade)
  CreatorGoalVersion CreatorGoalVersion[]

  @@index([creatorId, active])
  @@index([goalCategory])
  @@index([goalType])
}

model CreatorGoalVersion {
  id            String      @id
  creatorGoalId String
  snapshot      Json
  changedAt     DateTime    @default(now())
  changedBy     String
  changeType    String
  CreatorGoal   CreatorGoal @relation(fields: [creatorGoalId], references: [id], onDelete: Cascade)

  @@index([changedBy])
  @@index([creatorGoalId, changedAt])
}

model CreatorInsight {
  id          String    @id
  creatorId   String
  insightType String
  title       String
  summary     String
  context     String?
  metadata    Json?
  priority    Int       @default(0)
  isRead      Boolean   @default(false)
  createdAt   DateTime  @default(now())
  expiresAt   DateTime?
  Talent      Talent    @relation(fields: [creatorId], references: [id], onDelete: Cascade)

  @@index([creatorId, createdAt])
  @@index([creatorId, isRead])
  @@index([insightType])
}

model CreatorTask {
  id                  String       @id
  creatorId           String
  title               String
  description         String?
  taskType            String
  dueAt               DateTime?
  completedAt         DateTime?
  priority            String       @default("medium")
  status              String       @default("pending")
  linkedDealId        String?
  linkedDeliverableId String?
  createdBy           String?
  createdAt           DateTime     @default(now())
  updatedAt           DateTime
  User                User?        @relation(fields: [createdBy], references: [id])
  Talent              Talent       @relation(fields: [creatorId], references: [id], onDelete: Cascade)
  Deal                Deal?        @relation(fields: [linkedDealId], references: [id])
  Deliverable         Deliverable? @relation(fields: [linkedDeliverableId], references: [id])

  @@index([creatorId, dueAt])
  @@index([creatorId, status])
  @@index([linkedDealId])
  @@index([priority])
}

model CrmBrand {
  id                   String            @id
  brandName            String
  website              String?
  industry             String            @default("Other")
  status               String            @default("Prospect")
  owner                String?
  internalNotes        String?
  activity             Json[]            @default([])
  lastActivityAt       DateTime?
  lastActivityLabel    String?
  createdAt            DateTime          @default(now())
  updatedAt            DateTime
  lifecycleStage       String?
  logo                 String?
  primaryContactId     String?
  relationshipStrength String?
  CrmBrandContact      CrmBrandContact[]
  CrmTask              CrmTask[]
  Outreach             Outreach[]
}

model CrmBrandContact {
  id             String   @id
  crmBrandId     String
  firstName      String?
  lastName       String?
  email          String?
  phone          String?
  title          String?
  primaryContact Boolean  @default(false)
  notes          String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime
  CrmBrand       CrmBrand @relation(fields: [crmBrandId], references: [id], onDelete: Cascade)

  @@index([crmBrandId])
  @@index([email])
}

model CrmCampaign {
  id                String    @id
  campaignName      String
  brandId           String
  campaignType      String    @default("Other")
  status            String    @default("Draft")
  startDate         DateTime?
  endDate           DateTime?
  internalSummary   String?
  goals             String?
  keyNotes          String?
  owner             String?
  linkedDealIds     String[]  @default([])
  linkedTalentIds   String[]  @default([])
  linkedTaskIds     String[]  @default([])
  linkedOutreachIds String[]  @default([])
  linkedEventIds    String[]  @default([])
  activity          Json[]    @default([])
  lastActivityAt    DateTime?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime
  Brand             Brand     @relation(fields: [brandId], references: [id], onDelete: Cascade)
  CrmTask           CrmTask[]

  @@index([brandId])
  @@index([lastActivityAt])
  @@index([owner])
  @@index([status])
}

model CrmTask {
  id               String       @id
  title            String
  status           String       @default("Pending")
  priority         String       @default("Medium")
  dueDate          DateTime?
  owner            String?
  brandId          String?
  dealId           String?
  campaignId       String?
  eventId          String?
  contractId       String?
  createdBy        String?
  createdAt        DateTime     @default(now())
  updatedAt        DateTime
  assignedUserIds  String[]     @default([])
  description      String?
  mentions         Json[]       @default([])
  ownerId          String?
  relatedBrands    String[]     @default([])
  relatedCampaigns String[]     @default([])
  relatedContracts String[]     @default([])
  relatedCreators  String[]     @default([])
  relatedDeals     String[]     @default([])
  relatedEvents    String[]     @default([])
  relatedUsers     String[]     @default([])
  CrmBrand         CrmBrand?    @relation(fields: [brandId], references: [id])
  CrmCampaign      CrmCampaign? @relation(fields: [campaignId], references: [id])
  CreatedByUser    User?        @relation("TaskCreatedBy", fields: [createdBy], references: [id])
  Owner            User?        @relation("TaskOwner", fields: [ownerId], references: [id])

  @@index([brandId])
  @@index([campaignId])
  @@index([contractId])
  @@index([createdBy])
  @@index([dealId])
  @@index([dueDate])
  @@index([eventId])
  @@index([owner])
  @@index([ownerId])
  @@index([priority])
  @@index([status])
}

model Deal {
  id                      String            @id
  userId                  String
  talentId                String
  brandId                 String
  stage                   DealStage         @default(NEW_LEAD)
  value                   Float?
  currency                String            @default("USD")
  brandName               String?
  aiSummary               String?
  notes                   String?
  expectedClose           DateTime?
  createdAt               DateTime          @default(now())
  updatedAt               DateTime
  campaignLiveAt          DateTime?
  closedAt                DateTime?
  contractReceivedAt      DateTime?
  contractSignedAt        DateTime?
  deliverablesCompletedAt DateTime?
  negotiationStartedAt    DateTime?
  proposalSentAt          DateTime?
  opportunityId           String?           @unique
  Contract                Contract[]
  CreatorTask             CreatorTask[]
  Brand                   Brand             @relation(fields: [brandId], references: [id], onDelete: Cascade)
  SalesOpportunity        SalesOpportunity? @relation(fields: [opportunityId], references: [id])
  Talent                  Talent            @relation(fields: [talentId], references: [id], onDelete: Cascade)
  User                    User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  DealNegotiation         DealNegotiation?
  DealTimeline            DealTimeline[]
  Deliverable             Deliverable[]
  Invoice                 Invoice[]
  Payment                 Payment[]
  Payout                  Payout[]

  @@index([opportunityId])
}

model DealNegotiation {
  id           String   @id
  dealId       String   @unique
  status       String   @default("pending")
  offerTerms   Json?
  counterTerms Json?
  history      Json[]
  createdAt    DateTime @default(now())
  updatedAt    DateTime
  Deal         Deal     @relation(fields: [dealId], references: [id], onDelete: Cascade)
}

model DealTimeline {
  id          String   @id
  dealId      String
  type        String
  message     String
  metadata    Json?
  createdById String?
  createdAt   DateTime @default(now())
  User        User?    @relation(fields: [createdById], references: [id])
  Deal        Deal     @relation(fields: [dealId], references: [id], onDelete: Cascade)
}

model Deliverable {
  id              String        @id
  dealId          String
  title           String
  description     String?
  deliverableType String?
  usageRights     String?
  frequency       String?
  dueAt           DateTime?
  approvedAt      DateTime?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime
  CreatorTask     CreatorTask[]
  Deal            Deal          @relation(fields: [dealId], references: [id], onDelete: Cascade)
}

model DeliverableItem {
  id              String    @id
  dealId          String
  userId          String?
  title           String
  description     String?
  deliverableType String?
  platform        String?
  usageRights     String?
  frequency       String?
  dueDate         DateTime?
  dueAt           DateTime?
  approvedAt      DateTime?
  locked          Boolean?  @default(false)
  status          String    @default("pending")
  metadata        Json?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime

  @@index([dealId])
  @@index([status])
  @@index([userId])
}

model EmailFeedback {
  id                 String           @id
  userId             String
  emailOpportunityId String
  isRelevant         Boolean
  category           String
  confidence         Float
  createdAt          DateTime         @default(now())
  EmailOpportunity   EmailOpportunity @relation(fields: [emailOpportunityId], references: [id], onDelete: Cascade)
  User               User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([emailOpportunityId])
  @@index([userId])
}

model EmailOpportunity {
  id               String          @id
  userId           String
  gmailMessageId   String          @unique
  threadId         String
  subject          String
  from             String
  receivedAt       DateTime
  category         String
  confidence       Float
  brandName        String?
  opportunityType  String?
  deliverables     Json?
  dates            String?
  location         String?
  paymentDetails   String?
  contactEmail     String?
  isUrgent         Boolean         @default(false)
  status           String          @default("NEW")
  notes            String?
  isRelevant       Boolean?
  emailBody        String?
  suggestedActions Json?
  lastActionAt     DateTime?
  lastActionType   String?
  responseNotes    String?
  createdAt        DateTime        @default(now())
  updatedAt        DateTime
  EmailFeedback    EmailFeedback[]
  User             User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([isUrgent])
  @@index([receivedAt])
  @@index([userId, category])
  @@index([userId, status])
}

model File {
  id        String   @id
  userId    String?
  key       String
  url       String?
  filename  String
  type      String
  folder    String?
  size      Int?
  createdAt DateTime @default(now())
  updatedAt DateTime
  User      User?    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([folder])
  @@index([userId])
}

model FinanceActivityLog {
  id            String   @id
  actionType    String
  referenceType String
  referenceId   String
  amount        Float?
  currency      String?
  metadata      Json?
  createdBy     String?
  createdAt     DateTime @default(now())
  User          User?    @relation(fields: [createdBy], references: [id])

  @@index([actionType])
  @@index([createdAt])
  @@index([referenceId])
  @@index([referenceType])
}

model FinanceDocument {
  id         String   @id
  fileUrl    String
  fileName   String?
  fileType   String
  linkedType String
  linkedId   String
  uploadedBy String
  uploadedAt DateTime @default(now())
  User       User     @relation(fields: [uploadedBy], references: [id])

  @@index([linkedId])
  @@index([linkedType])
  @@index([uploadedBy])
}

model FinanceReconciliation {
  id          String   @id
  type        String
  referenceId String
  amount      Float
  currency    String   @default("USD")
  method      String?
  notes       String?
  confirmedAt DateTime
  createdBy   String
  createdAt   DateTime @default(now())
  User        User     @relation(fields: [createdBy], references: [id])

  @@index([confirmedAt])
  @@index([referenceId])
  @@index([type])
}

model GmailToken {
  userId            String    @id
  accessToken       String
  refreshToken      String
  expiryDate        DateTime?
  scope             String?
  tokenType         String?
  idToken           String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime
  lastSyncedAt      DateTime?
  webhookExpiration DateTime?
  webhookHistoryId  String?
  User              User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model InboundEmail {
  id                  String               @id
  userId              String?
  inboxMessageId      String?
  fromEmail           String
  toEmail             String
  subject             String?
  body                String?
  gmailId             String?              @unique
  threadId            String?
  receivedAt          DateTime             @default(now())
  direction           String               @default("inbound")
  isRead              Boolean              @default(false)
  categories          String[]
  metadata            Json?
  aiSummary           String?
  aiCategory          String?
  aiUrgency           String?
  aiRecommendedAction String?
  aiConfidence        Float?
  aiJson              Json?
  snippet             String?
  InboxMessage        InboxMessage?        @relation(fields: [inboxMessageId], references: [id], onDelete: Cascade)
  User                User?                @relation(fields: [userId], references: [id])
  TrackingPixelEvent  TrackingPixelEvent[]

  @@index([receivedAt])
  @@index([threadId])
  @@index([userId])
}

model InboxMessage {
  id              String           @id
  threadId        String           @unique
  userId          String
  subject         String?
  snippet         String?
  isRead          Boolean          @default(false)
  lastMessageAt   DateTime
  participants    String[]
  body            String?
  parsed          Json?
  receivedAt      DateTime         @default(now())
  sender          String?
  InboundEmail    InboundEmail[]
  InboxThreadMeta InboxThreadMeta?

  @@index([lastMessageAt])
  @@index([receivedAt])
  @@index([userId])
}

model InboxThreadMeta {
  id              String       @id
  threadId        String       @unique
  userId          String
  aiThreadSummary String?
  unreadCount     Int          @default(0)
  priority        Int          @default(0)
  lastMessageAt   DateTime?
  linkedDealId    String?
  InboxMessage    InboxMessage @relation(fields: [threadId], references: [threadId])
}

model Invoice {
  id            String    @id
  dealId        String
  amount        Float
  status        String    @default("draft")
  issuedAt      DateTime
  dueAt         DateTime
  paidAt        DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime
  brandId       String?
  currency      String    @default("USD")
  invoiceNumber String    @unique
  Brand         Brand?    @relation(fields: [brandId], references: [id])
  Deal          Deal      @relation(fields: [dealId], references: [id], onDelete: Cascade)

  @@index([brandId])
  @@index([dealId])
  @@index([dueAt])
  @@index([status])
}

model Lead {
  id         String   @id
  email      String   @unique
  brandEmail String?
  name       String?
  brandName  String?
  company    String?
  status     String   @default("new")
  metadata   Json?
  createdAt  DateTime @default(now())
  updatedAt  DateTime

  @@index([status])
}

model Notification {
  id        String   @id
  userId    String
  title     String
  body      String?
  type      String
  entityId  String?
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Opportunity {
  id                     String                   @id
  brand                  String
  location               String
  title                  String
  deliverables           String
  payment                String
  deadline               String
  status                 String                   @default("Live brief Â· Login required to apply")
  image                  String
  logo                   String
  type                   String
  isActive               Boolean                  @default(true)
  createdBy              String
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime
  OpportunityApplication OpportunityApplication[]
  Submission             Submission[]

  @@index([createdBy])
  @@index([isActive, createdAt])
}

model OpportunityApplication {
  id            String      @id
  opportunityId String
  creatorId     String
  status        String      @default("pending")
  pitch         String?
  proposedRate  Float?
  appliedAt     DateTime    @default(now())
  reviewedAt    DateTime?
  notes         String?
  User          User        @relation(fields: [creatorId], references: [id], onDelete: Cascade)
  Opportunity   Opportunity @relation(fields: [opportunityId], references: [id], onDelete: Cascade)

  @@unique([opportunityId, creatorId])
  @@index([creatorId, status])
  @@index([opportunityId, status])
}

model Outreach {
  id                                  String                @id
  target                              String
  type                                String                @default("Brand")
  contact                             String?
  contactEmail                        String?
  link                                String?
  owner                               String?
  source                              String?
  stage                               String                @default("not-started")
  status                              String                @default("Not started")
  summary                             String?
  threadUrl                           String?
  gmailThreadId                       String?
  emailsSent                          Int                   @default(0)
  emailsReplies                       Int                   @default(0)
  lastContact                         DateTime?
  nextFollowUp                        DateTime?
  reminder                            String?
  opportunityRef                      String?
  archived                            Boolean               @default(false)
  linkedCreatorId                     String?
  linkedBrandId                       String?
  createdBy                           String
  createdAt                           DateTime              @default(now())
  updatedAt                           DateTime
  linkedCrmBrandId                    String?
  User_Outreach_createdByToUser       User                  @relation("Outreach_createdByToUser", fields: [createdBy], references: [id], onDelete: Cascade)
  Brand                               Brand?                @relation(fields: [linkedBrandId], references: [id])
  User_Outreach_linkedCreatorIdToUser User?                 @relation("Outreach_linkedCreatorIdToUser", fields: [linkedCreatorId], references: [id])
  CrmBrand                            CrmBrand?             @relation(fields: [linkedCrmBrandId], references: [id])
  OutreachEmailThread                 OutreachEmailThread[]
  OutreachNote                        OutreachNote[]
  OutreachTask                        OutreachTask[]
  SalesOpportunity                    SalesOpportunity?

  @@index([archived])
  @@index([createdBy])
  @@index([gmailThreadId])
  @@index([linkedBrandId])
  @@index([linkedCreatorId])
  @@index([linkedCrmBrandId])
  @@index([nextFollowUp])
  @@index([stage])
}

model OutreachAction {
  id           String    @id
  sequenceId   String
  stepId       String?
  leadId       String?
  actionType   String
  status       String    @default("pending")
  errorMessage String?
  scheduledAt  DateTime?
  executedAt   DateTime?
  metadata     Json?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime

  @@index([scheduledAt])
  @@index([sequenceId])
  @@index([status])
}

model OutreachEmailThread {
  id            String   @id
  outreachId    String
  gmailThreadId String   @unique
  lastMessageAt DateTime
  status        String   @default("awaiting_reply")
  lastSyncedAt  DateTime @default(now())
  createdAt     DateTime @default(now())
  updatedAt     DateTime
  Outreach      Outreach @relation(fields: [outreachId], references: [id], onDelete: Cascade)

  @@index([gmailThreadId])
  @@index([outreachId])
  @@index([status])
}

model OutreachNote {
  id         String   @id
  outreachId String
  author     String
  body       String
  createdAt  DateTime @default(now())
  Outreach   Outreach @relation(fields: [outreachId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([outreachId])
}

model OutreachSequence {
  id        String   @id
  leadId    String
  name      String
  status    String   @default("active")
  metadata  Json?
  createdAt DateTime @default(now())
  updatedAt DateTime

  @@index([leadId])
  @@index([status])
}

model OutreachStep {
  id         String   @id
  sequenceId String
  stepNumber Int
  actionType String
  delay      Int?
  template   String?
  metadata   Json?
  createdAt  DateTime @default(now())
  updatedAt  DateTime

  @@index([sequenceId])
}

model OutreachTask {
  id         String    @id
  outreachId String
  title      String
  dueDate    DateTime?
  owner      String?
  priority   String    @default("Medium")
  status     String    @default("Open")
  createdAt  DateTime  @default(now())
  updatedAt  DateTime
  Outreach   Outreach  @relation(fields: [outreachId], references: [id], onDelete: Cascade)

  @@index([dueDate])
  @@index([outreachId])
  @@index([status])
}

model Payment {
  id                    String    @id
  dealId                String
  talentId              String?
  amount                Float
  status                String    @default("PENDING")
  expectedPaymentDate   DateTime?
  actualPaymentDate     DateTime?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime
  currency              String?   @default("usd")
  metadata              Json?
  stripePaymentIntentId String?   @unique
  Deal                  Deal      @relation(fields: [dealId], references: [id], onDelete: Cascade)
  Talent                Talent?   @relation(fields: [talentId], references: [id])

  @@index([status])
  @@index([stripePaymentIntentId])
}

model Payout {
  id               String    @id
  userId           String?
  referenceId      String?   @unique
  creatorId        String
  dealId           String
  brandId          String?
  amount           Float
  currency         String    @default("USD")
  status           String    @default("pending")
  expectedPayoutAt DateTime?
  paidAt           DateTime?
  createdBy        String?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime
  Brand            Brand?    @relation(fields: [brandId], references: [id])
  User             User?     @relation(fields: [createdBy], references: [id])
  Talent           Talent    @relation(fields: [creatorId], references: [id], onDelete: Cascade)
  Deal             Deal      @relation(fields: [dealId], references: [id], onDelete: Cascade)

  @@index([brandId])
  @@index([creatorId])
  @@index([dealId])
  @@index([expectedPayoutAt])
  @@index([referenceId])
  @@index([status])
  @@index([userId])
}

model Resource {
  id               String             @id
  title            String
  shortDescription String
  longDescription  String?
  resourceType     ResourceType
  uploadUrl        String?
  externalUrl      String?
  thumbnailUrl     String?
  status           ResourceStatus     @default(DRAFT)
  visibility       ResourceVisibility @default(PUBLIC)
  allowedAudiences String[]           @default([])
  metadata         Json?
  eventDate        DateTime?
  eventTime        String?
  hasReplay        Boolean?
  rsvpEnabled      Boolean            @default(false)
  rsvpOpen         Boolean            @default(true)
  viewCount        Int                @default(0)
  createdById      String
  createdAt        DateTime           @default(now())
  updatedAt        DateTime
  uploadFilename   String?
  uploadFileType   String?
  uploadFileSize   Int?
  User             User               @relation(fields: [createdById], references: [id], onDelete: Cascade)
  ResourceRsvp     ResourceRsvp[]

  @@index([createdById])
  @@index([resourceType])
  @@index([status])
  @@index([visibility])
}

model ResourceRsvp {
  id         String   @id
  resourceId String
  userId     String
  status     String   @default("confirmed")
  createdAt  DateTime @default(now())
  updatedAt  DateTime
  Resource   Resource @relation(fields: [resourceId], references: [id], onDelete: Cascade)
  User       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([resourceId, userId])
  @@index([resourceId])
  @@index([userId])
}

model RiskEvent {
  id         String   @id
  userId     String?
  entityType String
  entityId   String
  riskScore  Int
  riskFlags  String[]
  details    Json?
  createdAt  DateTime @default(now())
  User       User?    @relation(fields: [userId], references: [id])
}

model SalesOpportunity {
  id              String    @id
  outreachId      String    @unique
  name            String
  value           Float
  currency        String    @default("USD")
  expectedCloseAt DateTime?
  status          String    @default("open")
  notes           String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime
  Deal            Deal?
  Outreach        Outreach  @relation(fields: [outreachId], references: [id], onDelete: Cascade)

  @@index([expectedCloseAt])
  @@index([outreachId])
  @@index([status])
}

model SignatureRequest {
  id           String    @id
  userId       String
  contractId   String?
  documentUrl  String
  signerEmail  String
  signedPdfUrl String?
  status       String    @default("pending")
  signedAt     DateTime?
  metadata     Json?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime

  @@index([contractId])
  @@index([signerEmail])
  @@index([status])
  @@index([userId])
}

model SocialAccountConnection {
  id            String          @id
  creatorId     String
  platform      String
  handle        String
  connected     Boolean         @default(false)
  accessToken   String?
  refreshToken  String?
  expiresAt     DateTime?
  lastSyncedAt  DateTime?
  metadata      Json?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime
  Talent        Talent          @relation(fields: [creatorId], references: [id], onDelete: Cascade)
  SocialProfile SocialProfile?
  SocialSyncLog SocialSyncLog[]

  @@unique([creatorId, platform])
  @@index([creatorId, connected])
  @@index([platform])
}

model SocialProfile {
  id                String                  @id @default(cuid())
  connectionId      String                  @unique
  platform          String
  handle            String
  displayName       String?
  bio               String?
  profileImageUrl   String?
  followerCount     Int                     @default(0)
  followingCount    Int?
  postCount         Int?
  averageViews      Float?
  averageEngagement Float?
  engagementRate    Float?
  isVerified        Boolean                 @default(false)
  externalId        String?
  lastSyncedAt      DateTime?
  createdAt         DateTime                @default(now())
  updatedAt         DateTime
  metrics           SocialMetric[]
  posts             SocialPost[]
  connection        SocialAccountConnection @relation(fields: [connectionId], references: [id], onDelete: Cascade)

  @@index([platform, handle])
  @@index([connectionId])
}

model SocialPost {
  id             String        @id @default(cuid())
  profileId      String
  platform       String
  externalId     String
  caption        String?
  mediaType      String
  mediaUrl       String?
  thumbnailUrl   String?
  permalink      String?
  viewCount      Int?
  likeCount      Int?
  commentCount   Int?
  shareCount     Int?
  saveCount      Int?
  engagementRate Float?
  postedAt       DateTime
  lastSyncedAt   DateTime?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime
  profile        SocialProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@unique([platform, externalId])
  @@index([profileId, postedAt])
  @@index([platform, postedAt])
}

model SocialMetric {
  id           String        @id @default(cuid())
  profileId    String
  platform     String
  metricType   String
  value        Float
  snapshotDate DateTime      @default(now())
  metadata     Json?
  createdAt    DateTime      @default(now())
  profile      SocialProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([profileId, snapshotDate])
  @@index([metricType, snapshotDate])
}

model SocialSyncLog {
  id             String                  @id @default(cuid())
  connectionId   String
  platform       String
  syncType       String
  status         String
  itemsSynced    Int                     @default(0)
  errorMessage   String?
  errorCode      String?
  rateLimitHit   Boolean                 @default(false)
  rateLimitReset DateTime?
  startedAt      DateTime
  completedAt    DateTime?
  duration       Int?
  createdAt      DateTime                @default(now())
  connection     SocialAccountConnection @relation(fields: [connectionId], references: [id], onDelete: Cascade)

  @@index([connectionId, createdAt])
  @@index([platform, status])
  @@index([rateLimitHit])
}

model Submission {
  id            String       @id
  creatorId     String
  opportunityId String?
  title         String
  platform      String
  status        String       @default("draft")
  contentUrl    String?
  files         Json?
  revisions     Json?
  feedback      String?
  submittedAt   DateTime?
  approvedAt    DateTime?
  createdAt     DateTime     @default(now())
  updatedAt     DateTime
  User          User         @relation(fields: [creatorId], references: [id], onDelete: Cascade)
  Opportunity   Opportunity? @relation(fields: [opportunityId], references: [id])

  @@index([createdAt])
  @@index([creatorId, status])
  @@index([opportunityId])
}

model SuitabilityResult {
  id         String   @id
  creatorId  String
  brandId    String
  score      Int      @default(0)
  flags      String[]
  categories String[]
  reasoning  Json?
  aiSummary  String?
  createdAt  DateTime @default(now())
  Brand      Brand    @relation(fields: [brandId], references: [id], onDelete: Cascade)
  Talent     Talent   @relation(fields: [creatorId], references: [id], onDelete: Cascade)
}

model Talent {
  id                      String                    @id
  userId                  String                    @unique
  name                    String
  categories              String[]
  stage                   String?
  AIPromptHistory         AIPromptHistory[]
  BrandSavedTalent        BrandSavedTalent[]
  CreatorEvent            CreatorEvent[]
  CreatorFitScore         CreatorFitScore[]
  CreatorGoal             CreatorGoal[]
  CreatorInsight          CreatorInsight[]
  CreatorTask             CreatorTask[]
  Deal                    Deal[]
  Payment                 Payment[]
  Payout                  Payout[]
  SocialAccountConnection SocialAccountConnection[]
  SuitabilityResult       SuitabilityResult[]
  User                    User                      @relation(fields: [userId], references: [id], onDelete: Cascade)
  TalentAssignment        TalentAssignment[]
  WellnessCheckin         WellnessCheckin[]
}

model TalentAssignment {
  id        String   @id
  agentId   String
  talentId  String
  createdAt DateTime @default(now())
  User      User     @relation(fields: [agentId], references: [id], onDelete: Cascade)
  Talent    Talent   @relation(fields: [talentId], references: [id], onDelete: Cascade)

  @@unique([agentId, talentId])
}

model TrackingPixelEvent {
  id           String       @id
  emailId      String
  openedAt     DateTime     @default(now())
  ip           String?
  userAgent    String?
  InboundEmail InboundEmail @relation(fields: [emailId], references: [id], onDelete: Cascade)
}

model User {
  id                                      String                   @id
  email                                   String                   @unique
  password                                String?
  name                                    String?
  avatarUrl                               String?
  createdAt                               DateTime                 @default(now())
  updatedAt                               DateTime
  accountType                             String?
  admin_notes                             String?
  bio                                     String?
  creator_score                           Int?
  creator_score_reason                    Json?
  friends_of_house_id                     String?
  include_in_roster                       Boolean                  @default(false)
  location                                String?
  managedTalentIds                        String[]                 @default([])
  onboardingComplete                      Boolean?                 @default(false)
  onboarding_responses                    Json?
  onboarding_status                       String?                  @default("pending_review")
  pronouns                                String?
  role                                    String                   @default("CREATOR")
  role_recommended                        String?
  roster_category                         String?
  socialLinks                             Json?
  status                                  String?
  subscriptionStatus                      String?                  @default("free")
  timezone                                String?
  ugcApproved                             Boolean                  @default(false)
  ugcRates                                Json?
  ugc_categories                          String[]                 @default([])
  ugc_portfolio_url                       String?
  upgrade_suggested                       Boolean?                 @default(false)
  resetToken                              String?
  resetTokenExpiry                        DateTime?
  AgentProfile                            AgentProfile?
  AiTokenLog                              AiTokenLog[]
  AuditLog                                AuditLog[]
  BrandCampaign                           BrandCampaign[]
  CalendarEventsCreated                   CalendarEvent[]          @relation("CalendarEventCreator")
  CreatorEvent                            CreatorEvent[]
  CreatorTask                             CreatorTask[]
  CrmTasksCreated                         CrmTask[]                @relation("TaskCreatedBy")
  CrmTasksOwned                           CrmTask[]                @relation("TaskOwner")
  Deal                                    Deal[]
  DealTimeline                            DealTimeline[]
  EmailFeedback                           EmailFeedback[]
  EmailOpportunity                        EmailOpportunity[]
  File                                    File[]
  FinanceActivityLog                      FinanceActivityLog[]
  FinanceDocument                         FinanceDocument[]
  FinanceReconciliation                   FinanceReconciliation[]
  GmailToken                              GmailToken?
  InboundEmail                            InboundEmail[]
  Notification                            Notification[]
  OpportunityApplication                  OpportunityApplication[]
  Outreach_Outreach_createdByToUser       Outreach[]               @relation("Outreach_createdByToUser")
  Outreach_Outreach_linkedCreatorIdToUser Outreach[]               @relation("Outreach_linkedCreatorIdToUser")
  Payout                                  Payout[]
  Resource                                Resource[]
  ResourceRsvp                            ResourceRsvp[]
  RiskEvent                               RiskEvent[]
  Submission                              Submission[]
  Talent                                  Talent?
  TalentAssignment                        TalentAssignment[]
}

model WellnessCheckin {
  id          String   @id
  creatorId   String
  energyLevel Int
  workload    String
  notes       String?
  createdAt   DateTime @default(now())
  Talent      Talent   @relation(fields: [creatorId], references: [id], onDelete: Cascade)

  @@index([creatorId, createdAt])
}

model XeroConnection {
  id           String    @id
  connected    Boolean   @default(false)
  tenantId     String?
  accessToken  String?
  refreshToken String?
  expiresAt    DateTime?
  lastSyncedAt DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime
}

model BrandSavedTalent {
  id        String   @id
  brandId   String
  talentId  String
  status    String   @default("saved")
  notes     String?
  addedAt   DateTime @default(now())
  updatedAt DateTime @updatedAt
  Brand     Brand    @relation(fields: [brandId], references: [id], onDelete: Cascade)
  Talent    Talent   @relation(fields: [talentId], references: [id], onDelete: Cascade)

  @@unique([brandId, talentId])
  @@index([brandId, status])
  @@index([talentId])
}

model CreatorFitScore {
  id                 String   @id
  brandId            String
  talentId           String
  campaignId         String?
  totalScore         Int      @default(0)
  audienceScore      Int      @default(0)
  engagementScore    Int      @default(0)
  historyScore       Int      @default(0)
  categoryScore      Int      @default(0)
  explanation        String?
  calculationDetails Json?
  createdAt          DateTime @default(now())
  Brand              Brand    @relation(fields: [brandId], references: [id], onDelete: Cascade)
  Talent             Talent   @relation(fields: [talentId], references: [id], onDelete: Cascade)

  @@index([brandId, totalScore])
  @@index([talentId])
  @@index([campaignId])
}

enum DealStage {
  NEW_LEAD
  NEGOTIATION
  CONTRACT_SENT
  CONTRACT_SIGNED
  DELIVERABLES_IN_PROGRESS
  PAYMENT_PENDING
  PAYMENT_RECEIVED
  COMPLETED
  LOST
}

enum ResourceStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum ResourceType {
  TEMPLATE
  GUIDE
  ARTICLE
  WEBINAR
  EVENT
}

enum ResourceVisibility {
  PUBLIC
  PROTECTED
}

enum SocialPlatform {
  TIKTOK
  INSTAGRAM
  YOUTUBE
  X
  LINKEDIN
  FACEBOOK
  GMAIL
}
