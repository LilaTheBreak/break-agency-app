generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// STATUS: FUTURE
// AI agent task queue - used by cron jobs for background AI processing
model AIAgentTask {
  id          String    @id
  userId      String
  taskType    String
  payload     Json
  status      String    @default("pending")
  result      Json?
  error       String?
  startedAt   DateTime?
  completedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime

  @@index([status])
  @@index([taskType])
  @@index([userId])
}

model AuditLog {
  id         String   @id @default(cuid())
  userId     String?
  userEmail  String?
  userRole   String?
  action     String
  entityType String?
  entityId   String?
  ipAddress  String?
  userAgent  String?
  metadata   Json?
  createdAt  DateTime @default(now())
  User       User?    @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([action])
  @@index([entityType])
  @@index([createdAt])
  @@index([userRole, action])
}

model AIPromptHistory {
  id        String   @id
  creatorId String
  prompt    String
  response  String
  category  String?
  helpful   Boolean?
  createdAt DateTime @default(now())
  Talent    Talent   @relation(fields: [creatorId], references: [id], onDelete: Cascade)

  @@index([category])
  @@index([creatorId, createdAt])
}

// STATUS: FUTURE
// Agent management system - not yet fully implemented
model AgentProfile {
  id          String   @id
  userId      String   @unique
  agentType   String?
  bio         String?
  languages   String[]
  timezone    String?
  status      String   @default("active")
  maxCapacity Int      @default(10)
  User        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// Agent application (CV submission)
model AgentApplication {
  id              String   @id @default(cuid())
  userId          String   @unique
  cvFileUrl       String
  experienceNotes String?
  status          String   @default("pending") // pending, reviewed, approved, rejected
  submittedAt     DateTime @default(now())
  reviewedAt      DateTime?
  reviewedBy      String?
  
  @@index([userId])
  @@index([status])
}

// Agent policy configuration
model AgentPolicy {
  id        String   @id @default(cuid())
  userId    String   @unique
  config    Json? // Agent policy configuration
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Approval {
  id          String   @id @default(cuid())
  type        String
  title       String
  description String?
  status      String   @default("PENDING")
  requestorId String
  approverId  String?
  ownerId     String?
  attachments Json[]   @default([])
  metadata    Json?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  Requestor User  @relation("ApprovalRequestor", fields: [requestorId], references: [id])
  Approver  User? @relation("ApprovalApprover", fields: [approverId], references: [id])

  @@index([status])
  @@index([type])
  @@index([requestorId])
  @@index([approverId])
}

// Admin Task Management System
// Super Admin to Super Admin task assignment with real-time tracking
model AdminTask {
  id               String    @id @default(cuid())
  title            String
  description      String?
  
  // Assignment
  assignedByUserId String
  assignedToUserId String
  
  // Context/Linking
  relatedType      String?   // "talent" | "brand" | "deal" | "campaign" | "internal"
  relatedId        String?
  
  // Task properties
  priority         String    @default("medium") // "low" | "medium" | "high"
  status           String    @default("pending") // "pending" | "in_progress" | "completed"
  dueAt            DateTime?
  
  // Timestamps
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  completedAt      DateTime?
  
  // Relations
  AssignedBy       User      @relation("AdminTaskAssignedBy", fields: [assignedByUserId], references: [id], onDelete: Cascade)
  AssignedTo       User      @relation("AdminTaskAssignedTo", fields: [assignedToUserId], references: [id], onDelete: Cascade)
  
  // Indexes for common queries
  @@index([assignedToUserId])
  @@index([assignedByUserId])
  @@index([status])
  @@index([priority])
  @@index([dueAt])
  @@index([relatedType, relatedId])
  @@index([createdAt])
  @@unique([id])
}

model AiTokenLog {
  id               String   @id
  userId           String?
  action           String
  model            String
  promptTokens     Int
  completionTokens Int
  totalTokens      Int
  estimatedCost    Float
  createdAt        DateTime @default(now())
  User             User?    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// STATUS: FUTURE
// AI-powered asset generation - planned feature
model AssetGeneration {
  id            String   @id
  deliverableId String
  userId        String
  assetType     String
  type          String?
  prompt        String
  generatedUrl  String?
  aiOutput      String?
  status        String   @default("pending")
  metadata      Json?
  createdAt     DateTime @default(now())
  updatedAt     DateTime

  @@index([deliverableId])
  @@index([status])
  @@index([userId])
}

model Brand {
  id                    String   @id @default(cuid())
  name                  String
  domain                String?  @unique
  websiteUrl            String?
  industry              String?
  values                String[]
  restrictedCategories  String[]
  preferredCreatorTypes String[]
  targetAudience        Json?
  onboardingStatus      Json     @default("{}")  // { profile: true, billing: true, goals: false, creators: false, approve: false }
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  // Relations
  BrandUsers        BrandUser[]
  BrandSavedTalent  BrandSavedTalent[]
  CreatorFitScore   CreatorFitScore[]
  CrmCampaign       CrmCampaign[]
  Deal              Deal[]
  Invoice           Invoice[]
  Outreach          Outreach[]
  Payout            Payout[]
  SuitabilityResult SuitabilityResult[]
  Contract          Contract[]
  AuditSources      AuditSource[]
  OutreachCampaigns OutreachCampaign[]  // ASSISTED OUTREACH

  @@index([domain])
  @@index([createdAt])
}

model BrandCampaign {
  id                 String               @id
  title              String
  ownerId            String
  stage              String               @default("PLANNING")
  brands             Json?
  creatorTeams       Json?
  metadata           Json?
  createdAt          DateTime             @default(now())
  updatedAt          DateTime
  User               User                 @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  CampaignBrandPivot CampaignBrandPivot[]
  RevenueStreams     RevenueStream[]

  @@index([createdAt])
  @@index([ownerId])
  @@index([stage])
}

model CampaignBrandPivot {
  id            String        @id
  campaignId    String
  brandId       String
  metrics       Json?
  createdAt     DateTime      @default(now())
  BrandCampaign BrandCampaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)

  @@unique([campaignId, brandId])
  @@index([brandId])
  @@index([campaignId])
}

// STATUS: FUTURE
// AI contract analysis feature - partially implemented
model ContractReview {
  id           String   @id
  userId       String
  fileId       String?
  contractText String
  findings     Json?
  riskScore    Float?
  status       String   @default("pending")
  createdAt    DateTime @default(now())
  updatedAt    DateTime

  @@index([fileId])
  @@index([status])
  @@index([userId])
}

model Contract {
  id             String    @id @default(cuid())
  dealId         String
  brandId        String? // Explicit brand linkage for direct queries
  title          String
  fileUrl        String?
  pdfUrl         String?
  signedPdfUrl   String? // Signed PDF from e-signature provider
  envelopeId     String? // DocuSign envelope ID (or other provider ID)
  status         String    @default("draft")
  sentAt         DateTime?
  talentSignedAt DateTime?
  brandSignedAt  DateTime?
  fullySignedAt  DateTime?
  terms          Json?
  templateId     String?
  metadata       Json?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  Deal           Deal      @relation(fields: [dealId], references: [id], onDelete: Cascade)
  Brand          Brand?    @relation(fields: [brandId], references: [id], onDelete: SetNull)

  @@index([dealId])
  @@index([brandId])
  @@index([status])
  @@index([sentAt])
  @@index([envelopeId])
}

// STATUS: FUTURE
// Creator balance tracking - read-only for dashboards
model CreatorBalance {
  id              String   @id
  userId          String   @unique
  available       Float    @default(0)
  availableAmount Float    @default(0)
  pendingAmount   Float    @default(0)
  totalEarned     Float    @default(0)
  currency        String   @default("usd")
  metadata        Json?
  lastUpdated     DateTime @default(now())
  createdAt       DateTime @default(now())
  updatedAt       DateTime

  @@index([userId])
}

model CalendarEvent {
  id          String   @id @default(cuid())
  title       String
  description String?
  startAt     DateTime
  endAt       DateTime
  type        String // "meeting" | "event" | "content"
  source      String   @default("internal") // "internal" | "email" | "google"
  location    String?
  status      String   @default("scheduled") // "scheduled" | "cancelled" | "completed"
  isAllDay    Boolean  @default(false)
  createdBy   String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Metadata for filtering and relations
  metadata Json? // { brand, category, confirmed, etc. }

  // Relations to CRM entities
  relatedBrandIds    String[] @default([])
  relatedCreatorIds  String[] @default([])
  relatedDealIds     String[] @default([])
  relatedCampaignIds String[] @default([])
  relatedTaskIds     String[] @default([])

  // Creator relation
  Creator User @relation("CalendarEventCreator", fields: [createdBy], references: [id])
  
  // Intelligence features relation
  Warnings CalendarWarning[]

  @@index([createdBy])
  @@index([startAt])
  @@index([endAt])
  @@index([type])
  @@index([source])
  @@index([status])
}

model InternalQueueTask {
  id               String    @id
  title            String
  description      String?
  status           String    @default("pending") // pending, completed
  priority         String    @default("Medium") // High, Medium, Low
  dueDate          DateTime?
  assignedToUserId String?
  createdByUserId  String
  completedAt      DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime
  metadata         Json?     @default("{}")

  AssignedToUser User? @relation("InternalTaskAssignedTo", fields: [assignedToUserId], references: [id], onDelete: SetNull)
  CreatedByUser  User  @relation("InternalTaskCreatedBy", fields: [createdByUserId], references: [id], onDelete: Cascade)

  @@index([createdByUserId])
  @@index([assignedToUserId])
  @@index([status])
  @@index([dueDate])
  @@index([priority])
}

model CreatorEvent {
  id            String    @id
  creatorId     String
  eventName     String
  eventType     String
  description   String?
  location      String?
  startAt       DateTime
  endAt         DateTime?
  status        String    @default("suggested")
  source        String    @default("agent")
  sourceUserId  String?
  declineReason String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime
  Talent        Talent    @relation(fields: [creatorId], references: [id], onDelete: Cascade)
  User          User?     @relation(fields: [sourceUserId], references: [id])

  @@index([creatorId, status])
  @@index([startAt])
  @@index([status])
}

model CreatorGoal {
  id                 String               @id
  creatorId          String
  goalCategory       String               @default("growth")
  goalType           String
  title              String
  targetValue        Float?
  targetUnit         String?
  timeframe          String?
  progress           Float                @default(0)
  active             Boolean              @default(true)
  createdAt          DateTime             @default(now())
  updatedAt          DateTime
  Talent             Talent               @relation(fields: [creatorId], references: [id], onDelete: Cascade)
  CreatorGoalVersion CreatorGoalVersion[]

  @@index([creatorId, active])
  @@index([goalCategory])
  @@index([goalType])
}

model CreatorGoalVersion {
  id            String      @id
  creatorGoalId String
  snapshot      Json
  changedAt     DateTime    @default(now())
  changedBy     String
  changeType    String
  CreatorGoal   CreatorGoal @relation(fields: [creatorGoalId], references: [id], onDelete: Cascade)

  @@index([changedBy])
  @@index([creatorGoalId, changedAt])
}

model CreatorInsight {
  id          String    @id
  creatorId   String
  insightType String
  title       String
  summary     String
  context     String?
  metadata    Json?
  priority    Int       @default(0)
  isRead      Boolean   @default(false)
  createdAt   DateTime  @default(now())
  expiresAt   DateTime?
  Talent      Talent    @relation(fields: [creatorId], references: [id], onDelete: Cascade)

  @@index([creatorId, createdAt])
  @@index([creatorId, isRead])
  @@index([insightType])
}

model CreatorTask {
  id                  String       @id
  creatorId           String
  title               String
  description         String?
  taskType            String
  dueAt               DateTime?
  completedAt         DateTime?
  priority            String       @default("medium")
  status              String       @default("pending")
  linkedDealId        String?
  linkedDeliverableId String?
  createdBy           String?
  createdAt           DateTime     @default(now())
  updatedAt           DateTime
  User                User?        @relation(fields: [createdBy], references: [id])
  Talent              Talent       @relation(fields: [creatorId], references: [id], onDelete: Cascade)
  Deal                Deal?        @relation(fields: [linkedDealId], references: [id])
  Deliverable         Deliverable? @relation(fields: [linkedDeliverableId], references: [id])

  @@index([creatorId, dueAt])
  @@index([creatorId, status])
  @@index([linkedDealId])
  @@index([priority])
}

model CrmBrand {
  id                   String            @id
  brandName            String
  website              String?
  industry             String            @default("Other")
  status               String            @default("Prospect")
  owner                String?
  internalNotes        String?
  activity             Json[]            @default([])
  lastActivityAt       DateTime?
  lastActivityLabel    String?
  createdAt            DateTime          @default(now())
  updatedAt            DateTime
  lifecycleStage       String?
  logo                 String?
  logoUrl              String? // Auto-imported logo URL
  about                String? // Enriched about text
  socialLinks          Json? // { instagram, linkedin, tiktok, etc. }
  enrichedAt           DateTime? // When enrichment was last run
  enrichmentSource     String? // e.g. "website", "manual"
  primaryContactId     String?
  relationshipStrength String?
  CrmBrandContact      CrmBrandContact[]
  CrmTask              CrmTask[]
  Outreach             Outreach[]

  @@unique([brandName])
  @@index([brandName])
  @@index([status])
}

model CrmBrandContact {
  id                       String   @id
  crmBrandId               String
  firstName                String?
  lastName                 String?
  email                    String?
  phone                    String?
  title                    String?
  linkedInUrl              String?
  relationshipStatus       String?  @default("New")
  preferredContactMethod   String?
  owner                    String?
  primaryContact           Boolean  @default(false)
  notes                    String?
  createdAt                DateTime @default(now())
  updatedAt                DateTime
  CrmBrand                 CrmBrand @relation(fields: [crmBrandId], references: [id], onDelete: Cascade)
  
  // Outreach campaigns for this contact
  OutreachCampaigns        OutreachCampaign[] @relation("ContactOutreach")

  @@unique([crmBrandId, email])
  @@index([crmBrandId])
  @@index([email])
}

model CrmCampaign {
  id                String    @id
  campaignName      String
  brandId           String
  campaignType      String    @default("Other")
  status            String    @default("Draft")
  startDate         DateTime?
  endDate           DateTime?
  internalSummary   String?
  goals             String?
  keyNotes          String?
  owner             String?
  linkedDealIds     String[]  @default([])
  linkedTalentIds   String[]  @default([])
  linkedTaskIds     String[]  @default([])
  linkedOutreachIds String[]  @default([])
  linkedEventIds    String[]  @default([])
  activity          Json[]    @default([])
  lastActivityAt    DateTime?
  
  // BRAND SUBMISSION TRACKING (NEW)
  submittedByUserId    String?           // FK to User (brand creator)
  submissionSource     String            @default("ADMIN_CREATED")  // BRAND_PORTAL | ADMIN_CREATED
  approvalStatus       String            @default("PENDING_ADMIN_REVIEW")  // PENDING_ADMIN_REVIEW | APPROVED | REVISION_REQUESTED | REJECTED
  
  // BRAND-PROVIDED PREFERENCES (NEW)
  budgetRange          String?           // "£5K-£10K" etc
  campaignObjective    String?           // AWARENESS | CONVERSION | LAUNCH | EVENT
  platforms            String[]          @default([])  // [Instagram, TikTok, YouTube]
  targetRegion         String[]          @default([])  // [UK, US, EU]
  contentVerticals     String[]          @default([])  // [Fashion, Tech, Beauty, etc]
  audiencePreferences  Json?             // { ageRange?: string, interests?: string[] }
  creatorSizeRange     String?           // NANO | MICRO | MID | MACRO
  
  // TIMELINE (NEW)
  preferredStartDate   DateTime?
  preferredEndDate     DateTime?
  flexibilityToggle    Boolean           @default(true)  // fixed vs flexible
  
  // RELATIONS (NEW)
  CreatorShortlist     CreatorShortlist[]
  CampaignApprovals    CampaignApproval[]
  CampaignFeedback     CampaignFeedback[]
  CampaignReport       CampaignReport?
  
  createdAt         DateTime  @default(now())
  updatedAt         DateTime
  Brand             Brand     @relation(fields: [brandId], references: [id], onDelete: Cascade)
  SubmittedByUser   User?     @relation("CampaignSubmittedBy", fields: [submittedByUserId], references: [id], onDelete: SetNull)
  CrmTask           CrmTask[]

  @@index([brandId])
  @@index([lastActivityAt])
  @@index([owner])
  @@index([status])
  @@index([approvalStatus])
  @@index([submittedByUserId])
}

model CrmTask {
  id               String       @id
  title            String
  status           String       @default("Pending")
  priority         String       @default("Medium")
  dueDate          DateTime?
  owner            String?
  brandId          String?
  dealId           String?
  campaignId       String?
  eventId          String?
  contractId       String?
  createdBy        String?
  createdAt        DateTime     @default(now())
  updatedAt        DateTime
  assignedUserIds  String[]     @default([])
  description      String?
  mentions         Json[]       @default([])
  ownerId          String?
  relatedBrands    String[]     @default([])
  relatedCampaigns String[]     @default([])
  relatedContracts String[]     @default([])
  relatedCreators  String[]     @default([])
  relatedDeals     String[]     @default([])
  relatedEvents    String[]     @default([])
  relatedUsers     String[]     @default([])
  CrmBrand         CrmBrand?    @relation(fields: [brandId], references: [id])
  CrmCampaign      CrmCampaign? @relation(fields: [campaignId], references: [id])
  CreatedByUser    User?        @relation("TaskCreatedBy", fields: [createdBy], references: [id])
  Owner            User?        @relation("TaskOwner", fields: [ownerId], references: [id])

  @@index([brandId])
  @@index([campaignId])
  @@index([contractId])
  @@index([createdBy])
  @@index([dealId])
  @@index([dueDate])
  @@index([eventId])
  @@index([owner])
  @@index([ownerId])
  @@index([priority])
  @@index([status])
}

model Deal {
  id                      String            @id
  userId                  String
  talentId                String
  brandId                 String
  stage                   DealStage         @default(NEW_LEAD)
  value                   Float?
  currency                String            @default("USD")
  brandName               String?
  campaignName            String? // Campaign or project name
  aiSummary               String?
  notes                   String?
  internalNotes           String? // Internal team notes
  expectedClose           DateTime?
  startDate               DateTime? // Deal/project start date
  endDate                 DateTime? // Deal/project end date
  platforms               String[]          @default([]) // TikTok, Instagram, YouTube, etc
  deliverables            String? // JSON or text description of deliverables
  invoiceStatus           String? // NOT_INVOICED, INVOICED, PAID
  paymentStatus           String? // UNPAID, PAID, PARTIAL
  createdAt               DateTime          @default(now())
  updatedAt               DateTime
  campaignLiveAt          DateTime?
  closedAt                DateTime?
  contractReceivedAt      DateTime?
  contractSignedAt        DateTime?
  deliverablesCompletedAt DateTime?
  negotiationStartedAt    DateTime?
  proposalSentAt          DateTime?
  opportunityId           String?           @unique
  Contract                Contract[]
  CreatorTask             CreatorTask[]
  Brand                   Brand             @relation(fields: [brandId], references: [id], onDelete: Cascade)
  SalesOpportunity        SalesOpportunity? @relation(fields: [opportunityId], references: [id])
  Talent                  Talent            @relation(fields: [talentId], references: [id], onDelete: Cascade)
  User                    User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  DealNegotiation         DealNegotiation?
  DealTimeline            DealTimeline[]
  Deliverable             Deliverable[]
  Invoice                 Invoice[]
  Payment                 Payment[]
  Payout                  Payout[]
  Commission              Commission[]
  InboundEmail            InboundEmail[]
  RevenueClassification   RevenueClassification?
  SOPInstances            SOPInstance[]
  RevenueStreams          RevenueStream[] @relation("DealRevenueStreams")

  @@index([opportunityId])
}

model DealNegotiation {
  id           String   @id
  dealId       String   @unique
  status       String   @default("pending")
  offerTerms   Json?
  counterTerms Json?
  history      Json[]
  createdAt    DateTime @default(now())
  updatedAt    DateTime
  Deal         Deal     @relation(fields: [dealId], references: [id], onDelete: Cascade)
}

model DealTimeline {
  id          String   @id
  dealId      String
  type        String
  message     String
  metadata    Json?
  createdById String?
  createdAt   DateTime @default(now())
  User        User?    @relation(fields: [createdById], references: [id])
  Deal        Deal     @relation(fields: [dealId], references: [id], onDelete: Cascade)
}

model Deliverable {
  id              String        @id
  dealId          String
  title           String
  description     String?
  deliverableType String?
  usageRights     String?
  frequency       String?
  dueAt           DateTime?
  approvedAt      DateTime?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime
  CreatorTask     CreatorTask[]
  Deal            Deal          @relation(fields: [dealId], references: [id], onDelete: Cascade)
}

model DeliverableItem {
  id              String    @id
  dealId          String
  userId          String?
  title           String
  description     String?
  deliverableType String?
  platform        String?
  usageRights     String?
  frequency       String?
  dueDate         DateTime?
  dueAt           DateTime?
  approvedAt      DateTime?
  locked          Boolean?  @default(false)
  status          String    @default("pending")
  metadata        Json?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime

  @@index([dealId])
  @@index([status])
  @@index([userId])
}

model EmailFeedback {
  id                 String           @id
  userId             String
  emailOpportunityId String
  isRelevant         Boolean
  category           String
  confidence         Float
  createdAt          DateTime         @default(now())
  EmailOpportunity   EmailOpportunity @relation(fields: [emailOpportunityId], references: [id], onDelete: Cascade)
  User               User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([emailOpportunityId])
  @@index([userId])
}

model EmailOpportunity {
  id               String          @id
  userId           String
  gmailMessageId   String          @unique
  threadId         String
  subject          String
  from             String
  receivedAt       DateTime
  category         String
  confidence       Float
  brandName        String?
  opportunityType  String?
  deliverables     Json?
  dates            String?
  location         String?
  paymentDetails   String?
  contactEmail     String?
  isUrgent         Boolean         @default(false)
  status           String          @default("NEW")
  notes            String?
  isRelevant       Boolean?
  emailBody        String?
  suggestedActions Json?
  lastActionAt     DateTime?
  lastActionType   String?
  responseNotes    String?
  createdAt        DateTime        @default(now())
  updatedAt        DateTime
  EmailFeedback    EmailFeedback[]
  User             User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([isUrgent])
  @@index([receivedAt])
  @@index([userId, category])
  @@index([userId, status])
}

model File {
  id        String   @id
  userId    String?
  key       String
  url       String?
  filename  String
  type      String
  folder    String?
  size      Int?
  createdAt DateTime @default(now())
  updatedAt DateTime
  User      User?    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([folder])
  @@index([userId])
}

model FinanceActivityLog {
  id            String   @id
  actionType    String
  referenceType String
  referenceId   String
  amount        Float?
  currency      String?
  metadata      Json?
  createdBy     String?
  createdAt     DateTime @default(now())
  User          User?    @relation(fields: [createdBy], references: [id])

  @@index([actionType])
  @@index([createdAt])
  @@index([referenceId])
  @@index([referenceType])
}

model FinanceDocument {
  id         String   @id
  fileUrl    String
  fileName   String?
  fileType   String
  linkedType String
  linkedId   String
  uploadedBy String
  uploadedAt DateTime @default(now())
  User       User     @relation(fields: [uploadedBy], references: [id])

  @@index([linkedId])
  @@index([linkedType])
  @@index([uploadedBy])
}

model FinanceReconciliation {
  id          String   @id
  type        String
  referenceId String
  amount      Float
  currency    String   @default("USD")
  method      String?
  notes       String?
  confirmedAt DateTime
  createdBy   String
  createdAt   DateTime @default(now())
  User        User     @relation(fields: [createdBy], references: [id])

  @@index([confirmedAt])
  @@index([referenceId])
  @@index([type])
}

model GmailToken {
  userId            String    @id
  accessToken       String
  refreshToken      String
  expiryDate        DateTime?
  scope             String?
  tokenType         String?
  idToken           String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime
  lastSyncedAt      DateTime?
  lastError         String?
  lastErrorAt       DateTime?
  webhookExpiration DateTime?
  webhookHistoryId  String?
  User              User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Inbox {
  id            String    @id @default(cuid())
  userId        String
  provider      String    // "gmail", "outlook", "whatsapp" (future)
  emailAddress  String
  ownerType     String    @default("admin") // "admin", "talent", "brand"
  ownerId       String? // References talent or brand ID for non-admin inboxes
  isDefault     Boolean   @default(false)
  syncStatus    String    @default("idle") // "idle", "syncing", "error"
  lastSyncedAt  DateTime?
  lastError     String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  User          User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, provider, emailAddress])
  @@index([userId])
  @@index([isDefault])
  @@index([provider])
}

model GoogleAccount {
  userId       String    @id
  email        String
  accessToken  String?
  refreshToken String?
  expiresAt    DateTime?
  scope        String?
  tokenType    String?
  idToken      String?
  lastSyncedAt DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  User         User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([email])
}

model InboundEmail {
  id                  String               @id
  userId              String?
  inboxMessageId      String?
  platform            String               @default("gmail") // "gmail", "instagram", "tiktok", "whatsapp"
  fromEmail           String
  toEmail             String
  subject             String?
  body                String?
  gmailId             String?              @unique
  instagramId         String?              @unique
  tiktokId            String?              @unique
  whatsappId          String?              @unique
  threadId            String?
  receivedAt          DateTime             @default(now())
  direction           String               @default("inbound")
  isRead              Boolean              @default(false)
  categories          String[]
  metadata            Json?
  aiSummary           String?
  aiCategory          String?
  aiUrgency           String?
  aiRecommendedAction String?
  aiConfidence        Float?
  aiJson              Json?
  snippet             String?
  dealId              String? // Explicit deal linkage
  talentId            String? // Explicit talent linkage
  brandId             String? // Explicit brand linkage (from metadata.crmBrandId)
  InboxMessage        InboxMessage?        @relation(fields: [inboxMessageId], references: [id], onDelete: Cascade)
  User                User?                @relation(fields: [userId], references: [id])
  Deal                Deal?                @relation(fields: [dealId], references: [id], onDelete: SetNull)
  Talent              Talent?              @relation(fields: [talentId], references: [id], onDelete: SetNull)
  TrackingPixelEvent  TrackingPixelEvent[]
  EmailClickEvent     EmailClickEvent[]

  @@index([receivedAt])
  @@index([threadId])
  @@index([userId])
  @@index([dealId])
  @@index([talentId])
  @@index([brandId])
  @@index([platform])
}

model InboxMessage {
  id              String           @id
  threadId        String           @unique
  userId          String
  inboxId         String?          // Link to specific inbox (for multi-inbox support)
  platform        String           @default("gmail") // "gmail", "instagram", "tiktok", "whatsapp"
  subject         String?
  snippet         String?
  isRead          Boolean          @default(false)
  lastMessageAt   DateTime
  participants    String[]
  body            String?
  parsed          Json?
  receivedAt      DateTime         @default(now())
  sender          String?
  InboundEmail    InboundEmail[]
  InboxThreadMeta InboxThreadMeta?

  @@index([lastMessageAt])
  @@index([receivedAt])
  @@index([userId])
  @@index([inboxId])
  @@index([platform])
}

model InboxThreadMeta {
  id              String       @id
  threadId        String       @unique
  userId          String
  aiThreadSummary String?
  unreadCount     Int          @default(0)
  priority        Int          @default(0)
  lastMessageAt   DateTime?
  linkedDealId    String?
  InboxMessage    InboxMessage @relation(fields: [threadId], references: [threadId])
}

model Invoice {
  id            String       @id @default(cuid())
  dealId        String
  amount        Float
  status        String       @default("draft")
  issuedAt      DateTime
  dueAt         DateTime
  paidAt        DateTime?
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  brandId       String?
  currency      String       @default("USD")
  invoiceNumber String       @unique
  externalId    String?      @unique // External invoice ID (Xero, etc.)
  xeroId        String?      @unique // Xero invoice ID (external reference)
  xeroSyncError String? // Last sync error message
  lastSyncedAt  DateTime? // Last successful sync with Xero
  provider      String? // Payment provider (stripe, paypal, etc.)
  userId        String? // User ID for the invoice creator
  brandEmail    String? // Brand email address
  brandName     String? // Brand name
  processedAt   DateTime? // When payment was processed
  metadata      Json? // Additional metadata
  Brand         Brand?       @relation(fields: [brandId], references: [id])
  Deal          Deal         @relation(fields: [dealId], references: [id], onDelete: Cascade)
  Commission    Commission[]

  @@index([brandId])
  @@index([dealId])
  @@index([dueAt])
  @@index([xeroId])
  @@index([externalId])
  @@index([status])
}

// STATUS: UNUSED
// Legacy lead capture - replaced by CrmBrand and Outreach
model Lead {
  id         String   @id
  email      String   @unique
  brandEmail String?
  name       String?
  brandName  String?
  company    String?
  status     String   @default("new")
  metadata   Json?
  createdAt  DateTime @default(now())
  updatedAt  DateTime

  @@index([status])
}

model Notification {
  id        String   @id
  userId    String
  title     String
  body      String?
  type      String
  entityId  String?
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Opportunity {
  id                     String                   @id
  brand                  String
  location               String
  title                  String
  deliverables           String
  payment                String
  deadline               String
  status                 String                   @default("Live brief · Login required to apply")
  image                  String
  logo                   String
  type                   String
  isActive               Boolean                  @default(true)
  createdBy              String
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime
  OpportunityApplication OpportunityApplication[]
  Submission             Submission[]

  @@index([createdBy])
  @@index([isActive, createdAt])
}

model OpportunityApplication {
  id            String      @id
  opportunityId String
  creatorId     String
  status        String      @default("pending")
  pitch         String?
  proposedRate  Float?
  appliedAt     DateTime    @default(now())
  reviewedAt    DateTime?
  notes         String?
  User          User        @relation(fields: [creatorId], references: [id], onDelete: Cascade)
  Opportunity   Opportunity @relation(fields: [opportunityId], references: [id], onDelete: Cascade)

  @@unique([opportunityId, creatorId])
  @@index([creatorId, status])
  @@index([opportunityId, status])
}

// AI-Suggested Opportunities for Exclusive Talent
// Generated by analyzing social profiles, followers, content, and brand intelligence
model AISuggestedOpportunity {
  id                    String    @id @default(cuid())
  talentId              String
  brandName             String
  vertical              String    // Industry/category (e.g. "Fashion", "Beauty", "Finance")
  confidenceScore       String    @default("medium") // "low", "medium", "high"
  rationale             String    // 1-2 sentence explanation of why this brand fits
  detectedSignals       String[]  // Array of signals (e.g. ["Brand works with similar creators", "Talent posted about related products"])
  suggestedCollabType   String    // "paid_post", "ambassador", "event", "product_launch", "long_term_partnership"
  status                String    @default("suggested") // "suggested", "saved", "dismissed", "converted"
  convertedOpportunityId String? // Links to created Opportunity if converted
  createdAt             DateTime  @default(now())
  lastReviewedAt        DateTime?
  dismissedAt           DateTime?
  convertedAt           DateTime?
  
  // Relations
  Talent                Talent    @relation(fields: [talentId], references: [id], onDelete: Cascade)

  @@index([talentId, status])
  @@index([createdAt])
  @@index([confidenceScore])
  @@unique([talentId, brandName]) // Prevent duplicate suggestions for same talent/brand combo
}

model Outreach {
  id                                  String                @id
  target                              String
  type                                String                @default("Brand")
  contact                             String?
  contactEmail                        String?
  link                                String?
  owner                               String?
  source                              String?
  stage                               String                @default("not-started")
  status                              String                @default("Not started")
  summary                             String?
  threadUrl                           String?
  gmailThreadId                       String?
  emailsSent                          Int                   @default(0)
  emailsReplies                       Int                   @default(0)
  lastContact                         DateTime?
  nextFollowUp                        DateTime?
  reminder                            String?
  opportunityRef                      String?
  archived                            Boolean               @default(false)
  linkedCreatorId                     String?
  linkedBrandId                       String?
  createdBy                           String
  createdAt                           DateTime              @default(now())
  updatedAt                           DateTime
  linkedCrmBrandId                    String?
  User_Outreach_createdByToUser       User                  @relation("Outreach_createdByToUser", fields: [createdBy], references: [id], onDelete: Cascade)
  Brand                               Brand?                @relation(fields: [linkedBrandId], references: [id])
  User_Outreach_linkedCreatorIdToUser User?                 @relation("Outreach_linkedCreatorIdToUser", fields: [linkedCreatorId], references: [id])
  CrmBrand                            CrmBrand?             @relation(fields: [linkedCrmBrandId], references: [id])
  OutreachEmailThread                 OutreachEmailThread[]
  OutreachNote                        OutreachNote[]
  OutreachTask                        OutreachTask[]
  SalesOpportunity                    SalesOpportunity?

  @@index([archived])
  @@index([createdBy])
  @@index([gmailThreadId])
  @@index([linkedBrandId])
  @@index([linkedCreatorId])
  @@index([linkedCrmBrandId])
  @@index([nextFollowUp])
  @@index([stage])
}

model OutreachAction {
  id           String    @id
  sequenceId   String
  stepId       String?
  leadId       String?
  actionType   String
  status       String    @default("pending")
  errorMessage String?
  scheduledAt  DateTime?
  executedAt   DateTime?
  runAt        DateTime?
  metadata     Json?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime

  @@index([scheduledAt])
  @@index([sequenceId])
  @@index([status])
}

model OutreachEmailThread {
  id            String   @id
  outreachId    String
  gmailThreadId String   @unique
  lastMessageAt DateTime
  status        String   @default("awaiting_reply")
  lastSyncedAt  DateTime @default(now())
  createdAt     DateTime @default(now())
  updatedAt     DateTime
  Outreach      Outreach @relation(fields: [outreachId], references: [id], onDelete: Cascade)

  @@index([gmailThreadId])
  @@index([outreachId])
  @@index([status])
}

model OutreachNote {
  id         String   @id
  outreachId String
  author     String
  body       String
  createdAt  DateTime @default(now())
  Outreach   Outreach @relation(fields: [outreachId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([outreachId])
}

model OutreachSequence {
  id        String   @id
  leadId    String
  name      String
  status    String   @default("active")
  metadata  Json?
  createdAt DateTime @default(now())
  updatedAt DateTime

  @@index([leadId])
  @@index([status])
}

model OutreachStep {
  id         String   @id
  sequenceId String
  stepNumber Int
  actionType String
  delay      Int?
  template   String?
  metadata   Json?
  createdAt  DateTime @default(now())
  updatedAt  DateTime

  @@index([sequenceId])
}

model OutreachTask {
  id         String    @id
  outreachId String
  title      String
  dueDate    DateTime?
  owner      String?
  priority   String    @default("Medium")
  status     String    @default("Open")
  createdAt  DateTime  @default(now())
  updatedAt  DateTime
  Outreach   Outreach  @relation(fields: [outreachId], references: [id], onDelete: Cascade)

  @@index([dueDate])
  @@index([outreachId])
  @@index([status])
}

model Payment {
  id                    String    @id
  dealId                String
  talentId              String?
  amount                Float
  status                String    @default("PENDING")
  expectedPaymentDate   DateTime?
  actualPaymentDate     DateTime?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime
  currency              String?   @default("usd")
  metadata              Json?
  stripePaymentIntentId String?   @unique
  Deal                  Deal      @relation(fields: [dealId], references: [id], onDelete: Cascade)
  Talent                Talent?   @relation(fields: [talentId], references: [id])

  @@index([status])
  @@index([stripePaymentIntentId])
}

model Commission {
  id           String    @id
  dealId       String
  invoiceId    String?
  talentId     String
  agentId      String? // Agent who managed the deal
  amount       Float // Commission amount
  percentage   Float // Commission percentage (e.g., 15.0 for 15%)
  currency     String    @default("USD")
  status       String    @default("pending") // pending, approved, paid
  payoutId     String? // Linked payout when commission is paid
  calculatedAt DateTime  @default(now())
  approvedAt   DateTime?
  paidAt       DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime
  Deal         Deal      @relation(fields: [dealId], references: [id], onDelete: Cascade)
  Invoice      Invoice?  @relation(fields: [invoiceId], references: [id], onDelete: SetNull)
  Talent       Talent    @relation(fields: [talentId], references: [id], onDelete: Cascade)
  Payout       Payout?   @relation(fields: [payoutId], references: [id], onDelete: SetNull)
  User         User?     @relation(fields: [agentId], references: [id], onDelete: SetNull)

  @@index([dealId])
  @@index([invoiceId])
  @@index([talentId])
  @@index([agentId])
  @@index([payoutId])
  @@index([status])
  @@index([calculatedAt])
}

model Payout {
  id               String       @id
  userId           String?
  referenceId      String?      @unique
  creatorId        String
  dealId           String
  brandId          String?
  amount           Float
  currency         String       @default("USD")
  status           String       @default("pending")
  expectedPayoutAt DateTime?
  paidAt           DateTime?
  createdBy        String?
  createdAt        DateTime     @default(now())
  updatedAt        DateTime
  Brand            Brand?       @relation(fields: [brandId], references: [id])
  User             User?        @relation(fields: [createdBy], references: [id])
  Talent           Talent       @relation(fields: [creatorId], references: [id], onDelete: Cascade)
  Deal             Deal         @relation(fields: [dealId], references: [id], onDelete: Cascade)
  Commission       Commission[] // One payout can cover multiple commissions

  @@index([brandId])
  @@index([creatorId])
  @@index([dealId])
  @@index([expectedPayoutAt])
  @@index([referenceId])
  @@index([status])
  @@index([userId])
}

model Resource {
  id               String             @id
  title            String
  shortDescription String
  longDescription  String?
  resourceType     ResourceType
  uploadUrl        String?
  externalUrl      String?
  thumbnailUrl     String?
  status           ResourceStatus     @default(DRAFT)
  visibility       ResourceVisibility @default(PUBLIC)
  allowedAudiences String[]           @default([])
  metadata         Json?
  eventDate        DateTime?
  eventTime        String?
  hasReplay        Boolean?
  rsvpEnabled      Boolean            @default(false)
  rsvpOpen         Boolean            @default(true)
  viewCount        Int                @default(0)
  createdById      String
  createdAt        DateTime           @default(now())
  updatedAt        DateTime
  uploadFilename   String?
  uploadFileType   String?
  uploadFileSize   Int?
  User             User               @relation(fields: [createdById], references: [id], onDelete: Cascade)
  ResourceRsvp     ResourceRsvp[]

  @@index([createdById])
  @@index([resourceType])
  @@index([status])
  @@index([visibility])
}

model ResourceRsvp {
  id         String   @id
  resourceId String
  userId     String
  status     String   @default("confirmed")
  createdAt  DateTime @default(now())
  updatedAt  DateTime
  Resource   Resource @relation(fields: [resourceId], references: [id], onDelete: Cascade)
  User       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([resourceId, userId])
  @@index([resourceId])
  @@index([userId])
}

// STATUS: UNUSED
// Risk scoring system - not currently wired to any workflows
model RiskEvent {
  id         String   @id
  userId     String?
  entityType String
  entityId   String
  riskScore  Int
  riskFlags  String[]
  details    Json?
  createdAt  DateTime @default(now())
  User       User?    @relation(fields: [userId], references: [id])
}

model SalesOpportunity {
  id              String    @id
  outreachId      String    @unique
  name            String
  value           Float
  currency        String    @default("USD")
  expectedCloseAt DateTime?
  status          String    @default("open")
  notes           String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime
  Deal            Deal?
  Outreach        Outreach  @relation(fields: [outreachId], references: [id], onDelete: Cascade)

  @@index([expectedCloseAt])
  @@index([outreachId])
  @@index([status])
}

model SignatureRequest {
  id           String    @id
  userId       String
  contractId   String?
  documentUrl  String
  signerEmail  String
  signedPdfUrl String?
  status       String    @default("pending")
  signedAt     DateTime?
  metadata     Json?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime

  @@index([contractId])
  @@index([signerEmail])
  @@index([status])
  @@index([userId])
}

model SocialAccountConnection {
  id             String          @id
  creatorId      String
  platform       String
  handle         String
  profileUrl     String? // URL or profile link (for validation/display)
  connected      Boolean         @default(false)
  connectionType String          @default("MANUAL") // MANUAL or OAUTH
  syncStatus     String          @default("PENDING") // PENDING, SYNCING, READY, ERROR
  accessToken    String?
  refreshToken   String?
  expiresAt      DateTime?
  lastSyncedAt   DateTime?
  syncError      String? // Error message if sync fails
  metadata       Json?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime
  Talent         Talent          @relation(fields: [creatorId], references: [id], onDelete: Cascade)
  SocialProfile  SocialProfile?
  SocialSyncLog  SocialSyncLog[]

  @@unique([creatorId, platform])
  @@index([creatorId, connected])
  @@index([syncStatus])
  @@index([platform])
}

model SocialProfile {
  id                String                  @id @default(cuid())
  connectionId      String                  @unique
  platform          String
  handle            String
  displayName       String?
  bio               String?
  profileImageUrl   String?
  followerCount     Int                     @default(0)
  followingCount    Int?
  postCount         Int?
  averageViews      Float?
  averageEngagement Float?
  engagementRate    Float?
  isVerified        Boolean                 @default(false)
  externalId        String?
  lastSyncedAt      DateTime?
  createdAt         DateTime                @default(now())
  updatedAt         DateTime
  metrics           SocialMetric[]
  posts             SocialPost[]
  connection        SocialAccountConnection @relation(fields: [connectionId], references: [id], onDelete: Cascade)

  @@index([platform, handle])
  @@index([connectionId])
}

model SocialPost {
  id             String        @id @default(cuid())
  profileId      String
  platform       String
  externalId     String
  caption        String?
  mediaType      String
  mediaUrl       String?
  thumbnailUrl   String?
  permalink      String?
  viewCount      Int?
  likeCount      Int?
  commentCount   Int?
  shareCount     Int?
  saveCount      Int?
  engagementRate Float?
  postedAt       DateTime
  lastSyncedAt   DateTime?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime
  profile        SocialProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@unique([platform, externalId])
  @@index([profileId, postedAt])
  @@index([platform, postedAt])
}

model SocialMetric {
  id           String        @id @default(cuid())
  profileId    String
  platform     String
  metricType   String
  value        Float
  snapshotDate DateTime      @default(now())
  metadata     Json?
  createdAt    DateTime      @default(now())
  profile      SocialProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([profileId, snapshotDate])
  @@index([metricType, snapshotDate])
}

model SocialSyncLog {
  id             String                  @id @default(cuid())
  connectionId   String
  platform       String
  syncType       String
  status         String
  itemsSynced    Int                     @default(0)
  errorMessage   String?
  errorCode      String?
  rateLimitHit   Boolean                 @default(false)
  rateLimitReset DateTime?
  startedAt      DateTime
  completedAt    DateTime?
  duration       Int?
  createdAt      DateTime                @default(now())
  connection     SocialAccountConnection @relation(fields: [connectionId], references: [id], onDelete: Cascade)

  @@index([connectionId, createdAt])
  @@index([platform, status])
  @@index([rateLimitHit])
}

// External social profile (not connected to talent, read-only snapshots)
model ExternalSocialProfile {
  id             String   @id @default(cuid())
  platform       String   // INSTAGRAM, TIKTOK, YOUTUBE
  username       String
  profileUrl     String
  snapshotJson   String   // Serialized profile data (follower count, bio, etc)
  lastFetchedAt  DateTime @default(now())
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@unique([platform, username])
  @@index([platform, lastFetchedAt])
  @@index([createdAt])
}

model TrendingTopicSnapshot {
  id              String   @id @default(cuid())
  talentId        String
  source          String   // GOOGLE, TIKTOK, YOUTUBE, REDDIT, TWITTER
  topic           String
  velocity        Float    // How fast it's rising (0-100 scale)
  volume          Float?   // Search/engagement volume if available
  category        String?  // Topic category for grouping
  relatedKeywords String[] @default([]) // Array of related keywords
  relevanceScore  Float    // How relevant to this talent (0-1)
  reasoning       String?  // Explanation of relevance
  snapshotJson    Json     // Full source data
  cachedUntil     DateTime // When this snapshot expires from cache
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([talentId, createdAt])
  @@index([talentId, source])
  @@index([createdAt])
}

model Submission {
  id            String       @id
  creatorId     String
  opportunityId String?
  title         String
  platform      String
  status        String       @default("draft")
  contentUrl    String?
  files         Json?
  revisions     Json?
  feedback      String?
  submittedAt   DateTime?
  approvedAt    DateTime?
  createdAt     DateTime     @default(now())
  updatedAt     DateTime
  User          User         @relation(fields: [creatorId], references: [id], onDelete: Cascade)
  Opportunity   Opportunity? @relation(fields: [opportunityId], references: [id])

  @@index([createdAt])
  @@index([creatorId, status])
  @@index([opportunityId])
}

model SuitabilityResult {
  id         String   @id
  creatorId  String
  brandId    String
  score      Int      @default(0)
  flags      String[]
  categories String[]
  reasoning  Json?
  aiSummary  String?
  createdAt  DateTime @default(now())
  Brand      Brand    @relation(fields: [brandId], references: [id], onDelete: Cascade)
  Talent     Talent   @relation(fields: [creatorId], references: [id], onDelete: Cascade)
}

model Talent {
  id                      String                    @id
  userId                  String                    @unique
  name                    String
  displayName             String? // Display name for UI
  legalName               String? // Legal name for contracts
  primaryEmail            String? // Primary contact email
  representationType      String? // EXCLUSIVE, NON_EXCLUSIVE, FRIEND_OF_HOUSE, UGC, FOUNDER
  status                  String? // ACTIVE, PAUSED, ARCHIVED
  managerId               String? // Admin manager ID (deprecated - use TalentManagerAssignment instead)
  currency                String                    @default("GBP") // Currency code: GBP, USD, EUR, AED, etc.
  notes                   String? // Internal notes
  categories              String[]
  stage                   String?
  profileImageUrl         String? // Auto-fetched social profile image URL
  profileImageSource      String                    @default("initials") // instagram | tiktok | youtube | manual | initials
  lastProfileImageSyncAt  DateTime? // Timestamp of last profile image sync
  socialIntelligenceNotes String? // Agent strategic notes on social intelligence
  analyticsNotes          String? // Admin notes from analytics dashboard
  comparisonNotes         String? // Comparison notes vs other profiles (stored as JSON)
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime                  @updatedAt
  AIPromptHistory         AIPromptHistory[]
  BrandSavedTalent        BrandSavedTalent[]
  CreatorEvent            CreatorEvent[]
  CreatorFitScore         CreatorFitScore[]
  CreatorGoal             CreatorGoal[]
  CreatorInsight          CreatorInsight[]
  CreatorTask             CreatorTask[]
  Deal                    Deal[]
  Payment                 Payment[]
  Payout                  Payout[]
  Commission              Commission[]
  InboundEmail            InboundEmail[]
  SocialAccountConnection SocialAccountConnection[]
  SuitabilityResult       SuitabilityResult[]
  User                    User                      @relation(fields: [userId], references: [id], onDelete: Cascade)
  TalentAssignment        TalentAssignment[]
  WellnessCheckin         WellnessCheckin[]
  TalentEmail             TalentEmail[]
  TalentTask              TalentTask[]
  TalentSocial            TalentSocial[]
  UserAccess              TalentUserAccess[]        @relation("TalentAccess")
  RevenueSource           RevenueSource[]
  RevenueGoal             RevenueGoal[]
  CommunityConnections    CommunityConnection[]
  ManagerAssignments      TalentManagerAssignment[] @relation("TalentManagers")
  AISuggestedOpportunities AISuggestedOpportunity[]
  
  // Contact Information & Personal Details (NEW)
  PersonalDetails         TalentPersonalDetails?
  Addresses               TalentAddress[]
  BankingDetails          TalentBankingDetails?
  TaxCompliance           TalentTaxCompliance?
  Representation          TalentRepresentation?
  Measurements            TalentMeasurements?
  TravelInfo              TalentTravelInfo?
  BrandPreferences        TalentBrandPreferences?
  InternalNotes           TalentInternalNotes?
  CreatorShortlist        CreatorShortlist[]     @relation("ShortlistTalent")
  Consent                 TalentConsent?
  Files                   TalentFile[]
  Meetings                Meeting[]
  MeetingActionItems      MeetingActionItem[]
  
  // Advanced Intelligence Features (NEW)
  ReminderSuggestions     SmartReminderSuggestion[]
  WeeklyBriefs            TalentWeeklyBrief[]
  CalendarWarnings        CalendarWarning[]
  Availability            TalentAvailability?
  BlackoutDates           TalentBlackoutDate[]
  HealthScoreSnapshots    HealthScoreSnapshot[]

  // Growth Initiatives System
  GrowthInitiatives       GrowthInitiative[]

  // Enterprise Operating System relations
  EnterpriseValueMetrics  EnterpriseValueMetrics?
  RevenueStreams          RevenueStream[]
  FounderDependencyIndex  FounderDependencyIndex?
  OwnedAssets             OwnedAsset[]
  RevenueArchitecture     RevenueArchitecture?
  ExitReadinessScore      ExitReadinessScore?

  @@index([lastProfileImageSyncAt])
  @@index([profileImageSource])
  @@index([currency])
}

model TalentEmail {
  id        String   @id @default(cuid())
  talentId  String
  email     String
  label     String? // e.g. "Manager", "Assistant", "Personal"
  isPrimary Boolean  @default(false)
  verified  Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  talent Talent @relation(fields: [talentId], references: [id], onDelete: Cascade)

  @@unique([talentId, email])
  @@index([talentId])
  @@index([email])
}

// Manager assignment - allows multiple managers per talent
model TalentManagerAssignment {
  id        String   @id @default(cuid())
  talentId  String
  managerId String
  role      String   @default("SECONDARY") // PRIMARY or SECONDARY manager
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  talent  Talent @relation("TalentManagers", fields: [talentId], references: [id], onDelete: Cascade)
  manager User   @relation("ManagerAssignments", fields: [managerId], references: [id], onDelete: Cascade)

  @@unique([talentId, managerId])
  @@index([talentId])
  @@index([managerId])
  @@index([role])
}

enum TaskStatus {
  PENDING
  COMPLETED
  CANCELLED
}

model TalentTask {
  id          String     @id @default(cuid())
  talentId    String
  title       String
  notes       String?
  dueDate     DateTime?
  status      TaskStatus @default(PENDING)
  createdBy   String
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  completedAt DateTime?

  talent Talent @relation(fields: [talentId], references: [id], onDelete: Cascade)

  @@index([talentId])
  @@index([status])
  @@index([dueDate])
}

model TalentSocial {
  id              String         @id @default(cuid())
  talentId        String
  platform        SocialPlatform
  handle          String
  url             String
  followers       Int?
  following       Int?
  postCount       Int?
  displayName     String?
  profileImageUrl String?
  verified        Boolean        @default(false)
  lastScrapedAt   DateTime?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  talent Talent @relation(fields: [talentId], references: [id], onDelete: Cascade)

  @@unique([talentId, platform, handle])
  @@index([talentId])
  @@index([platform])
}

model TalentAssignment {
  id        String   @id
  agentId   String
  talentId  String
  createdAt DateTime @default(now())
  User      User     @relation(fields: [agentId], references: [id], onDelete: Cascade)
  Talent    Talent   @relation(fields: [talentId], references: [id], onDelete: Cascade)

  @@unique([agentId, talentId])
}

model TalentUserAccess {
  id                   String   @id @default(cuid())
  talentId             String
  userId               String
  role                 String   @default("VIEW") // VIEW | MANAGE
  representationType   String   @default("NON_EXCLUSIVE") // EXCLUSIVE | NON_EXCLUSIVE | MANAGEMENT | UGC | OTHER
  status               String   @default("ACTIVE") // ACTIVE | INACTIVE
  notes                String? // Notes about this user's relationship to talent
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  Talent Talent @relation("TalentAccess", fields: [talentId], references: [id], onDelete: Cascade)
  User   User   @relation("TalentAccessGiven", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([talentId, userId])
  @@index([talentId])
  @@index([userId])
  @@index([representationType])
  @@index([status])
}

model TrackingPixelEvent {
  id           String       @id
  emailId      String
  openedAt     DateTime     @default(now())
  ip           String?
  userAgent    String?
  metadata     Json?
  InboundEmail InboundEmail @relation(fields: [emailId], references: [id], onDelete: Cascade)

  @@index([emailId])
  @@index([openedAt])
}

model EmailClickEvent {
  id           String       @id
  emailId      String
  clickedAt    DateTime     @default(now())
  linkUrl      String // The URL that was clicked
  ip           String?
  userAgent    String?
  metadata     Json?
  InboundEmail InboundEmail @relation(fields: [emailId], references: [id], onDelete: Cascade)

  @@index([emailId])
  @@index([clickedAt])
}

model User {
  id                                      String                    @id
  email                                   String                    @unique
  password                                String?
  name                                    String?
  avatarUrl                               String?
  createdAt                               DateTime                  @default(now())
  updatedAt                               DateTime
  accountType                             String?
  admin_notes                             String?
  bio                                     String?
  creator_score                           Int?
  creator_score_reason                    Json?
  friends_of_house_id                     String?
  include_in_roster                       Boolean                   @default(false)
  location                                String?
  managedTalentIds                        String[]                  @default([])
  onboardingComplete                      Boolean?                  @default(false)
  onboardingSkippedAt                     DateTime?
  onboarding_responses                    Json?
  onboarding_status                       String?                   @default("pending_review")
  pronouns                                String?
  role                                    String                    @default("CREATOR")
  role_recommended                        String?
  roster_category                         String?
  socialLinks                             Json?
  status                                  String?
  subscriptionStatus                      String?                   @default("free")
  timezone                                String?
  ugcApproved                             Boolean                   @default(false)
  ugcRates                                Json?
  ugc_categories                          String[]                  @default([])
  ugc_portfolio_url                       String?
  upgrade_suggested                       Boolean?                  @default(false)
  resetToken                              String?
  resetTokenExpiry                        DateTime?
  AgentProfile                            AgentProfile?
  AgentPolicy                             AgentPolicy?
  AiTokenLog                              AiTokenLog[]
  ApprovalsCreated                        Approval[]                @relation("ApprovalRequestor")
  ApprovalsHandled                        Approval[]                @relation("ApprovalApprover")
  AuditLog                                AuditLog[]
  BrandCampaign                           BrandCampaign[]
  CalendarEventsCreated                   CalendarEvent[]           @relation("CalendarEventCreator")
  CreatorEvent                            CreatorEvent[]
  CreatorTask                             CreatorTask[]
  CrmTasksCreated                         CrmTask[]                 @relation("TaskCreatedBy")
  CrmTasksOwned                           CrmTask[]                 @relation("TaskOwner")
  AdminTasksAssignedBy                    AdminTask[]               @relation("AdminTaskAssignedBy")
  AdminTasksAssignedTo                    AdminTask[]               @relation("AdminTaskAssignedTo")
  Deal                                    Deal[]
  DealTimeline                            DealTimeline[]
  EmailFeedback                           EmailFeedback[]
  EmailOpportunity                        EmailOpportunity[]
  File                                    File[]
  FinanceActivityLog                      FinanceActivityLog[]
  FinanceDocument                         FinanceDocument[]
  FinanceReconciliation                   FinanceReconciliation[]
  GmailToken                              GmailToken?
  GoogleAccount                           GoogleAccount?
  Inbox                                   Inbox[]
  InboundEmail                            InboundEmail[]
  InternalTasksAssigned                   InternalQueueTask[]       @relation("InternalTaskAssignedTo")
  InternalTasksCreated                    InternalQueueTask[]       @relation("InternalTaskCreatedBy")
  Notification                            Notification[]
  OpportunityApplication                  OpportunityApplication[]
  Outreach_Outreach_createdByToUser       Outreach[]                @relation("Outreach_createdByToUser")
  Outreach_Outreach_linkedCreatorIdToUser Outreach[]                @relation("Outreach_linkedCreatorIdToUser")
  Payout                                  Payout[]
  Commission                              Commission[]
  Resource                                Resource[]
  ResourceRsvp                            ResourceRsvp[]
  RiskEvent                               RiskEvent[]
  Submission                              Submission[]
  Talent                                  Talent?
  TalentAssignment                        TalentAssignment[]
  TalentAccessGiven                       TalentUserAccess[]        @relation("TalentAccessGiven")
  ManagerAssignments                      TalentManagerAssignment[] @relation("ManagerAssignments")
  PageBlockCreatedBy                      PageBlock[]               @relation("PageBlockCreatedBy")
  PageBlockDraftCreatedBy                 PageBlockDraft[]          @relation("PageBlockDraftCreatedBy")
  UGCRequests                             UGCRequest[]              @relation("UGCRequests")
  DealDrafts                              DealDraft[]               @relation("DealDrafts")
  OutreachPlans                           OutreachPlan[]            @relation("OutreachPlans")
  UGCListings                             UGCListing[]              @relation("UGCListings")
  IntegrationConnection                   IntegrationConnection[]
  XeroConnections                         XeroConnection[]
  ExportSchedules                         ExportSchedule[]
  UserDashboardConfigs                    UserDashboardConfig[]
  BrandUsers                              BrandUser[]
  TalentFilesUploaded                     TalentFile[]            @relation("TalentFileUploader")
  MeetingsCreated                         Meeting[]               @relation("MeetingCreator")
  
  // BRAND CAMPAIGN WORKFLOW RELATIONS (NEW)
  CampaignsSubmitted                      CrmCampaign[]           @relation("CampaignSubmittedBy")
  ShortlistsAddedBy                       CreatorShortlist[]      @relation("ShortlistAddedBy")
  ShortlistsApprovedBy                    CreatorShortlist[]      @relation("ShortlistBrandApprovedBy")
  ShortlistsOverrideBy                    CreatorShortlist[]      @relation("ShortlistAdminOverrideBy")
  CampaignApprovalsActedOn                CampaignApproval[]      @relation("CampaignApprovalActor")
  CampaignFeedbackSubmitted               CampaignFeedback[]      @relation("CampaignFeedbackSubmittedBy")
  ReportsApprovedBy                       CampaignReport[]        @relation("ReportApprovedBy")
  
  // ASSISTED OUTREACH RELATIONS (NEW)
  OutreachCampaignsCreated                OutreachCampaign[]      @relation("OutreachCampaignCreatedBy")
  OutreachCampaignsSent                   OutreachCampaign[]      @relation("OutreachCampaignSender")
  OutreachDraftsApproved                  OutreachDraft[]
  
  // GROWTH INITIATIVES RELATIONS (NEW)
  GrowthInitiativesCreated                GrowthInitiative[]      @relation("GrowthInitiativeCreator")
  GrowthInputsAsContributor               GrowthInput[]           @relation("GrowthInputContributor")
  GrowthOutputsAsContributor              GrowthOutput[]          @relation("GrowthOutputContributor")
  
  // BRAND ONBOARDING RELATION
  BrandProfile                            BrandProfile?
  
  // FOUNDER ONBOARDING RELATION
  FounderProfile                          FounderProfile?
}

model WellnessCheckin {
  id          String   @id
  creatorId   String
  energyLevel Int
  workload    String
  notes       String?
  createdAt   DateTime @default(now())
  Talent      Talent   @relation(fields: [creatorId], references: [id], onDelete: Cascade)

  @@index([creatorId, createdAt])
}

model XeroConnection {
  id           String    @id
  userId       String? // Link to user if applicable
  connected    Boolean   @default(false)
  tenantId     String?
  accessToken  String?
  refreshToken String?
  expiresAt    DateTime?
  lastSyncedAt DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime
  User         User?     @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([userId])
}

// V1.1: Integration Connection Model for Slack, Notion, Google Drive
model IntegrationConnection {
  id            String    @id @default(cuid())
  userId        String
  platform      String // "slack", "notion", "google_drive"
  connected     Boolean   @default(false)
  accessToken   String?
  refreshToken  String?
  expiresAt     DateTime?
  webhookUrl    String? // For Slack webhooks
  workspaceId   String? // For Notion workspace
  workspaceName String? // For Notion workspace name
  metadata      Json? // Platform-specific data
  lastSyncedAt  DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  User          User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, platform])
  @@index([userId, connected])
  @@index([platform])
}

model BrandSavedTalent {
  id        String   @id
  brandId   String
  talentId  String
  status    String   @default("saved")
  notes     String?
  addedAt   DateTime @default(now())
  updatedAt DateTime @updatedAt
  Brand     Brand    @relation(fields: [brandId], references: [id], onDelete: Cascade)
  Talent    Talent   @relation(fields: [talentId], references: [id], onDelete: Cascade)

  @@unique([brandId, talentId])
  @@index([brandId, status])
  @@index([talentId])
}

// Phase 5: BrandBrief model for briefs feature
model BrandBrief {
  id             String       @id
  brandId        String
  title          String
  description    String?
  deliverables   String[]
  budget         String?
  deadline       DateTime?
  status         String       @default("draft") // draft, published, closed
  createdBy      String
  versionHistory Json[]       @default([])
  metadata       Json?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  BriefMatch     BriefMatch[]

  @@index([brandId])
  @@index([status])
  @@index([createdBy])
}

// Phase 5: BriefMatch model for matching briefs to creators
model BriefMatch {
  id         String     @id
  briefId    String
  creatorId  String
  matchScore Float
  status     String     @default("pending") // pending, accepted, rejected
  notes      String?
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt
  Brief      BrandBrief @relation(fields: [briefId], references: [id], onDelete: Cascade)

  @@unique([briefId, creatorId])
  @@index([briefId])
  @@index([creatorId])
  @@index([status])
}

// Phase 5: OutreachLead model
model OutreachLead {
  id                    String   @id
  brandName             String
  contactName           String?
  contactEmail          String?
  contactPhone          String?
  website               String?
  industry              String?
  status                String   @default("new") // new, contacted, qualified, converted, lost
  source                String?
  notes                 String?
  convertedToOutreachId String?
  createdBy             String
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  @@index([status])
  @@index([createdBy])
  @@index([convertedToOutreachId])
}

// Phase 5: CreatorWeeklyReport model
model CreatorWeeklyReport {
  id            String   @id
  creatorId     String
  weekStartDate DateTime
  weekEndDate   DateTime
  summary       String?
  metrics       Json?
  highlights    String[]
  challenges    String[]
  nextWeekGoals String[]
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@unique([creatorId, weekStartDate])
  @@index([creatorId])
  @@index([weekStartDate])
}

// Phase 5: DealIntelligence model
model DealIntelligence {
  id               String   @id
  dealId           String   @unique
  summary          String?
  riskFlags        String[]
  performanceNotes String[]
  insights         Json?
  generatedAt      DateTime @default(now())
  updatedAt        DateTime @updatedAt

  @@index([dealId])
}

// Phase 5: Bundle model
model Bundle {
  id           String   @id
  name         String
  description  String?
  priceMin     Float?
  priceMax     Float?
  deliverables Json?
  dealId       String?
  creatorId    String?
  status       String   @default("active") // active, archived
  createdBy    String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([dealId])
  @@index([creatorId])
  @@index([status])
}

model CreatorFitScore {
  id                 String   @id
  brandId            String
  talentId           String
  campaignId         String?
  totalScore         Int      @default(0)
  audienceScore      Int      @default(0)
  engagementScore    Int      @default(0)
  historyScore       Int      @default(0)
  categoryScore      Int      @default(0)
  explanation        String?
  calculationDetails Json?
  createdAt          DateTime @default(now())
  Brand              Brand    @relation(fields: [brandId], references: [id], onDelete: Cascade)
  Talent             Talent   @relation(fields: [talentId], references: [id], onDelete: Cascade)

  @@index([brandId, totalScore])
  @@index([talentId])
  @@index([campaignId])
}

enum DealStage {
  NEW_LEAD
  NEGOTIATION
  CONTRACT_SENT
  CONTRACT_SIGNED
  DELIVERABLES_IN_PROGRESS
  PAYMENT_PENDING
  PAYMENT_RECEIVED
  COMPLETED
  LOST
}

enum ResourceStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum ResourceType {
  TEMPLATE
  GUIDE
  ARTICLE
  WEBINAR
  EVENT
}

enum ResourceVisibility {
  PUBLIC
  PROTECTED
}

enum SocialPlatform {
  TIKTOK
  INSTAGRAM
  YOUTUBE
  X
  LINKEDIN
  FACEBOOK
  GMAIL
}

// ============================================
// CMS: Block-Based Content Management
// ============================================

enum PageRoleScope {
  PUBLIC
  CREATOR
  FOUNDER
  ADMIN
}

enum BlockType {
  HERO
  TEXT
  IMAGE
  SPLIT
  ANNOUNCEMENT
  SPACER
}

model Page {
  id        String           @id @default(cuid())
  slug      String           @unique
  title     String
  roleScope PageRoleScope    @default(PUBLIC)
  isActive  Boolean          @default(true)
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
  blocks    PageBlock[]
  drafts    PageBlockDraft[]

  @@index([slug])
  @@index([roleScope])
  @@index([isActive])
}

model PageBlock {
  id          String    @id @default(cuid())
  pageId      String
  blockType   BlockType
  contentJson Json // Validated per block type
  order       Int       @default(0)
  isVisible   Boolean   @default(true)
  createdBy   String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  Page        Page      @relation(fields: [pageId], references: [id], onDelete: Cascade)
  CreatedBy   User?     @relation("PageBlockCreatedBy", fields: [createdBy], references: [id], onDelete: SetNull)

  @@index([pageId])
  @@index([pageId, order])
  @@index([blockType])
}

// Draft state for preview mode (optional, can use isPublished flag on PageBlock if preferred)
model PageBlockDraft {
  id          String    @id @default(cuid())
  pageId      String
  blockId     String? // null for new blocks
  blockType   BlockType
  contentJson Json
  order       Int
  isVisible   Boolean   @default(true)
  createdBy   String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  Page        Page      @relation(fields: [pageId], references: [id], onDelete: Cascade)
  CreatedBy   User?     @relation("PageBlockDraftCreatedBy", fields: [createdBy], references: [id], onDelete: SetNull)

  @@index([pageId])
  @@index([pageId, order])
}

// Missing models - added for TypeScript compatibility
model UGCRequest {
  id        String    @id @default(cuid())
  userId    String
  status    String    @default("pending")
  brief     String?
  budget    Float?
  deadline  DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  User      User      @relation("UGCRequests", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
}

model DealDraft {
  id        String   @id @default(cuid())
  userId    String
  dealId    String?
  data      Json?
  status    String   @default("draft")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  User      User     @relation("DealDrafts", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([dealId])
  @@index([status])
}

model OutreachPlan {
  id        String   @id @default(cuid())
  userId    String
  name      String
  targets   Json?
  status    String   @default("draft")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  User      User     @relation("OutreachPlans", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
}

model BrandIntelligence {
  id        String   @id @default(cuid())
  brandId   String
  insights  Json?
  category  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([brandId])
  @@index([category])
}

model NegotiationInsight {
  id        String   @id @default(cuid())
  dealId    String
  insight   String?
  metadata  Json?
  createdAt DateTime @default(now())

  @@index([dealId])
}

model UGCListing {
  id          String   @id @default(cuid())
  userId      String
  title       String
  description String?
  rate        Float?
  status      String   @default("active")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  User        User     @relation("UGCListings", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
}

model Reconciliation {
  id          String   @id @default(cuid())
  type        String
  referenceId String
  invoiceId   String?  @unique
  amount      Float
  status      String   @default("pending")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([referenceId])
  @@index([type])
}

model RevenueSource {
  id                String    @id @default(cuid())
  talentId          String
  platform          String // SHOPIFY, TIKTOK_SHOP, LTK, AMAZON, CUSTOM
  displayName       String // e.g. "The Break Store", "Glow Up Shop"
  externalAccountId String? // Platform-specific account ID (encrypted in future)
  status            String    @default("CONNECTED") // CONNECTED, DISCONNECTED, ERROR, PAUSED
  apiKeyHash        String? // Hashed API key for validation (never store plain)
  lastSyncedAt      DateTime? // Last time we pulled revenue data
  syncError         String? // Error message from last sync attempt
  metadata          Json? // Platform-specific config (store ID, API endpoint, etc.)
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  Talent       Talent         @relation(fields: [talentId], references: [id], onDelete: Cascade)
  RevenueEvent RevenueEvent[]

  @@unique([talentId, platform, externalAccountId])
  @@index([talentId])
  @@index([platform])
  @@index([status])
  @@index([talentId, platform]) // For finding all Shopify stores for a talent
}

model RevenueEvent {
  id              String   @id @default(cuid())
  revenueSourceId String
  date            DateTime // Date the revenue occurred
  grossAmount     Float // Gross/total revenue
  netAmount       Float // Net after fees/commissions
  currency        String   @default("GBP") // Always store with currency
  type            String // SALE, COMMISSION, REFUND, PAYOUT, OTHER
  sourceReference String? // Platform transaction ID (for deduplication)
  metadata        Json? // Platform-specific data
  createdAt       DateTime @default(now())

  RevenueSource RevenueSource @relation(fields: [revenueSourceId], references: [id], onDelete: Cascade)

  @@unique([revenueSourceId, sourceReference]) // Prevent duplicate transactions
  @@index([revenueSourceId])
  @@index([date])
  @@index([type])
  @@index([revenueSourceId, date]) // For aggregation queries
}

model RevenueGoal {
  id           String   @id @default(cuid())
  talentId     String
  goalType     String // MONTHLY_TOTAL, QUARTERLY_TOTAL, ANNUAL_TOTAL, PLATFORM_SPECIFIC
  platform     String? // NULL for total, or SHOPIFY, TIKTOK_SHOP, etc. for platform-specific
  targetAmount Float
  currency     String   @default("GBP")
  timeframe    Json // { startDate, endDate } for custom periods
  notes        String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  Talent Talent @relation(fields: [talentId], references: [id], onDelete: Cascade)

  @@unique([talentId, goalType, platform])
  @@index([talentId])
  @@index([goalType])
}

model UserDashboardConfig {
  id             String   @id @default(cuid())
  userId         String
  dashboardType  String // ADMIN_OVERVIEW, TALENT_OVERVIEW, EXCLUSIVE_TALENT_OVERVIEW
  snapshots      Json // Array of { snapshotId, enabled, order }
  customizations Json? // Additional user preferences per snapshot
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, dashboardType])
  @@index([userId])
  @@index([dashboardType])
}

// Brand User Management
model BrandUser {
  id          String    @id @default(cuid())
  brandId     String
  userId      String
  role        String    @default("VIEWER") // ADMIN, EDITOR, VIEWER
  status      String    @default("ACTIVE") // ACTIVE, INVITED, INACTIVE
  invitedAt   DateTime?
  acceptedAt  DateTime?
  permissions Json? // Extensible permissions JSON
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  brand Brand @relation(fields: [brandId], references: [id], onDelete: Cascade)
  user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([brandId, userId])
  @@index([brandId])
  @@index([userId])
  @@index([status])
}

// Audit Source Tracking (Foundation for AI insights)
model AuditSource {
  id            String    @id @default(cuid())
  brandId       String
  type          String // website | social | community | product | campaign
  source        String // Specific source identifier
  status        String    @default("pending") // connected | pending | error
  metadata      Json? // Flexible metadata for different audit types
  lastCheckedAt DateTime?
  error         String? // Error message if status is error
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  brand Brand @relation(fields: [brandId], references: [id], onDelete: Cascade)

  @@unique([brandId, type, source])
  @@index([brandId])
  @@index([type])
  @@index([status])
}

// Community Management Foundation
model CommunityConnection {
  id            String    @id @default(cuid())
  talentId      String
  platform      String // instagram | tiktok | twitter | youtube | linkedin | discord | threads
  status        String    @default("pending") // connected | pending | error | inactive
  accountHandle String? // username, handle, or ID on platform
  followers     Int       @default(0)
  metadata      Json? // platform-specific data (engagement rate, follower growth, etc.)
  lastSyncedAt  DateTime?
  error         String? // error message if status is error
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  talent  Talent            @relation(fields: [talentId], references: [id], onDelete: Cascade)
  metrics CommunityMetric[]

  @@unique([talentId, platform])
  @@index([talentId])
  @@index([platform])
  @@index([status])
}

// Community Metrics (Engagement Quality)
model CommunityMetric {
  id           String   @id @default(cuid())
  connectionId String
  talentId     String
  platform     String
  metricType   String // engagement_rate | comments_vs_likes | saves_shares | repeat_commenters | response_velocity
  value        Float
  data         Json? // Flexible data structure for different metric types
  period       String   @default("week") // day | week | month | lifetime
  calculatedAt DateTime @default(now())
  createdAt    DateTime @default(now())

  connection CommunityConnection @relation(fields: [connectionId], references: [id], onDelete: Cascade)

  @@unique([connectionId, metricType, period])
  @@index([talentId])
  @@index([connectionId])
  @@index([metricType])
}

// Scheduled Export Configuration
model ExportSchedule {
  id            String    @id @default(cuid())
  talentId      String
  userId        String
  email         String    // Email to send exports to
  frequency     String    @default("weekly") // daily | weekly
  dayOfWeek     Int       @default(1) // 0-6 (Sunday=0, Monday=1, etc) for weekly exports
  enabled       Boolean   @default(true)
  lastExportAt  DateTime? // Timestamp of last export sent
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([talentId, userId])
  @@index([userId])
  @@index([enabled])
}

// ============================================================
// CONTACT INFORMATION & PERSONAL DETAILS MODELS
// ============================================================

// Core identity and legal information (LOCKED SECTION)
model TalentPersonalDetails {
  id                      String    @id @default(cuid())
  talentId                String    @unique
  
  // Legal Identity
  legalFirstName          String?
  legalLastName           String?
  preferredName           String?
  dateOfBirth             DateTime?
  nationality             String?   // ISO country code
  countryOfResidence      String?   // ISO country code
  taxResidencyCountry     String?   // ISO country code
  
  // Government ID (ENCRYPTED)
  governmentIdType        String?   // PASSPORT | NATIONAL_ID | DRIVER_LICENCE
  governmentIdNumber      String?   @db.Text // Encrypted
  idExpiryDate            DateTime?
  idDocumentUrl           String?   // S3 URL to uploaded ID document
  
  // Additional Contact
  secondaryEmail          String?
  mobilePhoneNumber       String?   @db.Text // Encrypted
  whatsappNumber          String?   @db.Text // Encrypted
  emergencyContactName    String?
  emergencyContactRelationship String?
  emergencyContactPhone   String?   @db.Text // Encrypted
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  updatedBy               String?   // User ID who made the update
  
  talent                  Talent    @relation(fields: [talentId], references: [id], onDelete: Cascade)
  
  @@index([talentId])
  @@index([dateOfBirth])
}

// Multiple addresses support
model TalentAddress {
  id                      String    @id @default(cuid())
  talentId                String
  
  label                   String    @default("Home") // Home | Business | Shipping | Temporary
  addressLine1            String
  addressLine2            String?
  city                    String
  stateCounty             String?
  postcode                String?
  country                 String    // ISO country code
  
  isPrimary               Boolean   @default(false)
  isShippingAddress       Boolean   @default(false)
  notes                   String?   // Access instructions, concierge info, etc
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  talent                  Talent    @relation(fields: [talentId], references: [id], onDelete: Cascade)
  
  @@unique([talentId, isPrimary]) // Only one primary per talent (partially unique)
  @@index([talentId])
  @@index([isPrimary])
  @@index([isShippingAddress])
}

// Banking & Payment Details (LOCKED SECTION)
model TalentBankingDetails {
  id                      String    @id @default(cuid())
  talentId                String    @unique
  
  accountHolderName       String?
  bankName                String?
  accountType             String?   // Personal | Business
  accountNumber           String?   @db.Text // Encrypted
  sortCode                String?   // UK sort code (Encrypted)
  iban                    String?   @db.Text // International (Encrypted)
  swiftBic                String?   @db.Text // SWIFT code (Encrypted)
  currency                String?   @default("GBP")
  countryOfBank           String?   // ISO country code
  
  preferredPaymentMethod  String?   // BankTransfer | PayPal | Wise
  paypalEmail             String?
  wiseAccountId           String?   // Encrypted
  
  notes                   String?   // e.g. "Invoices handled by accountant"
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  updatedBy               String?   // User ID who made the update
  
  talent                  Talent    @relation(fields: [talentId], references: [id], onDelete: Cascade)
  
  @@index([talentId])
}

// Tax & Compliance Information (LOCKED SECTION)
model TalentTaxCompliance {
  id                      String    @id @default(cuid())
  talentId                String    @unique
  
  taxStatus               String?   // Individual | SoleTrader | LimitedCompany
  companyName             String?
  companyRegistrationNumber String?
  
  vatRegistered           Boolean   @default(false)
  vatNumber               String?   @db.Text // Encrypted
  
  // UK Tax
  utr                     String?   @db.Text // Encrypted (Unique Taxpayer Reference)
  
  // US Tax
  einSsn                  String?   @db.Text // Encrypted (masked SSN)
  
  withholdingTaxRequired  Boolean   @default(false)
  
  // Tax Documents
  taxFormsUploaded        String[]  // Array of form types: W-8BEN, W-9, Other
  
  accountantContactName   String?
  accountantEmail         String?
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  updatedBy               String?   // User ID who made the update
  
  talent                  Talent    @relation(fields: [talentId], references: [id], onDelete: Cascade)
  
  @@index([talentId])
  @@index([taxStatus])
}

// Representation & Contracts
model TalentRepresentation {
  id                      String    @id @default(cuid())
  talentId                String    @unique
  
  representationType      String    // Exclusive | Non-exclusive
  representationStartDate DateTime?
  representationEndDate   DateTime?
  
  agencyCommissionPercent Float?
  
  contractSigned          Boolean   @default(false)
  contractUrl             String?   // S3 URL to uploaded contract
  
  territoriesCovered      String[]  // List of country codes or regions
  
  notes                   String?   // Special clauses, terms, etc
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  talent                  Talent    @relation(fields: [talentId], references: [id], onDelete: Cascade)
  
  @@index([talentId])
}

// Sizing & Measurements for fashion/beauty
model TalentMeasurements {
  id                      String    @id @default(cuid())
  talentId                String    @unique
  
  // Clothing
  clothingSize            String?   // UK/EU/US
  dressSize               String?
  topSize                 String?
  bottomSize              String?
  shoeSize                String?   // UK/EU/US
  height                  String?   // e.g. "5'9\"" or "175cm"
  bodyTypeNotes           String?
  
  // Beauty
  skinTone                String?
  skinType                String?
  hairType                String?
  hairColour              String?
  allergiesSensitivities  String?
  makeupPreferences       String?
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  talent                  Talent    @relation(fields: [talentId], references: [id], onDelete: Cascade)
  
  @@index([talentId])
}

// Travel & Logistics Information (LOCKED SECTION)
model TalentTravelInfo {
  id                      String    @id @default(cuid())
  talentId                String    @unique
  
  passportNumber          String?   @db.Text // Encrypted
  passportExpiryDate      DateTime?
  passportCountry         String?   // ISO country code
  
  visaStatusByCountry     String?   @db.Text // JSON object with country visa info
  
  preferredAirport        String?   // IATA code
  preferredSeat           String?   // Aisle | Window
  frequentFlyerPrograms   String[]  // Array of program names/numbers
  
  hotelPreferences        String?
  dietaryRequirements     String?
  accessibilityRequirements String?
  
  travelNotes             String?
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  updatedBy               String?   // User ID who made the update
  
  talent                  Talent    @relation(fields: [talentId], references: [id], onDelete: Cascade)
  
  @@index([talentId])
}

// Brand Safety & Content Preferences
model TalentBrandPreferences {
  id                      String    @id @default(cuid())
  talentId                String    @unique
  
  restrictedCategories    String[]  // e.g. gambling, alcohol, weapons, etc
  competitorConflicts     String[]  // Competitor brand names
  brandAlignmentNotes     String?
  
  previousBrandBlacklist  String[]  // Brands never to work with
  exclusivityRestrictions String?
  
  // Approval required for:
  approvalRequiredForGifting Boolean @default(false)
  approvalRequiredForUsageExtensions Boolean @default(false)
  approvalRequiredForPaidAds Boolean @default(false)
  
  usageRightsPreferences  String?   // Notes on usage rights preferences
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  talent                  Talent    @relation(fields: [talentId], references: [id], onDelete: Cascade)
  
  @@index([talentId])
}

// Internal Admin Notes (LOCKED SECTION - hidden from talent)
model TalentInternalNotes {
  id                      String    @id @default(cuid())
  talentId                String    @unique
  
  riskFlags               String[]  // Risk flags
  latePaymentHistory      Boolean   @default(false)
  
  preferredBrands         String[]  // Brands we like working with
  
  negotiationNotes        String?
  specialHandlingInstructions String?
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  updatedBy               String    // Admin user ID
  
  talent                  Talent    @relation(fields: [talentId], references: [id], onDelete: Cascade)
  
  @@index([talentId])
}

// Consent & Legal Confirmations
model TalentConsent {
  id                      String    @id @default(cuid())
  talentId                String    @unique
  
  consentPersonalDataStorage Boolean @default(false)
  consentBankingDetailsStorage Boolean @default(false)
  consentShareDetailsWithBrands Boolean @default(false)
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  updatedBy               String?   // User ID who made the update
  
  talent                  Talent    @relation(fields: [talentId], references: [id], onDelete: Cascade)
  
  @@index([talentId])
}

// Files & Assets - Media kit, rate cards, press imagery, contracts, etc.
model TalentFile {
  id                      String    @id @default(cuid())
  talentId                String
  
  // File metadata
  fileName                String
  fileType                String    // image / video / pdf / doc / audio / other
  mimeType                String    
  fileSize                Int       // in bytes
  
  // Organization
  category                String    // "Media Kit" | "Rate Card" | "Press" | "Campaign Assets" | "Contracts" | "Other"
  
  // Storage
  storageProvider         String    @default("s3") // s3 / gcs / local
  storagePath             String    // Full path in storage
  storageUrl              String?   // Public or signed URL
  
  // Access & Permissions
  visibility              String    @default("admin-only") // admin-only | talent-admin
  uploadedBy              String
  
  // Metadata
  description             String?
  tags                    String[]  @default([])
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  
  // Relations
  talent                  Talent    @relation(fields: [talentId], references: [id], onDelete: Cascade)
  uploadedByUser          User      @relation("TalentFileUploader", fields: [uploadedBy], references: [id], onDelete: Restrict)
  
  @@index([talentId])
  @@index([category])
  @@index([createdAt])
  @@index([uploadedBy])
}

// Meetings - Track talent meetings, notes, action items, and calendar sync
model Meeting {
  id                String    @id @default(cuid())
  talentId          String
  
  // Meeting details
  title             String
  description       String?   // Agenda or meeting purpose
  meetingType       String    @default("Internal") // Internal | Talent | Brand
  platform          String    @default("In-Person") // Zoom | Google Meet | In-Person | Phone | Other
  meetingLink       String?   // Zoom/Google Meet link
  
  // Timing
  startTime         DateTime
  endTime           DateTime?
  
  // Notes & Summary
  notes             String?   // Rich text or markdown notes
  summary           String?   // AI-generated or manual summary
  
  // Calendar sync
  calendarEventId   String?   // External calendar event ID (Google Calendar, etc.)
  calendarProvider  String    @default("google") // google | outlook | other
  
  // Metadata
  createdBy         String    // User ID who created this meeting
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  // Relations
  talent            Talent    @relation(fields: [talentId], references: [id], onDelete: Cascade)
  createdByUser     User      @relation("MeetingCreator", fields: [createdBy], references: [id], onDelete: Restrict)
  actionItems       MeetingActionItem[]
  
  @@index([talentId])
  @@index([startTime])
  @@index([createdAt])
  @@index([calendarEventId])
}

// Action items extracted from or created during meetings
model MeetingActionItem {
  id                String    @id @default(cuid())
  meetingId         String
  talentId          String
  
  // Task details
  title             String
  description       String?
  dueDate           DateTime?
  
  // Status tracking
  status            String    @default("open") // open | completed | cancelled
  
  // Integration with Tasks system
  linkedTaskId      String?   // Links to global Task system (if converted)
  
  // Metadata
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  completedAt       DateTime?
  
  // Relations
  meeting           Meeting   @relation(fields: [meetingId], references: [id], onDelete: Cascade)
  talent            Talent    @relation(fields: [talentId], references: [id], onDelete: Cascade)
  
  @@index([meetingId])
  @@index([talentId])
  @@index([status])
  @@index([dueDate])
  @@index([linkedTaskId])
}

// ============================================================================
// ENTERPRISE OPERATING SYSTEM MODELS
// ============================================================================

// Core enterprise value metrics dashboard
model EnterpriseValueMetrics {
  id                        String   @id @default(cuid())
  talentId                  String   @unique
  
  // Revenue breakdown (%)
  recurringRevenuePercent   Decimal  @db.Decimal(5, 2) @default(0)
  founderDependentPercent   Decimal  @db.Decimal(5, 2) @default(0)
  creatorOwnedPercent       Decimal  @db.Decimal(5, 2) @default(0)
  
  // Risk metrics
  revenueConcentrationRisk  Decimal  @db.Decimal(5, 2) @default(0) // % from top 3
  platformDependencyScore   Int      @default(0) // 0-100
  monthlyRecurringRevenue   Decimal  @db.Decimal(15, 2) @default(0)
  mrrGrowthRate             Decimal  @db.Decimal(5, 2) @default(0) // %
  projectedAnnualRevenue    Decimal  @db.Decimal(15, 2) @default(0)
  
  // Assets
  ownedAssetCount           Int      @default(0)
  revenueGeneratingAssets   Int      @default(0)
  totalOwnedAssetValue      Decimal  @db.Decimal(15, 2) @default(0)
  
  // Metadata
  lastComputedAt            DateTime @default(now())
  updatedAt                 DateTime @updatedAt
  
  Talent                    Talent   @relation(fields: [talentId], references: [id], onDelete: Cascade)
  
  @@index([talentId])
}

// Individual revenue streams tied to business
model RevenueStream {
  id                    String   @id @default(cuid())
  talentId              String
  dealId                String?
  campaignId            String?
  
  // Basic info
  name                  String
  description           String?
  type                  String   // "PRODUCT", "SERVICE", "LICENSING", "SPONSORSHIP", "AFFILIATE", "RETAINER", "COURSE"
  
  // Financial metrics
  monthlyRevenue        Decimal  @db.Decimal(15, 2) @default(0)
  annualRevenue         Decimal  @db.Decimal(15, 2) @default(0)
  churnRate             Decimal  @db.Decimal(5, 2) @default(0) // 0-100 %
  growthRateMonthly     Decimal  @db.Decimal(5, 2) @default(0)
  
  // Classification
  isRecurring           Boolean  @default(false)
  ownershipStatus       String   @default("OWNED") // "OWNED", "LICENSED", "PLATFORM"
  scalabilityScore      Int      @default(50) // 0-100
  founderDependency     Decimal  @db.Decimal(5, 2) @default(0) // % requiring founder
  
  // Status
  isActive              Boolean  @default(true)
  
  // Timestamps
  startDate             DateTime?
  endDate               DateTime?
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  
  // Relations
  Talent                Talent   @relation(fields: [talentId], references: [id], onDelete: Cascade)
  Deal                  Deal?    @relation("DealRevenueStreams", fields: [dealId], references: [id], onDelete: SetNull)
  Campaign              BrandCampaign? @relation(fields: [campaignId], references: [id], onDelete: SetNull)
  
  @@index([talentId])
  @@index([dealId])
  @@index([type])
  @@index([isRecurring])
}

// Revenue classification for deals - enforces tagging
model RevenueClassification {
  id                    String   @id @default(cuid())
  dealId                String   @unique
  
  // Tags (multi-select)
  tags                  String[] // ["FOUNDER_DEPENDENT", "RECURRING_REVENUE", "CREATOR_OWNED", "SCALABLE_INVENTORY", "PLATFORM_OWNED"]
  dealValueType         String   @default("FIXED") // "FIXED", "VARIABLE", "HYBRID"
  revenueType           String   @default("OTHER") // "CONSULTING", "PRODUCT", "LICENSING", "SPONSORSHIP", "OTHER"
  
  // Likelihood assessment
  renewalLikelihood     String   @default("MEDIUM") // "HIGH", "MEDIUM", "LOW"
  estimatedMRR          Decimal  @db.Decimal(15, 2) @default(0)
  estimatedChurnRisk    Decimal  @db.Decimal(5, 2) @default(0) // 0-1 scale
  
  // Risk flagging
  isHighRisk            Boolean  @default(false)
  risksIdentified       String[] @default([])
  
  // Metadata
  classifiedAt          DateTime @default(now())
  classifiedBy          String?  // User ID
  updatedAt             DateTime @updatedAt
  
  Deal                  Deal     @relation(fields: [dealId], references: [id], onDelete: Cascade)
  
  @@index([dealId])
  @@index([isHighRisk])
}

// Founder Dependency Index - measures business independence
model FounderDependencyIndex {
  id                        String   @id @default(cuid())
  talentId                  String   @unique
  
  // Components
  founderDependencyPercent  Decimal  @db.Decimal(5, 2) @default(0) // % of revenue
  soplessProcessCount       Int      @default(0)  // Critical processes without SOP
  manualOpsHoursPerWeek     Decimal  @db.Decimal(5, 2) @default(0)
  delegationCoveragePercent Decimal  @db.Decimal(5, 2) @default(0)
  teamDepthScore            Int      @default(0)  // 0-100
  
  // Score
  riskRating                String   @default("MEDIUM") // "LOW", "MEDIUM", "HIGH"
  overallScore              Int      @default(50) // 0-100 (higher = more independent)
  
  // Valuation impact
  projectedValuationPenalty Decimal  @db.Decimal(5, 2) @default(0) // % markdown
  
  // Recommendations
  recommendations           String[] @default([]) // JSON strings of recommendations
  
  // Metadata
  lastComputedAt            DateTime @default(now())
  updatedAt                 DateTime @updatedAt
  
  Talent                    Talent   @relation(fields: [talentId], references: [id], onDelete: Cascade)
  
  @@index([talentId])
  @@index([riskRating])
}

// Owned Assets & IP Registry
model OwnedAsset {
  id                        String   @id @default(cuid())
  talentId                  String
  
  // Basic info
  name                      String
  type                      String   // "EMAIL_LIST", "COMMUNITY", "COURSE", "SAAS", "DOMAIN", "TRADEMARK", "DATA", "OTHER"
  description               String?
  
  // Ownership & legal
  ownershipStatus           String   @default("OWNED") // "OWNED", "LICENSED", "LICENSED_OUT"
  legalStatus               String   @default("UNPROTECTED") // "PROTECTED", "UNPROTECTED", "PENDING"
  transferableIndependently Boolean  @default(true)
  
  // Financial & scalability
  revenueGeneratedAnnual    Decimal  @db.Decimal(15, 2) @default(0)
  growthRatePercent         Decimal  @db.Decimal(5, 2) @default(0)
  scalabilityScore          Int      @default(50) // 0-100
  estimatedValue            Decimal? @db.Decimal(15, 2)
  
  // Metadata
  notes                     String?
  createdAt                 DateTime @default(now())
  lastValuationDate         DateTime?
  updatedAt                 DateTime @updatedAt
  
  Talent                    Talent   @relation(fields: [talentId], references: [id], onDelete: Cascade)
  
  @@index([talentId])
  @@index([type])
  @@index([ownershipStatus])
}

// Revenue Architecture - maps content to recurring revenue
model RevenueArchitecture {
  id                    String   @id @default(cuid())
  talentId              String   @unique
  
  // Track revenue flow components
  contentChannels       String[] @default([]) // ["YOUTUBE", "TIKTOK", "INSTAGRAM", "BLOG", etc.]
  leadCaptureMethods    String[] @default([]) // ["EMAIL", "COMMUNITY", "APP", etc.]
  conversionPoints      String[] @default([]) // ["COURSE", "SPONSORSHIP", "PRODUCT", etc.]
  recurringRevenueStreams String[] @default([]) // ["SUBSCRIPTION", "RETAINER", "LICENSE", etc.]
  
  // Completeness
  isFullyMapped         Boolean  @default(false)
  completionPercent     Int      @default(0) // 0-100
  gapsList              String[] @default([]) // What's missing
  
  // Metadata
  lastReviewedAt        DateTime?
  updatedAt             DateTime @updatedAt
  
  Talent                Talent   @relation(fields: [talentId], references: [id], onDelete: Cascade)
  
  @@index([talentId])
}

// Exit Readiness Scorecard - FLAGSHIP METRIC
model ExitReadinessScore {
  id                    String   @id @default(cuid())
  talentId              String   @unique
  
  // Overall score & category
  overallScore          Int      @default(0) // 0-100
  category              String   @default("UNDERDEVELOPED") // "UNDERDEVELOPED", "DEVELOPING", "INVESTMENT_GRADE", "ENTERPRISE_CLASS"
  
  // Component scores (0-100 each)
  revenuePredicability  Int      @default(0)
  founderIndependence   Int      @default(0)
  teamDepth             Int      @default(0)
  ipOwnership           Int      @default(0)
  grossMargin           Int      @default(0)
  platformRisk          Int      @default(0)
  recurringRevenuePercent Int    @default(0)
  
  // Recommendations (JSON array)
  recommendations       Json[]   @default([]) // [{priority, area, action, estimatedImpact, effort, valueMultiplier}]
  
  // Metadata
  lastComputedAt        DateTime @default(now())
  updatedAt             DateTime @updatedAt
  
  Talent                Talent   @relation(fields: [talentId], references: [id], onDelete: Cascade)
  
  @@index([talentId])
  @@index([overallScore])
  @@index([category])
}

// SOP Templates - reusable process documentation
model SOPTemplate {
  id                    String   @id @default(cuid())
  organizationId        String?
  
  // Basic info
  title                 String
  description           String?
  category              String   // "DEAL", "CAMPAIGN", "REVENUE", "RENEWAL", "DELEGATION", "OTHER"
  
  // Linked to what
  linkedDealTypes       String[] @default([])
  linkedCampaignTypes   String[] @default([])
  linkedRevenueTypes    String[] @default([])
  
  // Process definition (JSON)
  steps                 Json[]   @default([]) // [{order, title, owner, durationHours}]
  checklistItems        Json[]   @default([]) // [{title, owner, required}]
  
  // Instructions
  delegationInstructions String?
  failureRecovery       String?
  
  // Metadata
  ownerUserId           String
  lastReviewDate        DateTime?
  isActive              Boolean  @default(true)
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  
  instances             SOPInstance[]
  
  @@index([category])
  @@index([ownerUserId])
}

// SOP Instances - active execution tracking
model SOPInstance {
  id                    String   @id @default(cuid())
  templateId            String
  
  // Linked to what
  linkedDealId          String?
  linkedCampaignId      String?
  linkedRevenueStreamId String?
  
  // Execution status
  status                String   @default("DRAFT") // "DRAFT", "ACTIVE", "BROKEN", "FOLLOWED"
  currentStep           Int      @default(0)
  completedAt           DateTime?
  
  // Tracking
  deviationFlags        String[] @default([])
  notes                 String?
  
  // Metadata
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  
  SOPTemplate           SOPTemplate @relation(fields: [templateId], references: [id], onDelete: Cascade)
  Deal                  Deal?    @relation(fields: [linkedDealId], references: [id], onDelete: SetNull)
  
  @@index([templateId])
  @@index([status])
  @@index([linkedDealId])
}

// ============================================================================
// CONTACT ENRICHMENT & OUTREACH MODELS
// ============================================================================

model EnrichedContact {
  id                     String   @id @default(cuid())
  
  // Core contact info
  firstName              String
  lastName               String
  jobTitle               String?
  company                String?
  linkedInUrl            String?
  linkedInId             String?
  
  // Enrichment metadata
  confidenceScore        Int      @default(50) // 0-100
  source                 String   // "linkedin" | "website" | "public_index" | "manual"
  discoveryMethod        String?  // How we found them (e.g., "linkedin_search", "google_dorks", "cached_profile")
  
  // Association
  linkedBrandId          String?  // Link to CrmBrand if already matched
  linkedContactId        String?  // Link to CrmBrandContact if created
  
  // Email enrichment
  emails                 ContactEmail[]
  
  // Tracking
  discoveredAt           DateTime @default(now())
  verifiedAt             DateTime?
  addedToCrmAt           DateTime?
  complianceCheckPassed  Boolean  @default(false)
  lawfulBasis            String?  // GDPR: "b2b_legitimate_interest" | "contact_request" | "manual"
  
  // Activity
  notes                  String?
  activity               Json[]   @default([])
  
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
  
  // Relations
  EnrichmentJob          EnrichmentJob[]
  
  @@index([linkedBrandId])
  @@index([linkedInId])
  @@index([company])
  @@index([confidenceScore])
  @@index([discoveredAt])
  @@index([complianceCheckPassed])
}

model ContactEmail {
  id                     String   @id @default(cuid())
  
  // Email address & verification
  email                  String
  verificationStatus     String   @default("unknown") // "verified" | "risky" | "unknown" | "invalid"
  verificationMethod     String?  // "pattern" | "mx_check" | "smtp_ping" | "api" | "manual"
  verificationScore      Int      @default(50) // 0-100
  
  // How we generated it
  generationMethod       String   // "pattern_detection" | "api_enrichment" | "manual"
  namePermutations       String[] @default([]) // Attempts like john.doe, j.doe, etc.
  
  // Verification details
  mxCheckPassed          Boolean?
  smtpCheckPassed        Boolean? // Safe SMTP check without sending
  apiSource              String?  // "hunter" | "clearbit" | "snov" | "custom_pattern"
  
  // Associated contact
  enrichedContactId      String
  EnrichedContact        EnrichedContact @relation(fields: [enrichedContactId], references: [id], onDelete: Cascade)
  
  // Activity
  notes                  String?
  lastCheckedAt          DateTime?
  
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
  
  @@unique([enrichedContactId, email])
  @@index([enrichedContactId])
  @@index([verificationStatus])
  @@index([email])
}

model EnrichmentJob {
  id                     String   @id @default(cuid())
  
  // Job context
  jobType                String   // "brand_contact_discovery" | "email_enrichment" | "verification"
  status                 String   @default("pending") // "pending" | "processing" | "completed" | "failed" | "queued"
  
  // Input
  brandId                String?
  brandName              String?
  brandWebsite           String?
  linkedInCompanyUrl     String?
  
  // Result
  contactsDiscovered     Int      @default(0)
  contactsEnriched       Int      @default(0)
  
  // Enriched contacts associated
  contacts               EnrichedContact[]
  
  // Error handling
  errorMessage           String?
  errorCode              String?
  retryCount             Int      @default(0)
  maxRetries             Int      @default(3)
  
  // Compliance & limits
  regionCode             String?  // For geo-based restrictions
  complianceMode         Boolean  @default(true)
  volumeLimited          Boolean  @default(false)
  
  // Rate limiting
  rateLimitBucket        String?
  
  // Timing
  startedAt              DateTime?
  completedAt            DateTime?
  
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
  
  @@index([brandId])
  @@index([status])
  @@index([createdAt])
}

// ============================================================================
// ADVANCED INTELLIGENCE FEATURES (Smart Reminders, Agendas, Briefs, etc.)
// ============================================================================

// SmartReminderSuggestion
// AI-generated follow-up suggestions based on meetings, tasks, deals, outreach
// User approval required before creating task (never auto-created)
model SmartReminderSuggestion {
  id                String    @id @default(cuid())
  
  // What triggered this suggestion
  talentId          String
  contextType       String    // "meeting" | "task" | "deal" | "outreach"
  contextId         String    // ID of meeting/task/deal/outreach
  
  // AI Suggestion details
  suggestedAction   String    // "follow-up email" | "schedule call" | "check status"
  suggestedTiming   DateTime  // When AI thinks this should happen
  reasoning         String?   // Why AI thinks this is needed
  aiConfidence      Float     @default(0.0) // 0.0 to 1.0
  
  // User workflow
  status            String    @default("suggested") // "suggested" | "accepted" | "dismissed"
  dismissedAt       DateTime?
  dismissReason     String?
  acceptedAt        DateTime?
  linkedTaskId      String?   // Task created if accepted
  
  // Metadata
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  // Relations
  Talent            Talent    @relation(fields: [talentId], references: [id], onDelete: Cascade)
  
  @@index([talentId])
  @@index([status])
  @@index([contextType, contextId])
  @@index([suggestedTiming])
  @@index([createdAt])
}

// MeetingAgenda
// AI-generated agenda draft for meetings
// User-editable, version tracking
model MeetingAgenda {
  id                String    @id @default(cuid())
  
  // Meeting reference
  meetingId         String    @unique
  
  // Agenda content
  objectives        String?   // JSON array of objectives
  talkingPoints     String?   // JSON array of talking points
  decisionsNeeded   String?   // JSON array of decisions to make
  prepItems        String?   // JSON array of prep items
  summaryText       String?   // Plain text summary
  
  // Version tracking
  isEdited          Boolean   @default(false)
  editedAt          DateTime?
  originalVersion   String?   // Timestamp of original generation
  
  // Metadata
  generatedBy       String?   // "ai" | "user"
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  @@index([meetingId])
  @@index([createdAt])
}

// TalentWeeklyBrief
// Weekly operational snapshot per talent
// Contains meetings, tasks, deals, alerts, AI-flagged concerns
model TalentWeeklyBrief {
  id                String    @id @default(cuid())
  
  // Week reference
  talentId          String
  weekStartDate     DateTime
  weekEndDate       DateTime
  
  // Content (stored as JSON for flexibility)
  meetings          Json?     // Array: {title, date, participants}
  upcomingTasks     Json?     // Array: {title, dueDate, priority}
  outstandingFollowUps Json?  // Array: {action, daysOverdue, linkedEntity}
  dealsAtRisk       Json?     // Array: {dealName, stage, riskScore, riskFactors}
  paymentAlerts     Json?     // Array: {invoiceId, status, daysOverdue}
  aiConcerns        Json?     // Array: {concern, severity, recommendation}
  
  // Summary metadata
  urgencyLevel      String    @default("normal") // "low" | "normal" | "high" | "critical"
  summaryText       String?   // AI-generated one-liner
  hasHighRisk       Boolean   @default(false)
  
  // Delivery tracking
  deliveredAt       DateTime?
  deliveryChannels  String[]  @default([]) // ["in-app", "email", "slack"]
  readAt            DateTime?
  
  // Metadata
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  // Relations
  Talent            Talent    @relation(fields: [talentId], references: [id], onDelete: Cascade)
  
  @@index([talentId])
  @@index([weekStartDate])
  @@index([urgencyLevel])
  @@index([createdAt])
  @@unique([talentId, weekStartDate])
}

// CalendarWarning
// Warnings about overload, no buffer time, deadline clusters, availability conflicts
model CalendarWarning {
  id                String    @id @default(cuid())
  
  // Warning target
  talentId          String
  eventId           String?   // If linked to specific calendar event
  
  // Warning details
  warningType       String    // "overload" | "no_buffer" | "deadline_cluster" | "availability_conflict"
  severity          String    @default("amber") // "amber" | "red"
  message           String    // User-facing message
  aiAnalysis        String?   // Why this warning was generated
  
  // Suggested actions
  suggestedActions  Json?     // Array: {action, impact}
  
  // User interaction
  dismissed         Boolean   @default(false)
  dismissedAt       DateTime?
  acknowledgedAt    DateTime?
  
  // Metadata
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  // Relations
  Talent            Talent    @relation(fields: [talentId], references: [id], onDelete: Cascade)
  CalendarEvent     CalendarEvent? @relation(fields: [eventId], references: [id], onDelete: SetNull)
  
  @@index([talentId])
  @@index([warningType])
  @@index([severity])
  @@index([dismissed])
  @@index([createdAt])
}

// TalentAvailability
// Working days, preferred hours, timezone
// Used by calendar intelligence and AI suggestions
model TalentAvailability {
  id                String    @id @default(cuid())
  
  // Talent reference
  talentId          String    @unique
  
  // Working schedule
  workingDays       String[]  @default(["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"]) // Day names
  startHour         Int       @default(9)   // 24-hour format
  endHour           Int       @default(17)  // 24-hour format
  timezone          String    @default("America/Los_Angeles")
  
  // Preferences
  bufferBetweenMeetings Int  @default(15) // Minutes
  maxMeetingsPerDay Int      @default(5)
  minPrepTimeMinutes Int     @default(15)
  
  // Metadata
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  // Relations
  Talent            Talent    @relation(fields: [talentId], references: [id], onDelete: Cascade)
  
  @@index([talentId])
}

// TalentBlackoutDate
// Vacation, illness, travel, or other unavailable periods
model TalentBlackoutDate {
  id                String    @id @default(cuid())
  
  // Talent reference
  talentId          String
  
  // Date range
  startDate         DateTime
  endDate           DateTime
  
  // Details
  reason            String    // "vacation" | "illness" | "travel" | "unavailable" | "other"
  notes             String?
  
  // Visibility
  visibleOnCalendar Boolean   @default(true)
  
  // Metadata
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  // Relations
  Talent            Talent    @relation(fields: [talentId], references: [id], onDelete: Cascade)
  
  @@index([talentId])
  @@index([startDate, endDate])
  @@index([createdAt])
}

// ============================================================================
// BRAND CAMPAIGN WORKFLOW MODELS
// ============================================================================

// Track curated creator list with approval state
model CreatorShortlist {
  id                      String   @id @default(cuid())
  campaignId              String
  talentId                String
  
  // Admin curation
  adminNotes              String?           // Internal notes (hidden from brand)
  aiExplanation           String?           // "Why this creator fits" (shown to brand)
  addedByAdminId          String
  
  // Brand approval state
  brandApprovalStatus     String @default("PENDING_BRAND_APPROVAL")  // PENDING_BRAND_APPROVAL | APPROVED | REJECTED | REVISION_REQUESTED
  brandApprovedAt         DateTime?
  brandApprovedByUserId   String?
  
  // Admin override
  adminOverrideReason     String?           // If admin overrides brand rejection
  adminOverrideAt         DateTime?
  adminOverrideByUserId   String?
  
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt
  
  Campaign                CrmCampaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  Talent                  Talent @relation("ShortlistTalent", fields: [talentId], references: [id], onDelete: Cascade)
  AddedByAdmin            User @relation("ShortlistAddedBy", fields: [addedByAdminId], references: [id])
  BrandApprovedBy         User? @relation("ShortlistBrandApprovedBy", fields: [brandApprovedByUserId], references: [id])
  AdminOverrideBy         User? @relation("ShortlistAdminOverrideBy", fields: [adminOverrideByUserId], references: [id])
  
  @@unique([campaignId, talentId])
  @@index([campaignId])
  @@index([talentId])
  @@index([brandApprovalStatus])
}

// Track all approval/override/feedback events
model CampaignApproval {
  id              String   @id @default(cuid())
  campaignId      String
  action          String   // "BRAND_APPROVED" | "BRAND_REJECTED" | "ADMIN_OVERRIDE" | "FEEDBACK_SUBMITTED"
  actorId         String   // User who took action
  actorRole       String   // "BRAND" | "ADMIN"
  reason          String?  // Provided reason (especially for overrides)
  metadata        Json?    // Additional context (e.g., shortlist IDs affected)
  createdAt       DateTime @default(now())
  
  Campaign        CrmCampaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  Actor           User @relation("CampaignApprovalActor", fields: [actorId], references: [id])
  
  @@index([campaignId])
  @@index([createdAt])
  @@index([actorRole, action])
}

// Store brand feedback for AI learning
model CampaignFeedback {
  id              String   @id @default(cuid())
  campaignId      String
  shortlistId     String?  // Specific shortlist item if feedback on creator
  feedbackType    String   // "APPROVAL" | "REJECTION" | "PREFERENCE" | "CONCERN"
  content         String
  signals         String[] @default([])  // AI learning signals: ["good_fit", "audience_mismatch", etc]
  submittedByUserId String
  submittedAt     DateTime @default(now())
  
  Campaign        CrmCampaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  SubmittedBy     User @relation("CampaignFeedbackSubmittedBy", fields: [submittedByUserId], references: [id])
  
  @@index([campaignId])
  @@index([feedbackType])
  @@index([submittedByUserId])
}

// Store AI-generated post-campaign reports
model CampaignReport {
  id              String   @id @default(cuid())
  campaignId      String   @unique
  
  reportContent   Json     // Generated report (JSON to support rich formatting)
  tone            String @default("confident")  // Brand-safe tone
  
  generatedAt     DateTime @default(now())
  approvedByAdminId String?
  approvedAt      DateTime?
  
  releasedAt      DateTime?
  viewedByBrandAt DateTime?
  
  updatedAt       DateTime @updatedAt
  
  Campaign        CrmCampaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  ApprovedByAdmin User? @relation("ReportApprovedBy", fields: [approvedByAdminId], references: [id])
  
  @@index([campaignId])
  @@index([approvedAt])
  @@index([releasedAt])
}

// ============================================================================
// ASSISTED OUTREACH SYSTEM (Premium Semi-Automated)
// ============================================================================

model OutreachCampaign {
  id                String   @id @default(cuid())
  brandId           String
  brand             Brand    @relation(fields: [brandId], references: [id], onDelete: Cascade)
  
  // Contact being reached out to
  contactId         String
  contact           CrmBrandContact @relation("ContactOutreach", fields: [contactId], references: [id], onDelete: Cascade)
  
  // Campaign metadata
  goal              String   // STRATEGY_AUDIT, CREATIVE_CONCEPTS, CREATOR_MATCHING
  status            String   @default("DRAFT_REQUIRES_APPROVAL")  // DRAFT_REQUIRES_APPROVAL, APPROVED, SENT, REPLIED, BOOKED, CLOSED
  
  // Who created this campaign
  createdByUserId   String
  createdByUser     User     @relation("OutreachCampaignCreatedBy", fields: [createdByUserId], references: [id], onDelete: Cascade)
  
  // Who is sending (e.g., Lila or Maureen)
  senderUserId      String
  senderUser        User     @relation("OutreachCampaignSender", fields: [senderUserId], references: [id], onDelete: Cascade)
  
  // Approved draft info
  approvedDraftId   String?
  approvedDraft     OutreachDraft? @relation("ApprovedDraft", fields: [approvedDraftId], references: [id])
  
  // Drafts for this campaign
  drafts            OutreachDraft[] @relation("CampaignDrafts")
  
  // Replies
  replies           OutreachReply[] @relation("CampaignReplies")
  
  // Timestamps
  sentAt            DateTime?
  repliedAt         DateTime?
  bookedAt          DateTime?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  @@index([brandId])
  @@index([contactId])
  @@index([createdByUserId])
  @@index([senderUserId])
  @@index([status])
  @@index([createdAt])
}

model OutreachDraft {
  id                String   @id @default(cuid())
  campaignId        String
  campaign          OutreachCampaign @relation("CampaignDrafts", fields: [campaignId], references: [id], onDelete: Cascade)
  
  // Draft metadata
  version           String   // A (Strategic), B (Creative), C (Founder)
  subject           String
  body              String   @db.Text
  
  // Approval status
  isApproved        Boolean  @default(false)
  approvedByUserId  String?
  approvedByUser    User?    @relation(fields: [approvedByUserId], references: [id], onDelete: SetNull)
  approvedAt        DateTime?
  
  // Edit tracking
  wasEdited         Boolean  @default(false)
  editedBy          String?  // User ID if edited
  editedAt          DateTime?
  
  // Sending info
  sentAt            DateTime?
  emailMessageId    String?  // External email service ID
  
  // Is this the approved draft for the campaign?
  isApprovedVersion Boolean  @default(false)
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  // Relation for approved draft
  approvedCampaigns OutreachCampaign[] @relation("ApprovedDraft")
  
  @@index([campaignId])
  @@index([version])
  @@index([isApproved])
  @@index([isApprovedVersion])
  @@index([sentAt])
}

model OutreachReply {
  id                String   @id @default(cuid())
  campaignId        String
  campaign          OutreachCampaign @relation("CampaignReplies", fields: [campaignId], references: [id], onDelete: Cascade)
  
  // Email tracking
  emailMessageId    String   // Links to the original outreach email
  
  // Reply content
  replyText         String   @db.Text
  senderEmail       String
  senderName        String?
  
  // Sentiment analysis (lightweight)
  sentiment         String   // POSITIVE, NEUTRAL, NEGATIVE
  confidenceScore   Float?   // 0-1
  
  // Detected vs recorded
  detectedAt        DateTime
  recordedAt        DateTime @default(now())
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  @@index([campaignId])
  @@index([sentiment])
  @@index([emailMessageId])
  @@index([detectedAt])
}

// ============================================================================
// END ASSISTED OUTREACH SYSTEM MODELS
// ============================================================================

// ============================================================================// HEALTH SCORE TRACKING
// ============================================================================

model HealthScoreSnapshot {
  id              String   @id @default(cuid())
  talentId        String
  talent          Talent   @relation(fields: [talentId], references: [id], onDelete: Cascade)
  
  score           Int      @default(100)
  previousScore   Int?
  
  factors         Json?
  triggers        String[]
  
  metadata        Json?
  
  autoTaskCreated Boolean  @default(false)
  autoTaskId      String?
  
  calculatedAt    DateTime @default(now())
  createdAt       DateTime @default(now())
  
  @@index([talentId])
  @@index([calculatedAt])
  @@index([score])
  @@unique([talentId, calculatedAt])
}

// ============================================================================
// END HEALTH SCORE TRACKING
// ============================================================================

// ============================================================================
// GROWTH INITIATIVES SYSTEM
// ============================================================================
// Strategic initiatives for talent growth tracking
// Reframes activity as strategic investment with clear inputs → outputs → impact

model GrowthInitiative {
  id                String    @id @default(cuid())
  talentId          String
  talent            Talent    @relation(fields: [talentId], references: [id], onDelete: Cascade)
  
  // Strategic definition
  name              String
  description       String?
  platforms         String[]  // ["LinkedIn", "Instagram", "Press", "Mixed"]
  objective         String    // "authority_building", "inbound_brand_leads", "higher_deal_value", "long_term_positioning"
  
  // Timeline
  startDate         DateTime
  endDate           DateTime?
  
  // Budget
  monthlyBudget     Float?
  totalBudget       Float?
  
  // Status & ownership
  status            String    @default("active") // "active", "testing", "completed", "killed"
  owner             String    @default("both") // "agent", "talent", "both"
  
  // Tracking
  createdByUserId   String
  createdByUser     User      @relation("GrowthInitiativeCreator", fields: [createdByUserId], references: [id], onDelete: SetNull)
  
  // Relations
  inputs            GrowthInput[]
  outputs           GrowthOutput[]
  performance       GrowthPerformance[]
  businessImpacts   BusinessImpact[]
  
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  @@index([talentId])
  @@index([status])
  @@index([objective])
  @@index([createdAt])
}

// Inputs: cost drivers for each initiative
model GrowthInput {
  id                String    @id @default(cuid())
  initiativeId      String
  initiative        GrowthInitiative @relation(fields: [initiativeId], references: [id], onDelete: Cascade)
  
  // Type of input
  type              String    // "contributor", "paid_tool", "time_investment", "one_off_cost"
  name              String    // "LinkedIn Manager", "Editor", "Strategy Session", etc.
  
  // Optional contributor link
  contributorUserId String?
  contributor       User?     @relation("GrowthInputContributor", fields: [contributorUserId], references: [id], onDelete: SetNull)
  
  // Costs
  costMonthly       Float?
  costOneOff        Float?
  
  // Duration
  startDate         DateTime?
  endDate           DateTime?
  
  notes             String?
  
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  @@index([initiativeId])
  @@index([type])
}

// Outputs: what was produced by the initiative
model GrowthOutput {
  id                String    @id @default(cuid())
  initiativeId      String
  initiative        GrowthInitiative @relation(fields: [initiativeId], references: [id], onDelete: Cascade)
  
  // What was created
  platform          String    // "LinkedIn", "Instagram", "Press", "Other"
  format            String    // "post", "video", "article", "profile_change", "outreach"
  
  // Who created it (optional)
  contributorUserId String?
  contributor       User?     @relation("GrowthOutputContributor", fields: [contributorUserId], references: [id], onDelete: SetNull)
  
  // Content details
  title             String?
  url               String?
  publishedAt       DateTime?
  notes             String?
  
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  @@index([initiativeId])
  @@index([platform])
  @@index([format])
}

// Performance: metrics for each initiative
model GrowthPerformance {
  id                String    @id @default(cuid())
  initiativeId      String
  initiative        GrowthInitiative @relation(fields: [initiativeId], references: [id], onDelete: Cascade)
  
  // Metrics
  totalViews        Int?
  avgEngagement     Float?
  followerGrowth    Int?
  profileVisits     Int?
  inboundMessages   Int?
  brandEnquiries    Int?
  speakingInvites   Int?
  
  // Period
  periodStart       DateTime
  periodEnd         DateTime
  
  notes             String?
  
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  @@index([initiativeId])
  @@index([periodStart])
}

// Business Impact: agent insights on deals, leads, and value
model BusinessImpact {
  id                String    @id @default(cuid())
  initiativeId      String
  initiative        GrowthInitiative @relation(fields: [initiativeId], references: [id], onDelete: Cascade)
  
  // Deal influence
  dealsInfluencedIds String[] @default([]) // JSON array of deal IDs
  inboundLeads      Int?
  
  // Market positioning
  brandCategoriesUnlocked String[]
  avgDealValueChangePct Float?
  
  // Agent insight
  agentNotes        String?
  
  recordedAt        DateTime  @default(now())
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  @@index([initiativeId])
}

// ============================================================================
// END GROWTH INITIATIVES SYSTEM
// ============================================================================

// ============================================================================
// BRAND ONBOARDING SYSTEM
// ============================================================================

model BrandProfile {
  id                      String    @id @default(cuid())
  userId                  String    @unique
  user                    User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Company Basics (Step 1)
  companyName             String
  websiteUrl              String?
  industry                String?
  markets                 String[]  @default([])  // Multi-select
  companySize             String?

  // Sign-Up Context (Step 2)
  signerRole              String?   // Founder, Head of Marketing, etc.
  decisionAuthority       String?   // "final" | "influencer" | "research"

  // Platform Goals (Step 3)
  platformGoals           String[]  @default([])  // Multi-select

  // Commercial Focus (Step 4)
  primaryObjective        String?   // "New product launch", "Scaling", etc.
  productFocus            String?   // Free text
  desiredOutcome          String?   // Free text

  // Founder-Led Check (Step 5)
  wantsFounderLed         Boolean   @default(false)
  isBrandFounder          Boolean   @default(false)
  founderLedRedirectedAt  DateTime?

  // Activations & Experiences (Step 6)
  interestedInActivations Boolean   @default(false)
  activationTypes         String[]  @default([])  // ["pop-ups", "events", etc.]

  // Status Tracking
  currentStep             Int       @default(1)
  onboardingCompletedAt   DateTime?
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt

  @@index([userId])
  @@index([onboardingCompletedAt])
}

// ============================================================================
// END BRAND ONBOARDING SYSTEM
// ============================================================================

// ============================================================================
// FOUNDER ONBOARDING SYSTEM (NEW)
// ============================================================================

model FounderProfile {
  id                      String    @id @default(cuid())
  userId                  String    @unique
  user                    User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Step 1: Founder Stage
  founderStage            String?   // "pre_launch" | "early" | "scaling" | "established"

  // Step 2: Social Presence Audit
  isActiveOnSocials       Boolean   @default(false)
  primaryPlatforms        String[]  @default([])  // ["instagram", "tiktok", "linkedin", "youtube"]
  currentReach            Json?     // { instagram: 10000, tiktok: 5000, ... }
  socialBlocker           String?   // If not active: what's stopping them?

  // Step 3: Content & Visibility Confidence
  contentConfidence       String?   // "low" | "medium" | "high"
  timeCommitment          String?   // "low" | "medium" | "high"

  // Step 4: Founder Goals
  primaryFounderGoals     String[]  @default([])

  // Step 5: Commercial Intent
  commercialIntent        String?   // What will founder-led strategy unlock?

  // Step 6: Biggest Blocker
  biggestBlocker          String?   // What's holding them back?

  // Service Mapping (Internal - Not shown to user)
  recommendedServices     String[]  @default([])

  // Status Tracking
  currentStep             Int       @default(1)
  onboardingCompletedAt   DateTime?
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt

  @@index([userId])
  @@index([onboardingCompletedAt])
}

// ============================================================================
// END FOUNDER ONBOARDING SYSTEM
// ============================================================================
