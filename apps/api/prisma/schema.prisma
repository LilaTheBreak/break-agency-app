generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id          String   @id @default(cuid())
  email       String   @unique
  password    String?
  name        String?
  avatarUrl   String?
  location    String?
  timezone    String?
  pronouns    String?
  accountType String?
  status      String?
  bio         String?
  socialLinks Json?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  roster_category     String?
  upgrade_suggested    Boolean   @default(false)
  include_in_roster    Boolean   @default(false)
  ugcPortfolioUrl      String?
  ugcRates             Json?
  ugcApproved          Boolean   @default(false)
  subscriptionStatus   String?   @default("free") // "free" | "premium" | "ugc_pro"
  ugc_portfolio_url   String?
  ugc_categories       String[]  @default([])
  managedTalentIds String[] @default([])
  creator_score        Int?
  creator_score_reason Json?
  role_recommended     String?
  admin_notes          String?
  friends_of_house_id  String?
  onboarding_status    String    @default("pending_review")

  socialAccounts  SocialAccount[]
  socialAnalytics SocialAnalytics[]
  socialPosts     SocialPost[]
  emailLogs       EmailLog[]
  socialTokens    SocialToken[]

  auditLogs                AuditLog[]
  adminActivities          AdminActivity[]           @relation("AdminActivityActor")
  payments                 Payment[]
  invoices                 Invoice[]
  payouts                  Payout[]
  creatorBalance           CreatorBalance?
  contracts                Contract[]
  roles                    UserRole[]
  onboarding               UserOnboarding?
  dealThreads              DealThread[]
  inboundEmails            InboundEmail[]
  dealDrafts               DealDraft[]
  inboundMessages          InboundMessage[]
  deliverables             Deliverable[]
  deliverableReviews       DeliverableReview[]
  contractReviews          ContractReview[]
  dealPackages             DealPackage[]
  creatorBundles           CreatorBundle[]
  briefMatches             BriefMatch[]
  brandRelationships       BrandRelationship[]
  brandSignals             BrandSignal[]
  brandCampaignPredictions BrandCampaignPrediction[]
  opportunityClusters      OpportunityCluster[]
  brandAffinitySnapshots   BrandAffinitySnapshot[]
  brandEvents              BrandEvent[]
  creatorInsights          CreatorInsights[]
  creatorReports           CreatorWeeklyReport[]     @relation("CreatorWeeklyReports")
  creatorPredictions       CreatorPrediction[]
  agentMemories            AIAgentMemory[]
  interactionHistory       InteractionHistory[]
  personaProfile           CreatorPersonaProfile?
  outreachPlans            OutreachPlan[]
  leads                    Lead[]
  outreachSequences        OutreachSequence[]
  negotiationSessions      NegotiationSession[]
  negotiationThreads       NegotiationThread[]
  agentPolicy              AgentPolicy?
  agentExecutions          AgentExecution[]
  creatorBrandFits         CreatorBrandFit[]
  talents                  Talent[]
  creatorPackages          DealPackage[]             @relation("CreatorPackages")
  aiAgentTasks             AIAgentTask[]
  aiAgentLogs              AIAgentExecutionLog[]
  competitors              CompetitorProfile[]       @relation(fields: [userId], references: [id])
  subscriptions            Subscription[]
  outreachMessageTemplates OutreachMessageTemplate[]
  outreachSuggestions      OutreachSuggestion[]
  inboxSummaries           InboxSummary[]
  contentAnalyses          ContentAnalysis[]
  algorithmAlerts          AlgorithmAlert[]
  createdCampaignTemplates CampaignTemplate[]
  brandCampaigns           BrandCampaign[]
  talentRequests           TalentRequest[]          @relation("BrandTalentRequests")
  createdApprovalRequests  ApprovalRequest[]        @relation("Requester")
  createdCreativeVersions  CreativeVersion[]
  reviewedApprovalRequests ApprovalRequest[]        @relation("Reviewer")
  createdCreativeReviews   CreativeReview[]         @relation("Requester")
  reviewedCreativeReviews  CreativeReview[]         @relation("Reviewer")
  campaignCreatorRequests  CampaignCreatorRequest[]
}

model FriendsOfHouse {
  id         String   @id @default(cuid())
  name       String
  bio        String?
  category   String?
  photoUrl   String?
  instagram  String?
  tiktok     String?
  youtube    String?
  website    String?
  customTags String[] @default([])
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

enum SocialPlatform {
  TIKTOK
  INSTAGRAM
  YOUTUBE
  X
  LINKEDIN
  FACEBOOK
  GMAIL
}

enum DealStage {
  NEW_LEAD
  BRIEF_RECEIVED
  NEGOTIATING
  PENDING_CONTRACT
  CONTRACT_SENT
  LIVE
  CONTENT_SUBMITTED
  APPROVED
  PAYMENT_SENT
  CLOSED_WON
  CLOSED_LOST
}

enum NegotiationStyle {
  AGGRESSIVE
  BALANCED
  COLLABORATIVE
  PREMIUM_ONLY
}

enum AIAgentTaskType {
  AUTO_REPLY
  NEGOTIATION
  OUTREACH
  FOLLOW_UP
  DEAL_REVIEW
  WEEKLY_REPORT
  ANALYSIS
  INBOX_REPLY
  ALGO_SCAN
}

enum AIAgentTaskStatus {
  PENDING
  RUNNING
  COMPLETED
  FAILED
}

model SocialAccount {
  id             String            @id @default(cuid())
  user           User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId         String
  platform       SocialPlatform
  platformUserId String
  username       String
  displayName    String?
  profileUrl     String?
  profileImage   String?
  bio            String?
  followers      Int               @default(0)
  following      Int               @default(0)
  accessToken    String?
  refreshToken   String?
  tokenExpiresAt DateTime?
  scopes         String?
  metadata       Json?
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  analytics      SocialAnalytics[]
  posts          SocialPost[]
  isTalentInbox  Boolean           @default(false)
  talentId       String?
  talent         Talent?           @relation(fields: [talentId], references: [id], onDelete: Cascade)

  @@unique([platform, platformUserId])
}

model SocialAnalytics {
  id             String        @id @default(cuid())
  user           User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId         String
  account        SocialAccount @relation(fields: [accountId], references: [id], onDelete: Cascade)
  accountId      String
  capturedAt     DateTime      @default(now())
  followerCount  Int
  engagementRate Float?
  velocityScore  Float?
  impressions    Int?
  reach          Int?
  profileViews   Int?
  demographics   Json?
  raw            Json?
  createdAt      DateTime      @default(now())

  @@index([userId, accountId, capturedAt])
}

model SocialPost {
  id             String         @id @default(cuid())
  user           User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId         String
  account        SocialAccount  @relation(fields: [accountId], references: [id], onDelete: Cascade)
  accountId      String
  platform       SocialPlatform
  platformPostId String
  caption        String?
  mediaUrl       String?
  thumbnailUrl   String?
  postedAt       DateTime?
  likes          Int?           @default(0)
  comments       Int?           @default(0)
  shares         Int?           @default(0)
  views          Int?           @default(0)
  engagementRate Float?
  metadata       Json?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt

  @@unique([platform, platformPostId])
  @@index([userId, accountId, postedAt])
}

model SocialToken {
  id           String         @id @default(cuid())
  user         User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId       String
  platform     SocialPlatform
  accessToken  String?
  refreshToken String?
  expiresAt    DateTime?
  metadata     Json?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt

  @@unique([userId, platform])
}

model EmailLog {
  id        String   @id @default(cuid())
  user      User?    @relation(fields: [userId], references: [id], onDelete: SetNull)
  userId    String?
  to        String
  subject   String
  template  String
  status    String   @default("queued")
  error     String?
  metadata  Json?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([template, status])
}

model CronLog {
  id          String    @id @default(cuid())
  name        String
  status      String    @default("running")
  message     String?
  metadata    Json?
  startedAt   DateTime  @default(now())
  completedAt DateTime?
  error       String?
  createdAt   DateTime  @default(now())

  @@index([name, startedAt])
  @@index([status])
}

model AuditLog {
  id         String   @id @default(cuid())
  userId     String?
  action     String
  entityType String?
  entityId   String?
  metadata   Json?
  createdAt  DateTime @default(now())

  user User? @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([userId])
  @@index([entityType])
  @@index([action])
}

model AdminActivity {
  id        String   @id @default(cuid())
  actorId   String?
  event     String
  metadata  Json?
  ip        String?
  createdAt DateTime @default(now())

  user User? @relation("AdminActivityActor", fields: [actorId], references: [id], onDelete: SetNull)

  @@index([actorId])
  @@index([event])
  @@index([createdAt])
}

model Payment {
  id                    String   @id @default(cuid())
  user                  User?    @relation(fields: [userId], references: [id], onDelete: SetNull)
  userId                String?
  stripePaymentIntentId String?  @unique
  xeroPaymentId         String?
  amount                Int
  currency              String
  status                String
  metadata              Json?
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  @@index([userId])
  @@index([status])
}

model Invoice {
  id              String           @id @default(cuid())
  externalId      String           @unique
  provider        String           @default("stripe")
  user            User?            @relation(fields: [userId], references: [id], onDelete: SetNull)
  userId          String?
  brandEmail      String?
  brandName       String?
  amount          Int              @default(0)
  currency        String           @default("usd")
  status          String           @default("pending")
  dueDate         DateTime?
  processedAt     DateTime?
  metadata        Json?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  xeroId          String?          @unique
  xeroUrl         String?
  reconciliations Reconciliation[]

  @@index([userId])
  @@index([status])
  @@index([provider])
}

model PaymentLog {
  id          String   @id @default(cuid())
  provider    String
  eventType   String
  referenceId String?
  metadata    Json?
  createdAt   DateTime @default(now())

  @@index([provider, eventType])
  @@index([referenceId])
}

model Payout {
  id              String           @id @default(cuid())
  user            User?            @relation(fields: [userId], references: [id], onDelete: SetNull)
  userId          String?
  referenceId     String           @unique
  provider        String           @default("stripe")
  amount          Int
  currency        String
  status          String
  destination     String?
  metadata        Json?
  creatorPortion  Int?
  agencyPortion   Int?
  managerPortion  Int?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  reconciliations Reconciliation[]

  @@index([userId])
  @@index([status])
  @@index([provider])
}

model CreatorBalance {
  id        String   @id @default(cuid())
  user      User?    @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String?  @unique
  available Int      @default(0)
  pending   Int      @default(0)
  currency  String   @default("usd")
  metadata  Json?
  updatedAt DateTime @updatedAt
}

model WebhookLog {
  id        String   @id @default(cuid())
  provider  String
  eventId   String   @unique
  eventType String
  status    String   @default("received")
  payload   Json?
  error     String?
  createdAt DateTime @default(now())

  @@index([provider])
  @@index([eventType])
}

model Reconciliation {
  id        String   @id @default(cuid())
  invoice   Invoice? @relation(fields: [invoiceId], references: [id], onDelete: SetNull)
  invoiceId String?  @unique
  payout    Payout?  @relation(fields: [payoutId], references: [id], onDelete: SetNull)
  payoutId  String?  @unique
  status    String   @default("pending")
  details   Json?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([status])
}

model Message {
  id          String   @id @default(cuid())
  senderId    String
  recipientId String
  content     String
  read        Boolean  @default(false)
  metadata    Json?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([senderId])
  @@index([recipientId])
  @@index([senderId, recipientId])
}

model File {
  id        String   @id @default(cuid())
  userId    String?
  key       String
  url       String?
  filename  String
  type      String?
  folder    String   @default("general")
  createdAt DateTime @default(now())

  deliverableProofs   Deliverable[]
  contractReviewFiles ContractReview[]

  @@index([userId])
  @@index([folder])
  @@index([createdAt])
}

model Task {
  id         String    @id @default(cuid())
  title      String
  role       String    @default("global")
  status     String    @default("open")
  priority   String?   @default("normal")
  assignee   String?
  dueDate    DateTime?
  metadata   Json?
  campaignId String?
  campaign   Campaign? @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt

  @@index([role])
  @@index([status, role])
  @@index([dueDate])
}

model Approval {
  id          String    @id @default(cuid())
  title       String
  role        String    @default("global")
  type        String?   @default("contract")
  status      String    @default("pending")
  requestedBy String?
  dueDate     DateTime?
  metadata    Json?
  campaignId  String?
  campaign    Campaign? @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([role])
  @@index([status, role])
}

model Deliverable {
  id     String  @id @default(cuid())
  userId String?
  user   User?   @relation(fields: [userId], references: [id], onDelete: SetNull)

  dealId     String?
  campaignId String?
  contractId String?

  title       String
  description String?
  status      String    @default("scheduled") // scheduled | in_progress | submitted | approved | delivered
  dueDate     DateTime?
  submittedAt DateTime?
  approvedAt  DateTime?
  deliveredAt DateTime?

  proofFileId String?
  proofFile   File?   @relation(fields: [proofFileId], references: [id], onDelete: SetNull)

  metadata  Json?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  campaign Campaign?       @relation(fields: [campaignId], references: [id])
  contract ContractReview? @relation(fields: [contractId], references: [id])
  aiQA        Json?
  qaScore     Int?
  riskLevel   String?
  nextAction  String?
  creatorStatus String?

  timelineSteps DeliverableTimeline[]
  complianceChecks ComplianceCheck[]
  performanceForecast ContentPerformanceForecast?
  viralitySimulation   ViralSimulation?
  qualityReport        DeliverableQualityReport?
  contentQuality       ContentQuality?

  @@index([userId])
  @@index([status])
  @@index([dueDate])
}

model Brief {
  id                   String         @id @default(cuid())
  title                String
  role                 String         @default("global")
  status               String         @default("draft")
  metadata             Json?
  currentVersionNumber Int            @default(0)
  createdAt            DateTime       @default(now())
  updatedAt            DateTime       @updatedAt
  versions             BriefVersion[]

  @@index([role])
  @@index([status, role])
}

model BriefVersion {
  id            String   @id @default(cuid())
  brief         Brief    @relation(fields: [briefId], references: [id], onDelete: Cascade)
  briefId       String
  versionNumber Int
  data          Json?
  createdBy     String?
  createdAt     DateTime @default(now())

  @@unique([briefId, versionNumber])
  @@index([briefId])
}

model Contract {
  id        String   @id @default(cuid())
  userId    String
  dealId    String?
  threadId  String?
  status    String   @default("draft")
  terms     Json
  pdfUrl    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user              User               @relation(fields: [userId], references: [id])
  signedContract    SignedContract?
  signatureRequests SignatureRequest[]
}

model SignatureRequest {
  id           String   @id @default(cuid())
  contractId   String
  provider     String
  status       String   @default("pending")
  signerEmail  String
  signerName   String
  envelopeId   String?
  signer1Type       String? // "creator", "brand", "agent"
  signer2Type       String?
  signer1Signed     Boolean  @default(false)
  signer2Signed     Boolean  @default(false)
  signer1SignedAt   DateTime?
  signer2SignedAt   DateTime?
  signedAt           DateTime?
  signaturePositions Json?
  auditLog           Json?
  metadata           Json?
  signedPdfUrl String?
  errorMessage String?
  ipAddress          String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  contract Contract @relation(fields: [contractId], references: [id])
}

model SignedContract {
  id                 String   @id @default(cuid())
  originalContractId String   @unique
  originalContract   Contract @relation(fields: [originalContractId], references: [id])
  signedPdfUrl       String
  signatureData      Json?
  createdAt          DateTime @default(now())

  @@index([originalContractId])
}

model Lead {
  id           String   @id @default(cuid())
  userId       String
  brandName    String
  brandWebsite String?
  brandEmail   String?
  industry     String?
  score        Int      @default(50)
  source       String   @default("ai-prospect")
  status       String   @default("new")
  notes        Json?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  user              User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  outreachSequences OutreachSequence[]
  suggestions       OutreachSuggestion[]
}

model OutreachSequence {
  id        String   @id @default(cuid())
  userId    String
  leadId    String
  status    String   @default("active")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user    User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  steps   OutreachStep[]
  actions OutreachAction[]
  lead    Lead             @relation(fields: [leadId], references: [id])
}

model OutreachStep {
  id         String   @id @default(cuid())
  sequenceId String
  stepNumber Int
  delayHours Int      @default(48)
  template   String
  channel    String   @default("email")
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  sequence OutreachSequence @relation(fields: [sequenceId], references: [id])
}

model OutreachAction {
  id           String   @id @default(cuid())
  sequenceId   String
  stepId       String?
  actionType   String
  status       String   @default("pending")
  runAt        DateTime
  errorMessage String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  sequence OutreachSequence @relation(fields: [sequenceId], references: [id])
}

model BrandRelationship {
  id                String    @id @default(cuid())
  userId            String
  brandName         String
  brandEmail        String?
  brandWebsite      String?
  category          String?
  region            String?
  engagements       Int       @default(0)
  messagesSent      Int       @default(0)
  lastContactAt     DateTime?
  lastReplyAt       DateTime?
  affinityScore     Int       @default(50)
  likelihoodToClose Int       @default(50)
  warm              Boolean   @default(false)
  metadata          Json?
  negotiationProfile Json?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  user      User                    @relation(fields: [userId], references: [id], onDelete: Cascade)
  snapshots BrandAffinitySnapshot[]
  events    BrandEvent[]

  @@index([userId])
  @@index([brandName])
}

model BrandAffinitySnapshot {
  id                String   @id @default(cuid())
  brandId           String
  userId            String
  affinityScore     Int
  likelihoodToClose Int
  createdAt         DateTime @default(now())

  user  User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  brand BrandRelationship @relation(fields: [brandId], references: [id])
}

model BrandEvent {
  id        String   @id @default(cuid())
  brandId   String
  userId    String
  type      String
  metadata  Json?
  createdAt DateTime @default(now())

  user  User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  brand BrandRelationship @relation(fields: [brandId], references: [id])
}

model BrandSignal {
  id        String   @id @default(cuid())
  brandName String
  brandId   String?
  userId    String?
  type      String
  value     String?
  weight    Int      @default(1)
  metadata  Json?
  createdAt DateTime @default(now())

  user User? @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([brandName])
}

model BrandCampaignPrediction {
  id              String    @id @default(cuid())
  brandId         String?
  brandName       String
  userId          String
  likelihood      Int       @default(50)
  predictedBudget Int?
  predictedStage  String?
  predictedStart  DateTime?
  confidence      Int       @default(50)
  reasons         Json?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  pitches PitchGeneration[]

  @@index([brandName])
  @@index([userId])
}

model OpportunityCluster {
  id        String   @id @default(cuid())
  userId    String
  category  String?
  region    String?
  score     Int      @default(50)
  brands    Json?
  insights  Json?
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model CreatorBrandFit {
  id             String   @id @default(cuid())
  creatorId      String
  brandId        String?
  brandName      String
  userId         String
  fitScore       Int
  predictedValue Int?
  likelihood     Int?
  confidence     Int?
  reasons        Json?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([creatorId, brandName])
}

model CreatorBundle {
  id         String   @id @default(cuid())
  userId     String
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  briefId    String?
  brief      BrandBrief? @relation(fields: [briefId], references: [id])
  type       String // "performance", "brand_fit", "premium", etc.
  creators   Json // list of creator objects with match data
  deliverables Json?
  timeline   Json?
  budget     Json?
  forecast   Json?
  risks      Json?
  aiSummary  String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([userId])
  @@index([briefId])
  @@index([type])
}

model BrandBrief {
  id           String   @id @default(cuid())
  brandName    String
  contactEmail String?
  submittedBy  String?
  content      String
  budgetMin    Int?
  budgetMax    Int?
  categories   String[]
  aiSummary    Json?
  aiKeywords   Json?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  matches         BriefMatch[]
  recommendations BriefRecommendation[]
  autoPlans       CampaignAutoPlan[]
  forecast        CampaignForecast?
}

model BriefMatch {
  id                   String @id @default(cuid())
  briefId              String
  creatorId            String
  score                Float
  reason               String
  predictedFee         Int?
  predictedPerformance Json?

  brief BrandBrief @relation(fields: [briefId], references: [id])
  user  User       @relation(fields: [creatorId], references: [id])
}

model BriefRecommendation {
  id        String   @id @default(cuid())
  briefId   String
  bundleId  String?
  emailCopy String?
  pdfUrl    String?
  createdAt DateTime @default(now())

  brief BrandBrief @relation(fields: [briefId], references: [id])
}

model CampaignAutoPlan {
  id             String   @id @default(cuid())
  briefId        String?
  bundleId       String?
  campaignId     String?
  createdBy      String?
  aiSummary      Json?
  aiTimeline     Json?
  aiBudget       Json?
  aiDeliverables Json?
  aiRisks        Json?
  aiContracts    Json?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  brief         BrandBrief?               @relation(fields: [briefId], references: [id])
  timelineItems CampaignTimelineItem[]
  deliverables  CampaignDeliverableAuto[]
}

model CampaignTimelineItem {
  id            String    @id @default(cuid())
  planId        String
  week          Int
  title         String
  description   String?
  dueDate       DateTime?
  creatorId     String?
  status        String    @default("pending") // pending, in_progress, done, overdue
  type          String    @default("task") // outreach, contract, briefing, draft1, draft2, posting, reporting
  sequence      Int?
  metadata      Json?

  plan CampaignAutoPlan @relation(fields: [planId], references: [id])
}

model CampaignDeliverableAuto {
  id        String    @id @default(cuid())
  planId    String
  creatorId String
  platform  String
  type      String
  rounds    Int?
  aiNotes   String?
  dueDate   DateTime?

  plan    CampaignAutoPlan    @relation(fields: [planId], references: [id])
  reviews DeliverableReview[]
}

model DeliverableReview {
  id            String   @id @default(cuid())
  deliverableId String
  userId        String?
  aiSummary     String?
  aiIssues      Json?
  aiSuggestions Json?
  aiScore       Int?
  riskFlags     Json?
  alignment     Json?
  status        String   @default("pending") // pending, approved, needs_changes
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  user        User?                   @relation(fields: [userId], references: [id], onDelete: SetNull)
  deliverable CampaignDeliverableAuto @relation(fields: [deliverableId], references: [id])
}

model AiHistory {
  id        String   @id @default(cuid())
  userId    String?
  role      String
  prompt    String
  response  Json?
  context   Json?
  createdAt DateTime @default(now())

  @@index([userId])
  @@index([role])
}

enum CampaignStage {
  PLANNING
  ACTIVE
  REVIEW
  COMPLETE
}

model Campaign {
  id              String               @id @default(cuid())
  title           String
  ownerId         String?
  stage           CampaignStage        @default(PLANNING)
  brands          Json?
  creatorTeams    Json?
  aiSummary       String?
  aiReport        Json?
  aiGenerated     Boolean              @default(false)
  timeline        Json?
  deliverablePlan Json?
  metadata        Json?
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt
  brandLinks      CampaignBrandPivot[]
  deliverables    Deliverable[]
  tasks           Task[]
  approvals       Approval[]
}

model CreatorInsights {
  id             String   @id @default(cuid())
  userId         String
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  followers      Int?
  engagementRate Float?
  reach          Int?
  impressions    Int?
  summary        String?
  opportunities  String?
  risks          String?
  opportunitySignals Json?
  riskSignals        Json?
  contentIdeas   Json?
  createdAt      DateTime @default(now())
}

model CreatorWeeklyReport {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation("CreatorWeeklyReports", fields: [userId], references: [id], onDelete: Cascade)
  weekStart DateTime
  weekEnd   DateTime
  insights  Json?
  aiSummary String?
  healthScore        Int?
  grade              String?
  riskLevel          String? // e.g., 'low', 'medium', 'high'
  changeFromLastWeek Int?
  actionPlan         Json?
  createdAt DateTime @default(now())

  @@index([userId])
  @@index([weekStart])
}

model CreatorPrediction {
  id             String   @id @default(cuid())
  userId         String
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  metric         String
  predictedValue Float
  confidence     Float?
  createdAt      DateTime @default(now())

  @@index([userId])
}

model AIAgentMemory {
  id         String   @id @default(cuid())
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId     String
  type       String
  topic      String?
  content    Json
  importance Int      @default(1)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([userId])
  @@index([type])
  @@index([topic])
}

model BrandIntel {
  id         String   @id @default(cuid())
  brandName  String
  brandEmail String?
  category   String?
  notes      Json?
  metadata   Json?
  history    Json?
  updatedAt  DateTime @updatedAt
  createdAt  DateTime @default(now())

  @@index([brandName])
}

model InteractionHistory {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  entity    String
  entityId  String?
  summary   String?
  metadata  Json?
  createdAt DateTime @default(now())

  @@index([userId])
  @@index([entity])
}

model CreatorPersonaProfile {
  id           String   @id @default(cuid())
  userId       String   @unique
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  toneKeywords String?
  writingStyle String?
  personaRules Json?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model OutreachPlan {
  id         String   @id @default(cuid())
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId     String
  brandName  String
  brandEmail String?
  status     String   @default("pending")
  score      Int      @default(0)
  metadata   Json?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([userId])
  @@index([brandName])
  @@index([status])
}

model OutreachLog {
  id         String   @id @default(cuid())
  userId     String
  brandName  String?
  brandEmail String?
  subject    String?
  message    String?
  status     String   @default("draft")
  metadata   Json?
  createdAt  DateTime @default(now())

  @@index([userId])
  @@index([brandName])
}

model ContractReview {
  id            String   @id @default(cuid())
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId        String
  fileId        String?
  file          File?    @relation(fields: [fileId], references: [id])
  brandName     String?
  status        String   @default("pending")
  extractText   String?
  cleanedText   String?
  aiSummary     Json?
  aiRisks       Json?
  risks         Json?
  dangerousClauses Json?
  missingClauses   Json?
  aiRedlines    Json?
  redlines      Json?
  aiPlainEnglish Json?
  aiMissingTerms Json?
  aiRedlineSuggestions Json?
  aiNegotiationCopy Json?
  aiRiskLevel   Int?
  aiUsageDetected Json?
  aiUsageValueEstimate Json?
  aiUsageRedlines Json?
  aiUsageNegotiationCopy Json?
  usageEndDate DateTime?
  negotiationDrafts Json?
  aiDealMapping Json?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  terms        ContractTerm[]
  versions     ContractReviewVersion[]
  history      RedlineHistory[]
  deliverables Deliverable[]
  clauses      ContractClause[]
}

model ContractTerm {
  id         String         @id @default(cuid())
  contract   ContractReview @relation(fields: [contractId], references: [id], onDelete: Cascade)
  contractId String
  label      String
  value      String
  category   String

  versions ContractTermVersion[]
}

model NegotiationSession {
  id            String   @id @default(cuid())
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId        String
  brandName     String
  brandEmail    String?
  status        String   @default("active")
  originalEmail Json?
  offerDetails  Json?
  aiGeneratedDeliverables Json?
  aiGeneratedTimeline     Json?
  aiGeneratedUsage        Json?
  aiStrategy         Json?
  aiCounterOffer     Json?
  aiTalkingPoints    Json?
  aiBudgetPrediction Int?
  aiRiskScore        Int?
  currentStep   Int?
  sequence      Json?
  isAuto        Boolean  @default(false)
  strategy      Json?
  simulation    Json?
  personality   Json?
  aiNotes       Json?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  steps NegotiationMessage[]
  decisions NegotiationDecision[]

  strategyPaths NegotiationStrategyPath[]
  toneProfiles  NegotiationToneProfile[]
}

model NegotiationMessage {
  id        String             @id @default(cuid())
  session   NegotiationSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  sessionId String
  threadId  String?
  thread    NegotiationThread? @relation("NegotiationThreadMessages", fields: [threadId], references: [id], onDelete: Cascade)
  sender    String
  subject   String?
  body      String?
  status    String             @default("draft")
  sequence  Int                @default(1)
  isAutoGenerated Boolean @default(false)
  analysis        Json?
  aiScoring   Json?
  responsePlan Json?
  metadata  Json?
  aiGenerated Boolean          @default(false)
  createdAt DateTime           @default(now())
}

model CampaignBrandPivot {
  id         String   @id @default(cuid())
  campaign   Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  campaignId String
  brandId    String
  metrics    Json?
  createdAt  DateTime @default(now())

  @@index([campaignId])
  @@index([brandId])
}

model DealThread {
  id                  String    @id @default(cuid())
  user                User?     @relation(fields: [userId], references: [id], onDelete: SetNull)
  userId              String?
  brandName           String?
  brandEmail          String?
  subjectRoot         String?
  stage               DealStage @default(NEW_LEAD)
  status              String    @default("open")
  talentIds           String[]  @default([])
  agentIds            String[]  @default([])
  brand               Brand?    @relation(fields: [brandId], references: [id])
  brandId             String?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  negotiationInsights Json?

  emails       DealThreadEmail[]
  events       DealEvent[]
  deliverables DeliverableItem[]
  prediction   DealPrediction?
  strategy     NegotiationStrategy?
  simulations  NegotiationSimulation[]
  lastAiAction Json?
  followUpSchedules FollowUpSchedule[]
  forecast     DealForecast?
  benchmarks   NegotiationRateBenchmark[]
  counterOffers NegotiationCounterOffer[]
  redFlags     NegotiationRedFlag[]
  finalRate    Int?
  finalOutcome String?
  state        Json?

  @@index([userId])
  @@index([status])
  @@index([createdAt])
  @@index([brandId])
  @@index([talentIds])
  @@index([stage])
  @@index([agentIds])
}

model DealThreadEmail {
  id         String     @id @default(cuid())
  thread     DealThread @relation(fields: [threadId], references: [id], onDelete: Cascade)
  threadId   String
  emailId    String
  subject    String?
  snippet    String?
  receivedAt DateTime
  createdAt  DateTime   @default(now())
  isBrand      Boolean  @default(false)
  opened       Boolean  @default(false)
  lastOpenedAt DateTime?
  awaitingReply Boolean @default(false)

  @@index([threadId])
  @@index([emailId])
  @@index([receivedAt])
}

model DealEvent {
  id        String   @id @default(cuid())
  dealId    String
  type      String
  actorId   String?
  message   String?
  metadata  Json?
  createdAt DateTime @default(now())

  deal DealThread @relation(fields: [dealId], references: [id], onDelete: Cascade)

  @@index([dealId])
  @@index([type])
  @@index([createdAt])
}

model DeliverableItem {
  id           String     @id @default(cuid())
  deal         DealThread @relation(fields: [dealId], references: [id], onDelete: Cascade)
  dealId       String
  type         String
  status       String     @default("draft")
  caption      String?
  notes        String?
  fileId       String?
  calendarEventId String?
  scheduledAt  DateTime?
  postedAt     DateTime?
  aiCaptionDrafts Json?
  aiHookDrafts    Json?
  aiQaReport      Json?
  aiQaStatus      String? @default("pending")
  aiQaScore       Int?
  aiQaPerformance Json?
  brandApprovalRequestedAt DateTime?
  lastBrandFollowUpAt     DateTime?
  followUpCount           Int @default(0)
  brandResponseAt         DateTime?
  brandResponseStatus     String?
  autoFollowUpEnabled     Boolean @default(true)
  aiDraftReview           Json?
  aiTimestampNotes        Json?
  aiSuggestions           Json?
  aiRewrite               Json?
  aiBrandSummary          Json?
  aiTalentSummary         Json?
  aiContentBrief          Json?
  aiScriptOutline         Json?
  aiShotList              Json?
  aiHooks                 Json?
  aiCompliance            Json?
  aiMissingInfo           Json?
  approvalHistory ApprovalLog[]
  locked          Boolean? @default(false)
  brandFeedback   Json?
  version         Int?     @default(1)
  aiQaRisks       Json?
  performanceSnapshots PostPerformance[]
  aiPerformanceSummary Json?
  storyboard          Storyboard?
  thumbnailGeneration ThumbnailGeneration?
  generatedCopy        GeneratedCopy[]
  aiHashtags      Json?
  postingStatus   String? // "queued", "posting", "posted", "failed"
  postedUrl       String? // DEPRECATED in favor of ScheduledPost.metadata
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  @@index([dealId])
  @@index([status])
  @@index([type])
  scheduledPost ScheduledPost?
  captionRewrites       CaptionRewrite[]
  creativeConcepts      CreativeConcept[]
  assetGenerations      AssetGeneration[]
  performancePrediction PerformancePrediction?
}

model DeliverableQAHistory {
  id            String   @id @default(cuid())
  deliverableId String
  deliverable   DeliverableItem @relation(fields: [deliverableId], references: [id], onDelete: Cascade)
  type          String // e.g., "INITIAL_QA", "RECHECK"
  summary       String?
  details       Json?
  score         Int?
  createdAt     DateTime @default(now())

  @@index([deliverableId])
}

model PostPerformance {
  id              String   @id @default(cuid())
  deliverableId   String
  deliverable     DeliverableItem @relation(fields: [deliverableId], references: [id], onDelete: Cascade)
  capturedAt      DateTime @default(now())
  views           Int?
  likes           Int?
  comments        Int?
  shares          Int?
  saves           Int?
  engagementRate  Float?
  velocityScore   Float?
  source          String   @default("polling")
  createdAt       DateTime @default(now())

  @@index([deliverableId, capturedAt])
}

model ScheduledPost {
  id            String   @id @default(cuid())
  deliverableId String   @unique
  deliverable   DeliverableItem @relation(fields: [deliverableId], references: [id], onDelete: Cascade)
  talentId      String
  talent        Talent   @relation(fields: [talentId], references: [id], onDelete: Cascade)
  platform      String   // "tiktok", "instagram", "youtube"
  status        String   @default("queued") // "queued", "processing", "completed", "failed"
  scheduledAt   DateTime
  postedAt      DateTime?
  mediaUrl      String?
  caption       String?
  metadata      Json?
  error         String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([deliverableId])
  @@index([talentId])
  @@index([status, scheduledAt])
}

model AutoPostLog {
  id              String   @id @default(cuid())
  scheduledPostId String
  scheduledPost   ScheduledPost @relation(fields: [scheduledPostId], references: [id], onDelete: Cascade)
  status          String // "success", "failure"
  message         String?
  metadata        Json?
  createdAt       DateTime @default(now())

  @@index([scheduledPostId])
}


model InboundEmail {
  id                  String      @id @default(cuid())
  user                User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId              String
  subject             String
  snippet             String?
  body                String?
  from                String?
  to                  String?
  receivedAt          DateTime
  classification      Json?
  extractedData       Json?
  dealDraftId         String?
  aiSummary           String?
  aiCategory          String?
  aiUrgency           String?
  aiRecommendedAction String?
  aiDeadline          String?
  aiBrand             String?
  aiConfidence        Float?
  aiJson              Json?
  priorityScore       Float?
  createdAt           DateTime    @default(now())
  dealDrafts          DealDraft[]
  followUpDueAt       DateTime?
  rawHtml             String?
  attachments         Json?
  followUpSentAt      DateTime?
  followUpStatus      String?
  opened              Boolean    @default(false)
  lastOpened          DateTime?
  lastSender          String?
  isAwaitingReply     Boolean    @default(false)
  aiPriority          Int?
  replySuggestion     NegotiationReplySuggestion?

  @@index([userId])
  @@index([receivedAt])
}

model InboundMessage {
  id                  String   @id @default(cuid())
  userId              String
  user                User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  platform            String
  externalId          String?
  senderHandle        String?
  senderName          String?
  senderImage         String?
  message             String
  rawData             Json?
  receivedAt          DateTime @default(now())
  aiCategory          String?
  aiBrand             String?
  aiUrgency           String?
  aiRecommendedAction String?
  aiConfidence        Float?
  aiJson              Json?
  linkedEmailId       String?
  linkedDealId        String?
  createdAt           DateTime @default(now())

  @@index([userId])
  @@index([platform])
  @@index([receivedAt])
  @@index([aiCategory])
}

model DealDraft {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId String

  email   InboundEmail? @relation(fields: [emailId], references: [id], onDelete: Cascade)
  emailId String?

  brand               String?
  offerType           String? // DEPRECATED in favor of more structured fields
  paymentAmount       Float? // DEPRECATED
  currency            String? // DEPRECATED
  deadline            DateTime?
  offerValue          Float?
  offerCurrency       String?              @default("GBP")
  usageRights         Json?
  exclusivityTerms    Json?
  deliverablesRaw     String?
  deliverables        Json?
  contractLength      String?
  revisionPolicy      String?
  keyDates            Json?
  risks               Json?
  exclusivity         String?
  usageRights         String?
  notes               String?
  confidence          Float?
  rawJson             Json?
  status              String               @default("pending")
  negotiationInsights NegotiationInsight[]
  aiDeliverablePlan   Json?
  aiTimeline          Json?
  aiRounds            Json?
  aiUsageRights       Json?
  aiFeeEstimate       Json?
  aiBriefs            Json?
  lastOutboundEmailAt DateTime?
  pipelineStage       String?
  brandLastReplyAt    DateTime?
  awaitingReply       Boolean              @default(false)
  recommendedFollowUp Json?
  campaignPlan        CampaignAIPlan?
  forecast            DealForecast?
  forecasts           CampaignForecast[]

  @@index([userId])
  @@index([status])
  @@index([emailId])
}

model NegotiationInsight {
  id                String    @id @default(cuid())
  createdAt         DateTime  @default(now())
  dealDraft         DealDraft @relation(fields: [dealDraftId], references: [id], onDelete: Cascade)
  dealDraftId       String
  confidence        Float?
  rawJson           Json?

  // V2 Fields
  recommendedRange Json? // { min, ideal, premium }
  counterOffers    Json? // [{ amount, justification, deliverables, script }]
  upsellOptions    Json? // [{ upsellType, suggestedPrice, justification }]
  redFlags         Json? // [{ issue, severity, explanation }]
  toneVariants     Json? // { friendly, professional, firm, premium }
  negotiationPath  Json? // { opening, fallback, walkAway, concessions }
  brandContext     Json?
  talentContext    Json?
  finalScript      String?

  @@index([dealDraftId])
  @@index([createdAt])
}

model Talent {
  id        String   @id @default(cuid())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  aiSettings        TalentAISettings?
  mobileSettings    Json?
  pricingModels     TalentPricingModel[]
  memories          AITalentMemory[]
  agentTasks        AIAgentTask[]
  assetPacks        TalentAssetPack[]
  deadlineMonitors  DeadlineMonitor[]
  inboxSummaries    InboxSummary[]
  creatorScore      CreatorScore?
  scheduledPosts    ScheduledPost[]
  health            CreatorHealth?
  brandCampaigns    BrandCampaign[]       @relation("BrandOwnedCampaigns")
  creatorInvites    CampaignInvite[]      @relation("InvitesForCreator")
  sentInvites       CampaignInvite[]      @relation("InvitesFromBrand")
  creatorDeliverables CampaignDeliverable[] @relation("DeliverablesForCreator")
  requests          TalentRequest[]       @relation("TalentRequests")
  ugcPortfolio      UGCPortfolio?
  ugcListings       UGCListing[]
  ugcRequests       UGCRequest[] @relation("RequestsForCreator")
  brandUGCRequests  UGCRequest[] @relation("RequestsFromBrand")
  emailTemplateRules EmailTemplateRule[]
  aiContractDrafts  AIContractDraft[]
  agentLogs         AIAgentExecutionLog[]
  autoReplyRules    AIAutoReplyRule[]
  outboundTemplates AIOutboundTemplate[]
  responses         AIResponseLog[]
}

model TalentAISettings {
  id               String           @id @default(cuid())
  talent           Talent           @relation(fields: [talentId], references: [id], onDelete: Cascade)
  talentId         String           @unique
  enabled          Boolean          @default(false)
  autoReply        Boolean          @default(false)
  outreachEnabled  Boolean          @default(false)
  negotiationStyle NegotiationStyle @default(BALANCED)
  defaultTone      String?
  brandVoice       String?
  minRate          Int?
  preferredRate    Int?
  premiumRate      Int?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
}

model TalentPricingModel {
  id          String   @id @default(cuid())
  talent      Talent   @relation(fields: [talentId], references: [id], onDelete: Cascade)
  talentId    String
  deliverable String
  baseRate    Int
  minRate     Int?
  maxRate     Int?
  notes       String?
  priceMultiplier Float?
  platform    String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([talentId])
}

model AITalentMemory {
  id        String   @id @default(cuid())
  talent    Talent   @relation(fields: [talentId], references: [id], onDelete: Cascade)
  talentId  String
  category  String
  content   String
  createdAt DateTime @default(now())

  @@index([talentId])
}

model AIAgentTask {
  id           String            @id @default(cuid())
  talent       Talent            @relation(fields: [talentId], references: [id], onDelete: Cascade)
  talentId     String
  userId       String?
  user         User?             @relation(fields: [userId], references: [id], onDelete: SetNull)
  type         AIAgentTaskType
  status       AIAgentTaskStatus @default(PENDING)
  emailId      String?
  dealId       String?
  payload      Json?
  result       Json?
  scheduledFor DateTime?
  executedAt   DateTime?
  createdAt    DateTime          @default(now())

  logs AIAgentExecutionLog[] @relation("AIAgentTaskLogs")

  @@index([talentId])
  @@index([status])
  @@index([type])
}

model AIAgentExecutionLog {
  id        String       @id @default(cuid())
  taskId    String?
  task      AIAgentTask? @relation("AIAgentTaskLogs", fields: [taskId], references: [id])
  userId    String?
  user      User?        @relation(fields: [userId], references: [id], onDelete: SetNull)
  talentId  String
  action    String
  input     Json?
  output    Json?
  createdAt DateTime     @default(now())

  talent Talent @relation(fields: [talentId], references: [id], onDelete: Cascade)

  @@index([taskId])
  @@index([talentId])
  @@index([action])
}

model AIAutoReplyRule {
  id        String   @id @default(cuid())
  talent    Talent   @relation(fields: [talentId], references: [id], onDelete: Cascade)
  talentId  String
  trigger   String
  response  String
  enabled   Boolean  @default(true)
  createdAt DateTime @default(now())

  @@index([talentId])
}

model AIOutboundTemplate {
  id        String   @id @default(cuid())
  talent    Talent   @relation(fields: [talentId], references: [id], onDelete: Cascade)
  talentId  String
  name      String
  subject   String
  body      String
  enabled   Boolean  @default(true)
  createdAt DateTime @default(now())

  @@index([talentId])
}

model AIResponseLog {
  id        String   @id @default(cuid())
  talent    Talent   @relation(fields: [talentId], references: [id], onDelete: Cascade)
  talentId  String
  emailId   String?
  action    String
  message   String
  metadata  Json?
  createdAt DateTime @default(now())

  @@index([talentId])
  @@index([action])
}

model AgentPolicy {
  id                    String   @id @default(cuid())
  userId                String?  @unique
  user                  User?    @relation(fields: [userId], references: [id])
  sandboxMode           Boolean  @default(true)
  maxOutreachPerDay     Int      @default(10)
  negotiationCeilingPct Int      @default(25)
  autoSendNegotiation   Boolean  @default(false)
  autoCloseDeals        Boolean  @default(false)
  autoSendContracts     Boolean  @default(false)
  requiredMarginPct     Int      @default(15)
  autoInvoice           Boolean  @default(true)
  autoReminder          Boolean  @default(true)
  autoPayout            Boolean  @default(false)
  tone                  String   @default("professional")
  enabled               Boolean  @default(false)
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
}

model AgentTask {
  id        String   @id @default(cuid())
  userId    String?
  type      String
  status    String   @default("pending")
  input     Json?
  output    Json?
  error     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  runAt     DateTime @default(now())
}

model NegotiationLog {
  id        String   @id @default(cuid())
  userId    String
  emailId   String?
  dealId    String?
  step      String
  input     Json?
  output    Json?
  createdAt DateTime @default(now())

  @@index([userId])
  @@index([dealId])
}

model UGCApplication {
  id           String   @id @default(cuid())
  userId       String
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  portfolioUrl String?
  categories   String[]
  bio          String?
  sampleLinks  Json?
  rates        Json?
  status       String   @default("pending") // pending, approved, rejected
  adminNotes   String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@unique([userId])
  @@index([status])
}

model NegotiationStrategyPath {
  id               String   @id @default(cuid())
  sessionId        String
  session          NegotiationSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  pathType         String // e.g., 'aggressive', 'balanced', 'premium'
  script           String?
  justification    Json?
  predictedOutcome Json?
  confidence       Float?
  createdAt        DateTime @default(now())

  @@index([sessionId])
}

model NegotiationToneProfile {
  id          String   @id @default(cuid())
  brandEmail  String
  sessionId   String?
  session     NegotiationSession? @relation(fields: [sessionId], references: [id], onDelete: SetNull)
  tone        String? // e.g., 'direct', 'friendly', 'formal'
  traits      Json? // { "price_sensitive": 0.8, "prefers_quick_deals": 0.6 }
  riskProfile Json?
  strategy    Json? // Suggested negotiation approach
  createdAt   DateTime @default(now())

  @@unique([brandEmail])
  @@index([sessionId])
}

model ContentAnalysis {
  id              String         @id @default(cuid())
  userId          String
  platform        SocialPlatform
  caption         String?
  hook            String?
  thumbnailUrl    String?
  aiSummary       Json?
  aiScores        Json?
  aiFixes         Json?
  postPredictions Json?
  createdAt       DateTime       @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([platform])
}

model AlgorithmAlert {
  id          String   @id @default(cuid())
  userId      String
  platform    SocialPlatform
  type        String // trend, risk, drop, shadowban, etc.
  title       String
  description String?
  impact      String? // low, medium, high
  actionPlan  Json?
  createdAt   DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([platform])
  @@index([type])
}

model CampaignTemplate {
  id           String   @id @default(cuid())
  title        String
  category     String?
  audience     String?
  structure    Json?
  deliverables Json?
  aiPrompts    Json?
  createdById  String?
  createdBy    User?    @relation(fields: [createdById], references: [id], onDelete: SetNull)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([createdById])
  @@index([category])
}

model CaptionRewrite {
  id                String   @id @default(cuid())
  deliverableId     String
  deliverable       DeliverableItem @relation(fields: [deliverableId], references: [id], onDelete: Cascade)
  platform          String
  originalCaption   String?
  rewrittenCaption  String
  tone              String?
  style             String?
  keywords          Json?
  score             Float?
  risks             Json?
  suggestions       Json?
  modelVersion      String?
  createdAt         DateTime @default(now())

  @@index([deliverableId])
  @@index([platform])
}

model CreativeConcept {
  id                 String   @id @default(cuid())
  deliverableId      String
  deliverable        DeliverableItem @relation(fields: [deliverableId], references: [id], onDelete: Cascade)
  platform           String
  conceptName        String?
  conceptDescription String?
  scriptOutline      Json?
  shotList           Json?
  hooks              Json?
  aesthetic          Json?
  brandSafety        Json?
  score              Float?
  modelVersion       String?
  createdAt          DateTime @default(now())

  contentItem        ContentItem?

  moodboard          CreativeMoodboard?

  captions           CreativeCaption[]

  shots              CreativeShotList[]

  @@index([deliverableId])
  @@index([platform])
}



model CreativeShotList {
  id           String   @id @default(cuid())
  conceptId    String
  concept      CreativeConcept @relation(fields: [conceptId], references: [id], onDelete: Cascade)
  shotNumber   Int
  shotType     String? // e.g., "Wide Shot", "Medium Close-Up"
  description  String
  cameraAngle  String?
  lighting     String?
  props        Json?
  wardrobe     String?
  notes        String?
  createdAt    DateTime @default(now())

  @@index([conceptId])
}

model ContentItem {
  id          String   @id @default(cuid())
  talentId    String
  talent      Talent   @relation(fields: [talentId], references: [id], onDelete: Cascade)
  conceptId   String?  @unique
  concept     CreativeConcept? @relation(fields: [conceptId], references: [id], onDelete: SetNull)
  platform    String
  title       String
  description String?
  status      String   @default("draft") // draft, in_progress, review, approved, scheduled, posted
  scheduledFor DateTime?
  postedAt    DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  versions    ContentVersion[]
  approvals   ContentApproval[]
  feedback    ContentFeedback[]

  @@index([talentId])
  @@index([status])
  @@index([scheduledFor])
}

model ApprovalRequest {
  id           String   @id @default(cuid())
  entityType   String // e.g., "DELIVERABLE", "CONTRACT"
  entityId     String
  version      Int      @default(1)
  status       String   @default("pending") // pending, approved, needs_edits
  requesterId  String
  requester    User     @relation("Requester", fields: [requesterId], references: [id], onDelete: Cascade)
  reviewerId   String?
  reviewer     User?    @relation("Reviewer", fields: [reviewerId], references: [id], onDelete: SetNull)
  aiAssessment Json? // { score, riskFlags, requiredFixes, suggestions }
  comments     ApprovalComment[]
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([entityType, entityId])
  @@index([requesterId])
  @@index([reviewerId])
  @@index([status])
}

model ApprovalComment {
  id                String          @id @default(cuid())
  approvalRequestId String
  approvalRequest   ApprovalRequest @relation(fields: [approvalRequestId], references: [id], onDelete: Cascade)
  userId            String
  user              User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  message           String
  createdAt         DateTime        @default(now())

  @@index([approvalRequestId])
  @@index([userId])
}

model CreativeVersion {
  id          String   @id @default(cuid())
  assetId     String
  assetType   String // e.g., "AssetGeneration"
  version     Int
  content     Json
  metadata    Json?
  changesAI   Json? // AI-generated summary of changes from previous version
  createdById String
  createdBy   User     @relation(fields: [createdById], references: [id], onDelete: Cascade)
  createdAt   DateTime @default(now())

  @@unique([assetId, version])
  @@index([assetId])
  @@index([assetType])
  @@index([createdById])
}

model CreativeReview {
  id          String   @id @default(cuid())
  assetId     String
  assetType   String // e.g., "AssetGeneration"
  version     Int
  status      String   @default("pending") // pending, in_review, approved, changes_requested
  requesterId String
  requester   User     @relation("Requester", fields: [requesterId], references: [id], onDelete: Cascade)
  reviewerId  String?
  reviewer    User?    @relation("Reviewer", fields: [reviewerId], references: [id], onDelete: SetNull)
  aiSummary   String?
  metadata    Json?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  comments CreativeComment[]

  @@index([assetId, assetType])
  @@index([requesterId])
  @@index([status])
}

model CreativeComment {
  id             String   @id @default(cuid())
  reviewId       String
  review         CreativeReview @relation(fields: [reviewId], references: [id], onDelete: Cascade)
  authorId       String
  author         User     @relation(fields: [authorId], references: [id], onDelete: Cascade)
  message        String
  resolved       Boolean  @default(false)
  resolvedById   String?
  resolvedBy     User?    @relation(fields: [resolvedById], references: [id], onDelete: SetNull)
  createdAt      DateTime @default(now())

  replies CreativeCommentReply[]

  @@index([reviewId])
}

model CreativeCommentReply {
  id        String          @id @default(cuid())
  commentId String
  comment   CreativeComment @relation(fields: [commentId], references: [id], onDelete: Cascade)
  authorId  String
  author    User            @relation(fields: [authorId], references: [id], onDelete: Cascade)
  message   String
  createdAt DateTime        @default(now())

  @@index([commentId])
}

model ThumbnailGeneration {
  id            String   @id @default(cuid())
  deliverableId String   @unique
  deliverable   DeliverableItem @relation(fields: [deliverableId], references: [id], onDelete: Cascade)
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  concepts      Json? // [{ title, description, style }]
  layouts       Json? // [{ conceptTitle, layoutDescription, elements: [] }]
  imagePrompts  Json? // string[]
  renderedUrls  Json? // string[]

  modelVersion  String?
  status        String   @default("completed")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([deliverableId])
  @@index([userId])
}
model AIPrediction {
  id                  String   @id @default(cuid())
  userId              String
  user                User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  assetId             String
  assetType           String // e.g., "DeliverableItem", "CreativeVersion"
  deliverableId       String?
  deliverable         DeliverableItem? @relation(fields: [deliverableId], references: [id], onDelete: SetNull)
  version             Int?
  predictedViews      Int?
  predictedLikes      Int?
  predictedComments   Int?
  predictedShares     Int?
  predictedSaves      Int?
  predictedEngagement Float?
  predictedCTR        Float?
  viralityScore       Float?
  riskScore           Float?
  suggestions         Json?
  benchmarks          Json?
  modelVersion        String?
  createdAt           DateTime @default(now())

  @@index([userId])
  @@index([assetId, assetType])
  @@index([deliverableId])
}

model CreativeAIOutput {
  id          String   @id @default(cuid())
  deliverableId String   @unique
  deliverable   DeliverableItem @relation(fields: [deliverableId], references: [id], onDelete: Cascade)
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  concepts    Json? // [{ title, description }]
  hooks       Json? // string[]
  script      Json? // { outline, fullScript }
  shotlist    Json? // [{ shotNumber, description, type }]
  captions    Json? // { short, long, variants[] }
  thumbnails  Json? // { ideas[], prompts[] }
  moodboard   Json? // { imageUrls[], palette: {} }
  strategy    Json? // { notes, brandAlignment, personaFit }
  prediction  Json? // { predictedViews, predictedEngagement }

  modelVersion String?
  status      String   @default("completed")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([deliverableId])
  @@index([userId])
}

model Storyboard {
  id            String   @id @default(cuid())
  deliverableId String   @unique
  deliverable   DeliverableItem @relation(fields: [deliverableId], references: [id], onDelete: Cascade)
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  sceneBreakdown Json? // [{ scene: 1, description: "..." }]
  shotMap       Json?
  modelVersion  String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  frames StoryboardFrame[]

  @@index([deliverableId])
}

model StoryboardFrame {
  id          String     @id @default(cuid())
  storyboardId String
  storyboard  Storyboard @relation(fields: [storyboardId], references: [id], onDelete: Cascade)
  frameNumber Int
  description String
  imagePrompt String?
  imageUrl    String?
  createdAt   DateTime   @default(now())

  @@index([storyboardId])
}

model GeneratedCopy {
  id            String      @id @default(cuid())
  deliverableId String
  deliverable   Deliverable @relation(fields: [deliverableId], references: [id], onDelete: Cascade)
  userId        String
  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  platform      SocialPlatform
  longCaption   String?
  shortCaption  String?
  scriptOutline Json?
  fullScript    String?
  hooks         Json?
  ctaOptions    Json?
  hashtags      Json?
  toneVersion   String?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  @@index([deliverableId])
  @@index([userId])
  @@index([platform])
}

model ContentVersion {
  id                 String      @id @default(cuid())
  contentItemId      String
  contentItem        ContentItem @relation(fields: [contentItemId], references: [id], onDelete: Cascade)
  versionNumber      Int
  script             String?
  caption            String?
  mediaUrl           String?
  thumbnailUrl       String?
  aiSuggestions      Json?
  aiEditInstructions Json?
  createdAt          DateTime    @default(now())

  @@unique([contentItemId, versionNumber])
  @@index([contentItemId])
}

model ContentFeedback {
  id            String   @id @default(cuid())
  contentItemId String
  contentItem   ContentItem @relation(fields: [contentItemId], references: [id], onDelete: Cascade)
  authorId      String?
  authorName    String // "Brand", "Manager", "AI Agent"
  comment       String
  attachments   Json?
  aiSummary     String?
  createdAt     DateTime @default(now())

  @@index([contentItemId])
}

model ContentApproval {
  id            String   @id @default(cuid())
  contentItemId String
  contentItem   ContentItem @relation(fields: [contentItemId], references: [id], onDelete: Cascade)
  actor         String // "manager", "brand"
  actorId       String?
  status        String // "approved", "changes_requested"
  version       Int
  comments      String?
  createdAt     DateTime @default(now())

  @@index([contentItemId])
  @@index([actor, status])
}

model CampaignCreatorRequest {
  id         String   @id @default(cuid())
  campaignId String
  brandId    String
  creatorId  String?
  creatorEmail String?
  message    String?
  status     String   @default("pending")
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  brand    User          @relation(fields: [brandId], references: [id])
  campaign Campaign @relation(fields: [campaignId], references: [id])
  creator  User?         @relation(fields: [creatorId], references: [id])
}

model CampaignInvite {
  id         String @id @default(cuid())
  campaignId String
  campaign   Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  creatorId  String
  creator    User          @relation("InvitesForCreator", fields: [creatorId], references: [id], onDelete: Cascade)
  brandId    String
  brand      User          @relation("InvitesFromBrand", fields: [brandId], references: [id], onDelete: Cascade)
  status     String        @default("pending") // pending, accepted, declined
  message    String?
  deliverables Json?
  paymentOffer Json?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt

  @@index([campaignId])
  @@index([creatorId])
}

model CampaignDeliverable {
  id         String   @id @default(cuid())
  campaignId String
  campaign   Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  creatorId  String
  creator    User     @relation("DeliverablesForCreator", fields: [creatorId], references: [id], onDelete: Cascade)
  type       String
  status     String   @default("pending") // pending, submitted, approved, rejected
  fileUrl    String?
  notes      String?
  aiQA       Json?
  submittedAt DateTime?
  approvedAt DateTime?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([campaignId])
  @@index([creatorId])
}
model UGCPortfolio {
  id          String   @id @default(cuid())
  userId      String   @unique
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  bio         String?
  categories  String[]
  sampleLinks String[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([userId])
}

model UGCListing {
  id        String   @id @default(cuid())
  creatorId String   @unique
  creator   User     @relation(fields: [creatorId], references: [id], onDelete: Cascade)
  rate      Int?
  visibility Boolean  @default(true)
  approved  Boolean  @default(false)
  tags      String[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([creatorId])
  @@index([approved, visibility])
}

model UGCRequest {
  id           String   @id @default(cuid())
  brandId      String
  brand        User     @relation("RequestsFromBrand", fields: [brandId], references: [id], onDelete: Cascade)
  creatorId    String
  creator      User     @relation("RequestsForCreator", fields: [creatorId], references: [id], onDelete: Cascade)
  type         String // 'gift', 'ugc_deliverable'
  message      String?
  status       String   @default("pending") // 'pending', 'accepted', 'declined'
  deliverables Json?
  giftDetails  Json?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([brandId])
  @@index([creatorId])
}

model FriendsOfHouse {
  id         String   @id @default(cuid())
  name       String
  photoUrl   String?
  bio        String?
  socials    Json?
  categories String[]
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([name])
}

model PitchGeneration {
  id              String    @id @default(cuid())
  userId          String
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  brandName    String?
  briefId         String?
  brief           BrandBrief? @relation(fields: [briefId], references: [id], onDelete: SetNull)
  predictionId    String?
  prediction      BrandCampaignPrediction? @relation(fields: [predictionId], references: [id], onDelete: SetNull)
  deliverableId   String?
  dealId          String?
  personaId       String?
  type            String // e.g., "cold_outreach", "campaign_expansion"
  inputContext    Json?
  aiOutput        Json?
  createdAt       DateTime  @default(now())

  @@index([userId])
  @@index([briefId])
  @@index([predictionId])
}

model AssetGeneration {
  id            String   @id @default(cuid())
  deliverableId String
  deliverable   DeliverableItem @relation(fields: [deliverableId], references: [id], onDelete: Cascade)
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  type          String // e.g., "script", "hooks", "thumbnail_ideas"
  inputContext  Json?
  aiOutput      Json?
  createdAt     DateTime @default(now())

  @@index([deliverableId])
  @@index([userId])
}


model CreativeMoodboard {
  id                 String   @id @default(cuid())
  conceptId          String   @unique
  concept            CreativeConcept @relation(fields: [conceptId], references: [id], onDelete: Cascade)
  brandAesthetic     Json?
  creatorAesthetic   Json?
  fusionAesthetic    Json?
  referenceImages    Json?
  colorPalette       Json?
  typography         Json?
  keywords           Json?
  pdfUrl             String?
  modelVersion       String?
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  @@index([conceptId])
}


model CreativeCaption {
  id               String   @id @default(cuid())
  conceptId        String
  concept          CreativeConcept @relation(fields: [conceptId], references: [id], onDelete: Cascade)
  platform         String
  primaryCaption   String
  variants         Json?
  ctas             Json?
  seoKeywords      Json?
  hashtags         Json?
  soundSuggestions Json?
  tone             String?
  score            Float?
  modelVersion     String?
  createdAt        DateTime @default(now())

  @@index([conceptId])
  @@index([platform])
}

model PerformancePrediction {
  id                  String   @id @default(cuid())
  deliverableId       String   @unique
  deliverable         DeliverableItem @relation(fields: [deliverableId], references: [id], onDelete: Cascade)
  talentId            String
  talent              Talent   @relation(fields: [talentId], references: [id], onDelete: Cascade)
  platform            String
  predictedViews      Int?
  predictedLikes      Int?
  predictedComments   Int?
  predictedShares     Int?
  predictedSaves      Int?
  predictedCTR        Float?
  predictedROI        Float?
  predictedCPM        Float?
  predictedWatchTime  Int? // in seconds
  performanceScore    Float? // 0-100
  riskReasons         Json?
  improvementTips     Json?
  modelVersion        String?
  createdAt           DateTime @default(now())

  @@index([deliverableId])
  @@index([talentId])
}

model DeliverableTimeline {
  id            String      @id @default(cuid())
  deliverableId String
  deliverable   Deliverable @relation(fields: [deliverableId], references: [id], onDelete: Cascade)
  step          String // e.g., "Pre-production", "Shooting", "Editing", "Client Review"
  startDate     DateTime
  endDate       DateTime
  aiNotes       String?
  status        String      @default("pending") // pending, in_progress, completed
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  @@index([deliverableId])
  @@index([status])
}

model CampaignAIPlan {
  id           String    @id @default(cuid())
  dealDraft    DealDraft @relation(fields: [dealDraftId], references: [id], onDelete: Cascade)
  dealDraftId  String    @unique
  brandName    String?
  aiSummary    String?
  deliverables Json?
  strategy     Json?
  audience     Json?
  budget       Json?
  risks        Json?
  talent       Json?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  deck CampaignDeck?
  matches CreatorMatchResult[]
  optimizedBudget AIOptimizedBudget?
  assetPacks   TalentAssetPack[]
  contractDrafts AIContractDraft[]

  @@index([dealDraftId])
}

model DealPrediction {
  id             String     @id @default(cuid())
  dealId         String     @unique
  deal           DealThread @relation(fields: [dealId], references: [id], onDelete: Cascade)
  userId         String
  user           User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  likelihood     Float // 0-1 probability
  expectedBudget Int?
  daysToClose    Int?
  confidence     Float // 0-1 AI confidence in its own prediction
  reasons        Json?
  metadata       Json?
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt

  @@index([dealId])
  @@index([userId])
}

model ContractRiskHistory {
  id         String   @id @default(cuid())
  contractId String
  userId     String
  riskType   String
  severity   Int
  notes      Json?
  createdAt  DateTime @default(now())

  @@index([contractId])
  @@index([userId])
  @@index([riskType])
}

model AgentExecution {
  id           String   @id @default(cuid())
  userId       String
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  eventType    String
  pipeline     String
  step         String
  status       String // "started", "completed", "failed"
  input        Json?
  output       Json?
  errorMessage String?
  createdAt    DateTime @default(now())
  completedAt  DateTime?

  @@index([userId])
  @@index([eventType])
  @@index([pipeline])
}

model NegotiationDecision {
  id                 String             @id @default(cuid())
  sessionId          String
  session            NegotiationSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  decisionType       String // 'COUNTER_OFFER', 'ACCEPT', 'CLARIFY'
  reasoning          String?
  confidence         Float?
  generatedMessageId String?
  chosenCounterOffer Json?
  createdAt          DateTime           @default(now())

  @@index([sessionId])
}

model CreatorScore {
  id                       String   @id @default(cuid())
  talentId                 String   @unique
  talent                   Talent   @relation(fields: [talentId], references: [id], onDelete: Cascade)
  userId                   String
  user                     User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  overallScore             Float
  marketFitScore           Float?
  predictedEarningsScore   Float?
  alignmentScore           Float?
  velocityScore            Float?
  portfolioScore           Float?
  rawScores                Json?
  summary                  String?
  recommendations          Json?
  lastCalculated           DateTime @updatedAt
  createdAt                DateTime @default(now())

  @@index([talentId])
  @@index([userId])
  @@index([overallScore])
}

model DeliverableQualityReport {
  id                  String    @id @default(cuid())
  deliverableId       String    @unique
  deliverable         Deliverable @relation(fields: [deliverableId], references: [id], onDelete: Cascade)
  status              String    @default("pending") // pending, running, completed, failed
  overallScore        Float?
  brandGuidelinesScore Float?
  briefRequirementsScore Float?
  complianceScore     Float?
  brandSafetyScore    Float?
  suggestedRewrites   Json?
  predictedPerformance Json?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt

  issues              DeliverableQualityIssue[]

  @@index([deliverableId])
}

model DeliverableQualityIssue {
  id          String                   @id @default(cuid())
  reportId    String
  report      DeliverableQualityReport @relation(fields: [reportId], references: [id], onDelete: Cascade)
  type        String // e.g., "BRAND_GUIDELINE", "BRIEF_MISMATCH", "COMPLIANCE_RISK"
  description String
  severity    String // "high", "medium", "low"
  suggestion  String?
}

model ContractClause {
  id          String        @id @default(cuid())
  reviewId    String
  review      ContractReview @relation(fields: [reviewId], references: [id], onDelete: Cascade)
  clauseIndex Int
  clauseText  String
  category    String? // e.g., "Payment", "Usage Rights", "Termination"
  riskScore   Float?
  aiSummary   String?
  createdAt   DateTime      @default(now())

  alignmentIssues    ContractAlignmentIssue[]
  redlineSuggestions ContractRedlineSuggestion[]

  @@index([reviewId])
}

model ContractAlignmentIssue {
  id        String         @id @default(cuid())
  clauseId  String
  clause    ContractClause @relation(fields: [clauseId], references: [id], onDelete: Cascade)
  issue     String // e.g., "Payment term mismatch"
  expected  String // "Net-30 as per deal draft"
  found     String // "Net-60 in contract"
  severity  String // "high", "medium", "low"
  createdAt DateTime       @default(now())

  @@index([clauseId])
}

model ContractRedlineSuggestion {
  id             String         @id @default(cuid())
  clauseId       String
  clause         ContractClause @relation(fields: [clauseId], references: [id], onDelete: Cascade)
  suggestedText  String
  reasoning      String?
  confidence     Float?
  createdAt      DateTime       @default(now())

  @@index([clauseId])
}

model NegotiationRateBenchmark {
  id          String            @id @default(cuid())
  threadId    String
  thread      NegotiationThread @relation(fields: [threadId], references: [id], onDelete: Cascade)
  marketLow   Int
  marketAvg   Int
  marketHigh  Int
  creatorTier String?
  rationale   String?
  createdAt   DateTime          @default(now())

  @@index([threadId])
}

model NegotiationCounterOffer {
  id            String            @id @default(cuid())
  threadId      String
  thread        NegotiationThread @relation(fields: [threadId], references: [id], onDelete: Cascade)
  suggestedValue Int
  justification String
  script        String?
  variant       String // e.g., "aggressive", "balanced"
  createdAt     DateTime          @default(now())

  @@index([threadId])
}

model NegotiationRedFlag {
  id         String            @id @default(cuid())
  threadId   String
  thread     NegotiationThread @relation(fields: [threadId], references: [id], onDelete: Cascade)
  flag       String
  severity   String // "high", "medium", "low"
  clause     String?
  suggestion String?
  createdAt  DateTime          @default(now())

  @@index([threadId])
}

model OutreachMessageTemplate {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  name      String
  subject   String
  body      String
  type      String // 'initial', 'follow_up_1', 'follow_up_2'
  variables Json?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
}

model OutreachSuggestion {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  leadId      String
  lead        Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)
  sequenceId  String?
  sequence    OutreachSequence? @relation(fields: [sequenceId], references: [id])
  subject     String
  body        String
  reasoning   String?
  confidence  Float?
  status      String   @default("pending") // pending, approved, rejected, sent
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([userId])
  @@index([leadId])
  @@index([sequenceId])
}

model ContentQuality {
  id                String   @id @default(cuid())
  deliverableId     String   @unique
  deliverable       Deliverable @relation(fields: [deliverableId], references: [id], onDelete: Cascade)
  overallScore      Float
  viralityScore     Float?
  brandFitScore     Float?
  optimisationScore Float?
  clarityScore      Float?
  suggestions       Json?
  aiSummary         String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  hookSuggestions ContentHookSuggestion[]

  @@index([deliverableId])
}

model ContentHookSuggestion {
  id             String   @id @default(cuid())
  qualityCheckId String
  qualityCheck   ContentQuality @relation(fields: [qualityCheckId], references: [id], onDelete: Cascade)
  hookText       String
  reasoning      String?
  score          Float?
  createdAt      DateTime @default(now())

  @@index([qualityCheckId])
}

model CreatorHealth {
  id               String    @id @default(cuid())
  talentId         String    @unique
  talent           Talent    @relation(fields: [talentId], references: [id], onDelete: Cascade)
  userId           String
  user             User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  workloadScore    Float
  burnoutRisk      Float
  capacityForecast Json?
  recommendations  Json?
  aiSummary        String?
  lastChecked      DateTime  @updatedAt

  history CreatorHealthHistory[]

  @@index([talentId])
  @@index([userId])
}

model CreatorHealthHistory {
  id        String        @id @default(cuid())
  health    CreatorHealth @relation(fields: [healthId], references: [id], onDelete: Cascade)
  healthId  String
  snapshot  Json
  createdAt DateTime      @default(now())

  @@index([healthId])
}

model ContractReviewVersion {
  id               String                @id @default(cuid())
  contractReview   ContractReview        @relation(fields: [contractReviewId], references: [id], onDelete: Cascade)
  contractReviewId String
  version          Int
  rawText          String?
  aiSummary        Json?
  aiRisks          Json?
  aiRedlines       Json?
  createdAt        DateTime              @default(now())
  terms            ContractTermVersion[]

  @@unique([contractReviewId, version])
  @@index([contractReviewId])
}

model ContractTermVersion {
  id             String                @id @default(cuid())
  version          ContractReviewVersion @relation(fields: [versionId], references: [id], onDelete: Cascade)
  versionId        String
  originalTerm     ContractTerm?         @relation(fields: [originalTermId], references: [id], onDelete: SetNull)
  originalTermId   String?
  label            String
  value            String
  category         String
  createdAt        DateTime              @default(now())

  @@index([versionId])
}

model RedlineHistory {
  id               String         @id @default(cuid())
  contractReview   ContractReview @relation(fields: [contractReviewId], references: [id], onDelete: Cascade)
  contractReviewId String
  actor            String // "ai" or "user"
  changes          Json? // { from: "...", to: "...", reason: "..." }
  versionBefore    Int
  versionAfter     Int
  createdAt        DateTime       @default(now())

  @@index([contractReviewId])
}

model NegotiationSimulation {
  id                String   @id @default(cuid())
  dealId            String
  deal              DealThread @relation(fields: [dealId], references: [id], onDelete: Cascade)
  userId            String
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  pathName          String // e.g., "premium", "balanced", "fast_close"
  aiSteps           Json? // [{ actor: 'ai' | 'brand', message: string }]
  predictedOutcome  Json? // { finalBudget: number, daysToClose: number, sentiment: string }
  recommendedAction Json? // { script: string, nextMove: string }
  score             Float? // Overall score for this path
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([dealId])
  @@index([userId])
  @@index([pathName])
}

model NegotiationThread {
  id         String   @id @default(cuid())
  userId     String
  brandEmail String
  brandName  String?
  dealId     String?
  status     String   @default("active")
  lastBrandMessageAt DateTime?
  lastAIAgentMessageAt DateTime?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  user     User                 @relation(fields: [userId], references: [id], onDelete: Cascade)
  messages NegotiationMessage[] @relation("NegotiationThreadMessages")
  turns    NegotiationTurn[]
}

model Brand {
  id        String   @id @default(cuid())
  name      String
  domains   String[]
  emails    String[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  threads DealThread[]
  policies  BrandPolicy[]
}

model Role {
  id          String     @id @default(cuid())
  name        String     @unique
  description String?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  users       UserRole[]
}

model UserRole {
  id        String   @id @default(cuid())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  role      Role     @relation(fields: [roleId], references: [id], onDelete: Cascade)
  roleId    String
  createdAt DateTime @default(now())

  @@unique([userId, roleId])
  @@index([roleId])
}

model UserOnboarding {
  id        String   @id @default(cuid())
  userId    String   @unique
  user      User     @relation(fields: [userId], references: [id])
  step      Int      @default(0)
  completed Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model TrackingPixelEvent {
  id        String   @id @default(cuid())
  emailId   String
  threadId  String?
  openedAt  DateTime @default(now())
  ip        String?
  userAgent String?
  metadata  Json?
}

model FollowUpQueue {
  id        String   @id @default(cuid())
  inboxId   String
  userId    String?
  talentId  String?
  emailId   String?
  threadId  String?
  dueAt     DateTime
  status    String   @default("pending") // pending, running, sent, error
  payload   Json?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([status, dueAt])
}

model DealExtractionLog {
  id           String       @id @default(cuid())
  emailId      String
  threadId     String?
  extracted    Json?
  confidence   Float?
  issues       Json?
  createdAt    DateTime     @default(now())
  inboundEmail InboundEmail @relation(fields: [emailId], references: [id], onDelete: Cascade)

  @@index([emailId])
  @@index([threadId])
}

model NegotiationTurn {
  id          String   @id @default(cuid())
  threadId    String
  messageId   String?   // ref to NegotiationMessage or Gmail ID
  actor       String    // "brand" or "ai"
  body        String
  aiSummary   String?
  aiIntent    String?
  aiStrategy  Json?
  aiResponse  String?
  createdAt   DateTime @default(now())

  thread NegotiationThread @relation(fields: [threadId], references: [id], onDelete: Cascade)

  @@index([threadId])
  @@index([createdAt])
}

model NegotiationAgentRun {
  id          String    @id @default(cuid())
  status      String    @default("pending") // pending, running, completed, failed
  summary     Json?
  context     Json?
  createdAt   DateTime  @default(now())
  completedAt DateTime?

  @@index([status, createdAt])
}

model TalentEvent {
  id                String    @id @default(cuid())
  userId            String
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  title             String
  description       String?
  startTime         DateTime
  endTime           DateTime
  location          String?
  isAllDay          Boolean   @default(false)
  source            String // "inbox", "deal", "manual"
  sourceId          String? // e.g., emailId or dealId
  gcalEventId       String?
  status            String    @default("confirmed") // confirmed, tentative, cancelled
  clashDetected     Boolean   @default(false)
  travelTimeMinutes Int?
  metadata          Json?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  @@index([userId, startTime, endTime])
  @@index([source])
  @@index([gcalEventId])
}

model TalentHealthSnapshot {
  id                  String   @id @default(cuid())
  userId              String
  user                User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  workloadScore       Float // 0-100, higher is more workload
  energyScore         Float // 0-100, higher is more energy
  burnoutRisk         Float // 0-1, probability
  capacityForecast    Json? // { next7days: float, next30days: float }
  travelLoad          Float // 0-100, based on travel time
  contextualSummary   String?
  recommendations     Json? // ["Reschedule X", "Decline Y"]
  rawMetrics          Json?
  createdAt           DateTime @default(now())

  @@index([userId])
  @@index([createdAt])
}

model BrandMatchScore {
  id                  String    @id @default(cuid())
  userId              String
  user                User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  brandName           String
  brandWebsite        String?
  fitScore            Float // 0-100
  closeProbability    Float // 0-1
  predictedFee        Int?
  reasons             Json?
  risks               Json?
  rawScores           Json?
  createdAt           DateTime  @default(now())

  @@index([userId])
  @@index([brandName])
  @@index([fitScore])
}

model CreatorOpportunityRecommendation {
  id                  String    @id @default(cuid())
  userId              String
  user                User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  brandName           String
  brandWebsite        String?
  opportunityType     String // "sponsorship", "affiliate", "gifting"
  justification       String?
  predictedValue      Int?
  fitScore            Float?
  status              String    @default("new") // new, viewed, accepted, declined
  createdAt           DateTime  @default(now())

  @@index([userId])
  @@index([status])
}

model TalentRequest {
  id         String   @id @default(cuid())
  brandId    String
  brand      User     @relation("BrandTalentRequests", fields: [brandId], references: [id], onDelete: Cascade)
  talentId   String
  talent     Talent   @relation("TalentRequests", fields: [talentId], references: [id], onDelete: Cascade)
  campaignId String?
  campaign   BrandCampaign? @relation(fields: [campaignId], references: [id], onDelete: SetNull)

  deliverables Json?
  budgetMin    Int?
  budgetMax    Int?
  timeline     String?
  notes        String?

  status String @default("pending") // pending, manager_approved, creator_approved, declined

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([brandId])
  @@index([talentId])
  @@index([campaignId])
}

model NegotiationStrategy {
  id          String   @id @default(cuid())
  dealId      String   @unique
  deal        DealThread @relation(fields: [dealId], references: [id], onDelete: Cascade)
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  style       NegotiationStyle @default(BALANCED)
  targetRate  Int?
  floorRate   Int?
  anchorRate  Int?
  upsellIdeas Json?
  tone        String?
  reasoning   Json?
  lastUpdated DateTime @updatedAt
  createdAt   DateTime @default(now())

  @@index([dealId])
  @@index([userId])
}

model BrandPolicy {
  id          String               @id @default(cuid())
  brand       Brand                @relation(fields: [brandId], references: [id], onDelete: Cascade)
  brandId     String               @unique
  name        String
  description String?
  createdAt   DateTime             @default(now())
  updatedAt   DateTime             @updatedAt
  versions    BrandPolicyVersion[]
}

model BrandPolicyVersion {
  id        String      @id @default(cuid())
  policy    BrandPolicy @relation(fields: [policyId], references: [id], onDelete: Cascade)
  policyId  String
  version   Int
  rules     Json? // { do: ["..."], dont: ["..."], keywords: ["..."], tone: "..." }
  source    String? // "manual", "brief_ingest", "contract_redline"
  createdAt DateTime    @default(now())

  @@unique([policyId, version])
  @@index([policyId])
}

model ComplianceCheck {
  id            String      @id @default(cuid())
  deliverable   Deliverable @relation(fields: [deliverableId], references: [id], onDelete: Cascade)
  deliverableId String
  status        String // "pending", "running", "passed", "failed", "fixed"
  score         Int? // 0-100
  issues        Json? // [{ type: "TONE_MISMATCH", message: "...", severity: "high" }]
  aiFixes       Json? // { suggestedCaption: "..." }
  result        Json?
  createdAt     DateTime    @default(now())

  @@index([deliverableId])
  @@index([status])
}

model AIOptimizedBudget {
  id              String   @id @default(cuid())
  aiPlanId        String   @unique
  totalBudget     Int
  allocatedBudget Int
  breakdown       Json?
  forecast        Json?
  rationale       Json?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  plan CampaignAIPlan @relation(fields: [aiPlanId], references: [id], onDelete: Cascade)

  @@index([aiPlanId])
}

model CreatorMatchResult {
  id            String   @id @default(cuid())
  aiPlanId      String
  talentId      String
  fitScore      Int
  predictedKPIs Json?
  predictedFee  Int?
  reasoning     Json?
  rank          Int?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  plan   CampaignAIPlan @relation(fields: [aiPlanId], references: [id], onDelete: Cascade)
  talent Talent         @relation(fields: [talentId], references: [id], onDelete: Cascade)

  @@index([aiPlanId])
  @@index([talentId])
}

model ViralSimulation {
  id            String   @id @default(cuid())
  deliverableId String   @unique
  deliverable   Deliverable @relation(fields: [deliverableId], references: [id], onDelete: Cascade)
  status        String   @default("pending") // pending, generating_variants, simulating, ranking, completed
  topPick       Json? // The best variant's data
  aiSummary     String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  variants      ViralVariantScore[]

  @@index([deliverableId])
}

model InboxAutoReply {
  id         String    @id @default(cuid())
  userId     String
  user       User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  talentId   String?
  talent     Talent?   @relation(fields: [talentId], references: [id], onDelete: Cascade)
  emailId    String?   @unique
  email      InboundEmail? @relation(fields: [emailId], references: [id], onDelete: Cascade)
  threadId   String?
  brandEmail String?
  brandName  String?
  category   String
  status     String    @default("draft") // "draft", "sent", "failed"
  replyText  String?
  metadata   Json?
  createdAt  DateTime  @default(now())

  @@index([userId, emailId])
}

model ViralVariantScore {
  id            String   @id @default(cuid())
  simulationId  String
  simulation    ViralSimulation @relation(fields: [simulationId], references: [id], onDelete: Cascade)
  variant       Json // { caption: "...", hook: "...", hashtags: ["..."] }
  viralityScore Float
  predictedViews Int?
  reasoning     String?
  createdAt     DateTime @default(now())

  @@index([simulationId])
}

model CompetitorProfile {
  id        String   @id @default(cuid())
  userId    String // The user (our talent) this competitor is associated with
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  platform  SocialPlatform
  username  String
  profileUrl String?
  followers Int?
  metadata  Json? // For storing aiInsights like strengths, weaknesses

  posts     CompetitorPost[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, platform, username])
  @@index([userId])
}

model CompetitorPost {
  id                  String   @id @default(cuid())
  competitorProfileId String
  competitorProfile   CompetitorProfile @relation(fields: [competitorProfileId], references: [id], onDelete: Cascade)
  platformPostId      String
  caption             String?
  mediaUrl            String?
  postedAt            DateTime
  likes               Int?
  comments            Int?
  views               Int?
  engagementRate      Float?
  aiInsights          Json? // themes, performance tier, counter-content ideas
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  @@unique([competitorProfileId, platformPostId])
  @@index([competitorProfileId])
}

model CampaignForecast {
  id                      String      @id @default(cuid())
  dealDraftId             String?     @unique
  dealDraft               DealDraft?  @relation(fields: [dealDraftId], references: [id], onDelete: Cascade)
  briefId                 String?     @unique
  brief                   BrandBrief? @relation(fields: [briefId], references: [id], onDelete: Cascade)
  userId                  String
  user                    User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  brandName               String?
  predictedReach          Int?
  predictedEngagement     Int?
  predictedViews          Int?
  predictedCTR            Float?
  predictedCPM            Float?
  budgetMin               Int?
  budgetMax               Int?
  timelineMinDays         Int?
  timelineMaxDays         Int?
  risks                   Json?
  recommendations         Json?
  summary                 String?
  confidence              Float?
  version                 Int         @default(1)
  createdAt               DateTime    @default(now())
  updatedAt               DateTime    @updatedAt

  @@index([dealDraftId])
  @@index([briefId])
  @@index([userId])
}

model NegotiationReplySuggestion {
  id         String       @id @default(cuid())
  threadId   String
  thread     DealThread   @relation(fields: [threadId], references: [id], onDelete: Cascade)
  emailId    String       @unique
  email      InboundEmail @relation(fields: [emailId], references: [id], onDelete: Cascade)
  userId     String
  user       User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  talentId   String
  talent     Talent       @relation(fields: [talentId], references: [id], onDelete: Cascade)
  aiSubject  String
  aiBody     String
  autoSend   Boolean      @default(false)
  confidence Float
  status     String       @default("pending") // pending, approved, rejected
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt

  @@index([threadId])
  @@index([emailId])
  @@index([userId])
  @@index([talentId])
}

model ContentPerformanceForecast {
  id                      String       @id @default(cuid())
  userId                  String
  user                    User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  talentId                String
  talent                  Talent       @relation(fields: [talentId], references: [id], onDelete: Cascade)
  deliverableId           String?      @unique
  deliverable             Deliverable? @relation(fields: [deliverableId], references: [id], onDelete: Cascade)
  dealDraftId             String?
  dealDraft               DealDraft?   @relation(fields: [dealDraftId], references: [id], onDelete: Cascade)
  predictedViews          Int?
  predictedEngagement     Int?
  predictedSaves          Int?
  predictedShares         Int?
  predictedWatchTime      Int? // in seconds
  performanceTier         String? // A-F
  viralityScore           Float? // 0-1
  riskFlags               Json?
  suggestions             Json?
  reasons                 Json?
  createdAt               DateTime     @default(now())
  updatedAt               DateTime     @updatedAt

  @@index([userId])
  @@index([talentId])
  @@index([deliverableId])
  @@index([dealDraftId])
}

model InboxSummary {
  id        String    @id @default(cuid())
  userId    String
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  talentId  String?
  talent    Talent?   @relation(fields: [talentId], references: [id], onDelete: Cascade)
  timeframe String // "daily", "hourly"
  summary   String?
  insights  Json?
  actions   Json?
  createdAt DateTime  @default(now())

  @@index([userId])
  @@index([talentId])
  @@index([timeframe, createdAt])
}

model FollowUpSchedule {
  id        String     @id @default(cuid())
  threadId  String
  thread    DealThread @relation(fields: [threadId], references: [id], onDelete: Cascade)
  userId    String
  user      User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  talentId  String
  talent    Talent     @relation(fields: [talentId], references: [id], onDelete: Cascade)
  nextRunAt DateTime
  type      String // 'gentle_reminder', 'value_prop', 'escalation'
  status    String   @default("active") // 'active', 'paused', 'completed'
  metadata  Json? // { followUpCount: 2 }
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  @@index([threadId])
  @@index([status, nextRunAt])
}

model DealForecast {
  id                        String      @id @default(cuid())
  userId                    String
  user                      User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  threadId                  String?     @unique
  thread                    DealThread? @relation(fields: [threadId], references: [id], onDelete: Cascade)
  draftId                   String?     @unique
  draft                     DealDraft?  @relation(fields: [draftId], references: [id], onDelete: Cascade)
  brandName                 String?
  predictedValueMin         Int?
  predictedValueExpected    Int?
  predictedValueMax         Int?
  likelihood                Float?
  predictedTimelineDays     Int?
  predictedNegotiationSteps Int?
  recommendedAction         Json?
  aiReasons                 Json?
  createdAt                 DateTime    @default(now())
  updatedAt                 DateTime    @updatedAt

  @@index([userId])
  @@index([threadId])
  @@index([draftId])
}

model DeadlineMonitor {
  id          String    @id @default(cuid())
  entityType  String // e.g., 'DELIVERABLE', 'CONTRACT_SIGNATURE'
  entityId    String
  userId      String
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  talentId    String
  talent      Talent    @relation(fields: [talentId], references: [id], onDelete: Cascade)
  dueAt       DateTime
  lastChecked DateTime?
  status      String    @default("active") // 'active', 'at_risk', 'overdue', 'completed'
  riskScore   Float? // 0-1
  aiSummary   String?
  metadata    Json?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([entityType, entityId])
  @@index([userId])
  @@index([talentId])
  @@index([status, dueAt])
}

model EmailOutbox {
  id          String    @id @default(cuid())
  userId      String?
  user        User?     @relation(fields: [userId], references: [id], onDelete: SetNull)
  talentId    String?
  talent      Talent?   @relation(fields: [talentId], references: [id], onDelete: SetNull)
  brandEmail  String?
  to          String
  subject     String
  body        String
  attachments Json?
  status      String    @default("queued") // queued, sending, sent, failed
  error       String?
  context     Json?
  sentAt      DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([userId])
  @@index([talentId])
  @@index([status])
}

model EmailTemplateRule {
  id       String  @id @default(cuid())
  talentId String?
  talent   Talent? @relation(fields: [talentId], references: [id], onDelete: Cascade)
  type     String // e.g., ASSET_PACK_READY, CONTRACT_DRAFT_READY
  subject  String
  body     String
  enabled  Boolean @default(true)
}

model TalentAssetPack {
  id             String   @id @default(cuid())
  aiPlanId       String
  talentId       String
  brandName      String
  zipUrl         String?
  briefPdf       String?
  guidelinesPdf  String?
  scriptsJson    Json?
  captionsJson   Json?
  usageRightsPdf String?
  status         String   @default("pending")
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  plan   CampaignAIPlan @relation(fields: [aiPlanId], references: [id], onDelete: Cascade)
  talent Talent         @relation(fields: [talentId], references: [id], onDelete: Cascade)

  @@index([aiPlanId])
  @@index([talentId])
}

model AIContractDraft {
  id           String   @id @default(cuid())
  aiPlanId     String
  talentId     String
  brandName    String
  contractJson Json
  termsJson    Json
  risksJson    Json?
  redlinesJson Json?
  aiSummary    Json?
  status       String   @default("draft")
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  plan   CampaignAIPlan @relation(fields: [aiPlanId], references: [id], onDelete: Cascade)
  talent Talent         @relation(fields: [talentId], references: [id], onDelete: Cascade)

  @@index([aiPlanId])
  @@index([talentId])
}

model CampaignDeck {
  id         String   @id @default(cuid())
  aiPlanId   String   @unique
  pdfUrl     String?
  pptxUrl    String?
  jsonSlides Json?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  plan CampaignAIPlan @relation(fields: [aiPlanId], references: [id], onDelete: Cascade)

  @@index([aiPlanId])
}

model CreatorTask {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  taskType  String // "REVIEW_BRIEF", "RECORD_VIDEO", "REPLY_EMAIL", "APPROVE_POST"
  title     String
  metadata  Json?
  dueDate   DateTime?
  status    String   @default("pending") // pending, in_progress, completed, dismissed
  createdAt DateTime @default(now())

  @@index([userId])
  @@index([status])
  @@index([dueDate])
}

model PricingSnapshot {
  id            String   @id @default(cuid())
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  brandName     String?
  dealId        String?
  baseRate      Int
  recommended   Int
  marketLow     Int?
  marketAvg     Int?
  marketHigh    Int?
  upsells       Json?
  metadata      Json?
  createdAt     DateTime @default(now())

  @@index([userId])
  @@index([dealId])
}

model BrandCampaign {
  id               String    @id @default(cuid())
  userId           String
  user             User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  title            String
  description      String?
  goals            String?
  categories       String[]
  deliverables     Json?
  budgetMin        Int?
  budgetMax        Int?
  timeline         String?
  targetAudience   String?
  inspirationLinks Json?
  competitorList   Json?
  notes            String?
  fileId           String?
  file             File?     @relation(fields: [fileId], references: [id], onDelete: SetNull)
  status           String    @default("draft")
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  creativeDirection CreativeDirection?

  @@index([userId])
  @@index([status])
}

model CreatorMatchScore {
  id                  String      @id @default(cuid())
  userId              String
  user                User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  briefId             String?
  brief               BrandBrief? @relation(fields: [briefId], references: [id])
  dealDraftId         String?
  dealDraft           DealDraft?  @relation(fields: [dealDraftId], references: [id])
  talentId            String
  talent              Talent      @relation(fields: [talentId], references: [id], onDelete: Cascade)
  fitScore            Float
  predictedFee        Int?
  predictedViews      Int?
  predictedEngagement Int?
  predictedCTR        Float?
  predictedROI        Float?
  reasoning           Json?
  risks               Json?
  createdAt           DateTime    @default(now())

  @@index([briefId])
  @@index([userId])
  @@index([talentId])
  @@index([fitScore])
}

model CreativeDirection {
  id         String   @id @default(cuid())
  campaignId String   @unique
  campaign   BrandCampaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)

  concept    Json? // { title: string, summary: string }
  tone       Json? // { keywords: string[], description: string }
  palette    Json? // { primary: string, secondary: string, accent: string }
  moodboard  Json? // string[] of image URLs
  hooks      Json? // string[]
  scripts    Json? // { platform: string, script: string }[]
  examples   Json? // string[] of URLs

  metadata   Json?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([campaignId])
}

model PostingSlot {
  id            String      @id @default(cuid())
  deliverableId String
  deliverable   Deliverable @relation(fields: [deliverableId], references: [id], onDelete: Cascade)
  userId        String
  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  platform      SocialPlatform
  status        String      @default("suggested") // suggested, scheduled, approved, posted, late
  scheduledFor  DateTime
  postedAt      DateTime?
  aiReasoning   Json?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  @@index([deliverableId])
  @@index([userId])
  @@index([platform])
  @@index([status])
  @@index([scheduledFor])
}

model Subscription {
  id                   String    @id @default(cuid())
  userId               String
  user                 User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  stripeCustomerId     String?
  stripeSubscriptionId String?   @unique
  stripePriceId        String?
  status               String    @default("active") // active, past_due, canceled
  currentPeriodEnd     DateTime?
  canceledAt           DateTime?
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt

  @@index([userId])
  @@index([stripeSubscriptionId])
}
